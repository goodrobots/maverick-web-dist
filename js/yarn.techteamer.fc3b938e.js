(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["yarn.techteamer"],{"10a8":function(e,s,t){const r=t("879c"),n=t("9004");class i extends r{constructor(e,s=!1){super(e),this.filterDirectCandidates=!!s,this.janusEchoBody={audio:!0,video:!0},this.pluginName="janus.plugin.streaming",this.sdpHelper=new n(this.logger)}create(e){const s=Object.assign(e,{request:"create"});return this.transaction("message",{body:s},"success").then(({data:e,json:s})=>{if(e.error_code)throw this.logger.error("StreamingJanusPlugin error while create",e),new Error("StreamingJanusPlugin error while create");return{data:e,json:s}}).catch(e=>{throw this.logger.error("StreamingJanusPlugin, cannot create stream",e),e})}destroy(e,s=!1){const t={request:"destroy",id:e,permanent:s};return this.transaction("message",{body:t},"success").catch(e=>{throw this.logger.error("StreamingJanusPlugin, cannot destroy stream",e),e})}list(){const e={request:"list"};return this.transaction("message",{body:e},"success").catch(e=>{throw this.logger.error("StreamingJanusPlugin, cannot list streams",e),e})}watch(e){const s={request:"watch",id:e};return new Promise((e,t)=>{this.transaction("message",{body:s},"event").then(s=>{const{data:t,json:r}=s||{};if(!t||"event"!==t.streaming)throw this.logger.error("StreamingJanusPlugin watch error ",t,r),new Error("StreamingJanusPlugin watch error");if(!r.jsep)throw this.logger.error("StreamingJanusPlugin watch answer does not contains jsep",t,r),new Error("StreamingJanusPlugin watch answer does not contains jsep");t.result&&t.result.status&&this.emit("statusChange",t.result.status);const n=r.jsep;this.filterDirectCandidates&&n.sdp&&(n.sdp=this.sdpHelper.filterDirectCandidates(n.sdp)),this.emit("jsep",n),e(n)}).catch(e=>{this.logger.error("StreamingJanusPlugin, cannot watch stream",e),t(e)})})}start(e){const s={request:"start"},t={body:s};return e&&(t.jsep=e),this.transaction("message",t,"event").then(({data:e,json:s})=>(e.result&&e.result.status&&this.emit("statusChange",e.result.status),{data:e,json:s})).catch(e=>{throw this.logger.error("StreamingJanusPlugin, cannot start stream",e),e})}stop(){const e={request:"stop"};return this.transaction("message",{body:e},"event").then(({data:e,json:s})=>(e.result&&e.result.status&&this.emit("statusChange",e.result.status),{data:e,json:s})).catch(e=>{throw this.logger.error("StreamingJanusPlugin, cannot start stream",e),e})}pause(){const e={request:"pause"};return this.transaction("message",{body:e},"event").then(({data:e,json:s})=>(e.result&&e.result.status&&this.emit("statusChange",e.result.status),{data:e,json:s})).catch(e=>{throw this.logger.error("StreamingJanusPlugin, cannot start stream",e),e})}info(e){const s={request:"info",id:e};return this.transaction("message",{body:s},"success").catch(e=>{throw this.logger.error("StreamingJanusPlugin, cannot start stream",e),e})}switch(e){const s={request:"switch",id:e};return this.transaction("message",{body:s},"event").catch(e=>{throw this.logger.error("StreamingJanusPlugin, cannot start stream",e),e})}onmessage(e,s){e&&"event"===e.streaming&&e.result&&e.result.status?this.emit("statusChange",e.result.status):this.logger.error("StreamingJanusPlugin got unknown message",e,s)}candidate(e){if(!(this.filterDirectCandidates&&e.candidate&&this.sdpHelper.isDirectCandidate(e.candidate)))return this.transaction("trickle",{candidate:e})}}e.exports=i},"2e2a":function(e,s,t){const r=t("517b"),n=t("879c"),i=t("c64e"),o=[458,459];class a{constructor(e,s){this.ws=void 0,this.isConnected=!1,this.sessionId=void 0,this.logger=s,this.transactions={},this.pluginHandles={},this.config=e,this.protocol="janus-protocol",this.sendCreate=!0}connect(){return this.isConnected?Promise.resolve(this):new Promise((e,s)=>{this.ws=new r(this.config.url,this.protocol,this.config.options),this.ws.addEventListener("error",e=>{this.logger.error("Error connecting to the Janus WebSockets server...",e),this.isConnected=!1,s(e)}),this.ws.addEventListener("close",()=>{this.cleanup()}),this.ws.addEventListener("open",()=>{if(!this.sendCreate)return this.isConnected=!0,this.keepAlive(!0),e(this);const t=i(),r={janus:"create",transaction:t};this.transactions[t]={resolve:t=>{if("success"!==t.janus)return this.logger.error("Cannot connect to Janus",t),void s(t);this.sessionId=t.data.id,this.isConnected=!0,this.keepAlive(!0),this.logger.debug("Janus connected, sessionId: ",this.sessionId),e(this)},reject:s,replyType:"success"},this.ws.send(JSON.stringify(r))}),this.ws.addEventListener("message",e=>{this.onMessage(e)}),this.ws.addEventListener("close",()=>{this.onClose()})})}addPlugin(e){if(!(e instanceof n))return Promise.reject(new Error("plugin is not a JanusPlugin"));const s=e.getAttachPayload();return this.transaction("attach",s,"success").then(s=>{if("success"!==s.janus)throw this.logger.error("Cannot add plugin",s),e.error(s),new Error(s);return this.pluginHandles[s.data.id]=e,e.success(this,s.data.id)})}transaction(e,s,t,r){t||(t="ack");const n=i();return new Promise((i,o)=>{if(r&&setTimeout(()=>{o(new Error("Transaction timed out after "+r+" ms"))},r),!this.isConnected)return void o(new Error("Janus is not connected"));const a=Object.assign({},s,{janus:e,session_id:s&&parseInt(s.session_id,10)||this.sessionId,transaction:n});this.transactions[a.transaction]={resolve:i,reject:o,replyType:t,request:a},this.ws.send(JSON.stringify(a))})}send(e,s){return new Promise((t,r)=>{if(!this.isConnected)return void r(new Error("Janus is not connected"));const n=Object.assign({},s,{janus:e,session_id:this.sessionId,transaction:i()});this.logger.debug("Janus sending",n),this.ws.send(JSON.stringify(n),{},e=>{e?r(e):t()})})}destroy(){return this.isConnected?this.transaction("destroy",{},"success",5e3).then(()=>{this.cleanup()}).catch(()=>{this.cleanup()}):Promise.resolve()}destroyPlugin(e){return new Promise((s,t)=>{e instanceof n?this.pluginHandles[e.janusHandleId]?this.transaction("detach",{plugin:e.pluginName,handle_id:e.janusHandleId},"success",5e3).then(()=>{delete this.pluginHandles[e.pluginName],e.detach(),s()}).catch(s=>{delete this.pluginHandles[e.pluginName],e.detach(),t(s)}):t(new Error("unknown plugin")):t(new Error("plugin is not a JanusPlugin"))})}onMessage(e){let s;try{s=JSON.parse(e.data)}catch(t){return void this.logger.error("cannot parse message",e.data)}if("timeout"!==s.janus||s.session_id===this.sessionId){if("keepalive"!==s.janus)if("ack"!==s.janus){if("success"===s.janus){const e=this.getTransaction(s);if(!e)return;const t=s.plugindata;if(void 0===t||null===t)return void e.resolve(s);const r=s.sender;if(!r)return e.resolve(s),void this.logger.error("Missing sender for plugindata",s);const n=this.pluginHandles[r];return n?void e.resolve({data:t.data,json:s}):void this.logger.error("This handle is not attached to this session",s)}if("webrtcup"===s.janus){const e=s.sender;if(!e)return void this.logger.warn("Missing sender...");const t=this.pluginHandles[e];return t?void t.webrtcState(!0):void this.logger.error("This handle is not attached to this session",e)}if("hangup"===s.janus){const e=s.sender;if(!e)return void this.logger.warn("Missing sender...");const t=this.pluginHandles[e];return t?(t.webrtcState(!1,s.reason),void t.hangup()):void this.logger.error("This handle is not attached to this session",e)}if("detached"===s.janus){const e=s.sender;return e?void 0:void this.logger.warn("Missing sender...")}if("media"===s.janus){const e=s.sender;if(!e)return void this.logger.warn("Missing sender...");const t=this.pluginHandles[e];return t?void t.mediaState(s.type,s.receiving):void this.logger.error("This handle is not attached to this session",e)}if("slowlink"===s.janus){this.logger.debug("Got a slowlink event on session "+this.sessionId),this.logger.debug(s);const e=s.sender;if(!e)return void this.logger.warn("Missing sender...");const t=this.pluginHandles[e];return t?void t.slowLink(s.uplink,s.nacks):void this.logger.error("This handle is not attached to this session",e)}if("error"!==s.janus){if("event"===s.janus){const e=s.sender;if(!e)return void this.logger.warn("Missing sender...");const t=s.plugindata;if(void 0===t||null===t)return void this.logger.error("Missing plugindata...");const r=this.pluginHandles[e];if(!r)return void this.logger.error("This handle is not attached to this session",e);const n=t.data,i=this.getTransaction(s);return i?void(n.error_code?i.reject({data:n,json:s}):i.resolve({data:n,json:s})):void r.onmessage(n,s)}this.logger.warn("Unknown message/event "+s.janus+" on session "+this.sessionId),this.logger.debug(s)}else{s.error&&s.error.code&&!o.includes(s.error.code)&&this.logger.error("Janus error response"+s);const e=this.getTransaction(s,!0);e&&e.reject&&(e.request&&this.logger.debug("Janus Error: rejecting transaction",e.request,s),e.reject(s))}}else{const e=this.getTransaction(s);e&&e.resolve&&e.resolve(s)}}else this.logger.debug("GOT timeout from another websocket")}onClose(){this.isConnected&&(this.isConnected=!1,this.logger.error("Lost connection to the gateway (is it down?)"))}keepAlive(e){this.ws&&this.isConnected&&this.sessionId&&(e?setTimeout(()=>{this.keepAlive()},this.config.keepAliveIntervalMs):this.transaction("keepalive").then(()=>{setTimeout(()=>{this.keepAlive()},this.config.keepAliveIntervalMs)}).catch(e=>{this.logger.warn("Janus keepalive error",e)}))}getTransaction(e,s=!1){const t=e.janus,r=e.transaction;if(r&&Object.prototype.hasOwnProperty.call(this.transactions,r)&&(s||this.transactions[r].replyType===t)){const e=this.transactions[r];return delete this.transactions[r],e}}cleanup(){this._cleanupPlugins(),this._cleanupWebSocket(),this._cleanupTransactions()}_cleanupWebSocket(){this.ws&&(this.ws.removeAllListeners(),this.ws.readyState===r.OPEN&&this.ws.close()),this.ws=void 0,this.isConnected=!1}_cleanupPlugins(){Object.keys(this.pluginHandles).forEach(e=>{const s=this.pluginHandles[e];delete this.pluginHandles[e],s.detach()})}_cleanupTransactions(){Object.keys(this.transactions).forEach(e=>{const s=this.transactions[e];s.reject&&s.reject()}),this.transactions={}}}e.exports=a},"42e8":function(e,s,t){const r=t("879c"),n=t("9004"),i=t("282b");class o extends r{constructor(e,s,t,r=!1){if(!e)throw new Error("unknown config");super(t),this.display=s,this.pluginName="janus.plugin.videoroom",this.janusRoomId=void 0,this.janusRoomMemberId=void 0,this.janusRoomPrivateMemberId=void 0,this.filterDirectCandidates=!!r,this.config=e,this.sdpHelper=new n(this.logger),this.offerSdp=void 0,this.answerSdp=void 0,this.rtpForwardVideoStreamId=void 0,this.rtpForwardAudioStreamId=void 0,this.rtpForwardDataStreamId=void 0}startRTPForward(e,s,t){const r={request:"rtp_forward",room:this.janusRoomId,publisher_id:this.janusRoomMemberId,host:e};return s&&(r.video_port=s),t&&(r.audio_port=t),this.transaction("message",{body:r},"success").then(({data:r,json:n})=>{r&&r.rtp_stream&&r.rtp_stream.video_stream_id&&(this.rtpForwardVideoStreamId=r.rtp_stream.video_stream_id),r&&r.rtp_stream&&r.rtp_stream.audio_stream_id&&(this.rtpForwardAudioStreamId=r.rtp_stream.audio_stream_id),r&&r.rtp_stream&&r.rtp_stream.data_stream_id&&(this.rtpForwardDataStreamId=r.rtp_stream.data_stream_id);let o="v=0\n"+`o=- 0 0 IN IP4 ${e}\n`+`s=janus-api:${this.janusRoomId}.${this.janusRoomMemberId}\n`+`c=IN IP4 ${e}\n`+"t=0 0\na=tool:janus-api\n";return i.splitSections(this.answerSdp).forEach((e,r)=>{if(0===r)return;const n=i.getMid(e),a=i.parseRtpParameters(e),d=a.codecs[0];d&&("video"===n&&s&&(o+=`m=video ${s} RTP/AVP ${d.payloadType}\n`+`a=rtpmap:${d.payloadType} ${d.name}/${d.clockRate}\n`+"a=fmtp:11 packetization-mode=1\na=rtcp-mux\n"),"audio"===n&&t&&(o+=`m=audio ${t} RTP/AVP ${d.payloadType}\n`+`a=rtpmap:${d.payloadType} ${d.name}/${d.clockRate}\n`+"a=fmtp:11 packetization-mode=1\na=rtcp-mux\n"))}),o}).catch(e=>{throw this.logger.error("VideoRoomPublisherJanusPlugin, cannot RTP forward",e),e})}stopRTPForward(){const e=[];return this.rtpForwardVideoStreamId&&e.push(this.stopRTPForwardStream(this.rtpForwardVideoStreamId)),this.rtpForwardAudioStreamId&&e.push(this.stopRTPForwardStream(this.rtpForwardAudioStreamId)),this.rtpForwardDataStreamId&&e.push(this.stopRTPForwardStream(this.rtpForwardDataStreamId)),Promise.all(e)}stopRTPForwardStream(e){const s={request:"stop_rtp_forward",room:this.janusRoomId,publisher_id:this.janusRoomMemberId,stream_id:e};return this.transaction("message",{body:s},"success").catch(e=>{throw this.logger.error("VideoRoomPublisherJanusPlugin, cannot stop RTP forward",e),e})}setRoomBitrate(e){const s={request:"edit",room:this.janusRoomId,new_bitrate:e};return this.transaction("message",{body:s},"success").catch(e=>{throw this.logger.error("VideoRoomPublisherJanusPlugin, cannot set room bitrate",e),e})}connect(){return this.transaction("message",{body:{request:"list"}},"success").then(e=>{const{data:s}=e||{};if(!s||!Array.isArray(s.list))throw this.logger.error("VideoRoomPublisherJanusPlugin, could not find roomList",s),new Error("VideoRoomPublisherJanusPlugin, could not find roomList");const t=s.list.find(e=>e.description===""+this.config.id);return t?(this.janusRoomId=t.room,this.join()):this.createRoom()}).catch(e=>{throw this.logger.error("VideoRoomPublisherJanusPlugin, cannot list rooms",e),e})}join(){const e={request:"join",room:this.janusRoomId,ptype:"publisher",display:this.display};return new Promise((s,t)=>{this.transaction("message",{body:e},"event").then(e=>{const{data:t}=e||{};if(!t||!t.id||!t.private_id||!t.publishers)throw this.logger.error("VideoRoomPublisherJanusPlugin, could not join room",t),new Error("VideoRoomPublisherJanusPlugin, could not join room");this.janusRoomMemberId=t.id,this.janusRoomPrivateMemberId=t.private_id,s(t.publishers)}).catch(e=>{e&&426===e.error_code?this.createRoom().then(s).catch(t):(this.logger.error("VideoRoomPublisherJanusPlugin, unknown error connecting to room",e),t(e))})})}createRoom(){const e={request:"create",description:""+this.config.id,record:this.config.record,videocodec:this.config.codec,rec_dir:this.config.recordDirectory,publishers:this.config.publishers,videoorient_ext:this.config.videoOrientExt};return this.config.bitrate&&(e.bitrate=this.config.bitrate),this.config.firSeconds&&(e.fir_freq=this.config.firSeconds),this.transaction("message",{body:e},"success").then(e=>{const{data:s}=e||{};if(!s||!s.room)throw this.logger.error("VideoRoomPublisherJanusPlugin, could not create room",s),new Error("VideoRoomPublisherJanusPlugin, could not create room");return this.janusRoomId=s.room,this.join()}).catch(e=>{throw this.logger.error("VideoRoomPublisherJanusPlugin, cannot create room",e),e})}configure(e,s=!0,t=!0){if(!this.janusRoomMemberId)return void this.logger.error("VideoRoomPublisherJanusPlugin, cannot configure without janusRoomMemberId");const r={request:"configure",audio:s,video:t},n=e;return this.filterDirectCandidates&&n.sdp&&(n.sdp=this.sdpHelper.filterDirectCandidates(n.sdp)),this.offerSdp=n.sdp,this.transaction("message",{body:r,jsep:n},"event").then(e=>{const{json:s}=e||{};if(!s.jsep)throw new Error("cannot configure");const t=s.jsep;return this.filterDirectCandidates&&t.sdp&&(t.sdp=this.sdpHelper.filterDirectCandidates(t.sdp)),this.answerSdp=t.sdp,t})}candidate(e){if(!(this.filterDirectCandidates&&e.candidate&&this.sdpHelper.isDirectCandidate(e.candidate)))return this.transaction("trickle",{candidate:e})}onmessage(e,s){const{videoroom:t,room:r,unpublished:n,leaving:i,publishers:o}=e;e&&t&&"event"===t?r===this.janusRoomId?n?this.emit("remoteMemberUnpublished",n):i?this.emit("remoteMemberLeaving",i):Array.isArray(o)?this.emit("publishersUpdated",o):this.logger.error("VideoRoomPublisherJanusPlugin got unknown event",s):this.logger.error("VideoRoomPublisherJanusPlugin got unknown roomId",this.janusRoomId,s):this.logger.error("VideoRoomPublisherJanusPlugin got unknown message",s)}}e.exports=o},"517b":function(e,s,t){let r;try{r=t("9043")}catch(n){window.WebSocket.prototype.removeAllListeners=()=>{}}e.exports=r||window.WebSocket},"6f86":function(e,s,t){const r=t("2e2a");class n extends r{constructor(e,s){super(e,s),this.config=e,this.protocol="janus-admin-protocol",this.sendCreate=!1}transaction(e,s,t){const r=Object.assign({},s,{admin_secret:this.config.secret});return super.transaction(e,r,t||"success")}listSessions(){return this.transaction("list_sessions").then(e=>e.sessions)}listHandles(e){return this.transaction("list_handles",{session_id:e}).then(e=>e.handles)}handleInfo(e,s){return this.transaction("handle_info",{session_id:e,handle_id:s}).then(e=>e.info)}}e.exports=n},"777c":function(e,s,t){const r=t("879c"),n=t("9004");class i extends r{constructor(e,s=!1){super(e),this.filterDirectCandidates=!!s,this.janusEchoBody={audio:!0,video:!0},this.pluginName="janus.plugin.echotest",this.sdpHelper=new n(this.logger)}mute(e=!1){return this.transaction("message",{audio:!e},"success").catch(e=>{throw this.logger.error("EchoJanusPlugin, cannot mute",e),e})}connect(){return this.transaction("message",{body:this.janusEchoBody},"event").catch(e=>{throw this.logger.error("EchoJanusPlugin error during connect",e),e})}onmessage(e,s){e&&"event"===e.echotest&&"done"===e.result?this.janus.destroyPlugin(this).catch(e=>{this.logger.error("EchoJanusPlugin, destroyPlugin error in onmessage",e)}):this.logger.error("EchoJanusPlugin got unknown message",e,s)}consume(e){if("message"===e.type){const s={jsep:e.message.jsep,body:this.janusEchoBody};return this.transaction("message",s,"event").then(e=>{const{json:s}=e;if(!s||!s.jsep)return void this.logger.error("EchoJanusPlugin, no jsep in the transaction reply",e);const t=s.jsep;this.filterDirectCandidates&&t.sdp&&(t.sdp=this.sdpHelper.filterDirectCandidates(t.sdp)),this.emit("jsep",t)}).catch(e=>{throw this.logger.error("EchoJanusPlugin, message error in consume",e),e})}return"candidate"===e.type?this.filterDirectCandidates&&e.message.candidate&&this.sdpHelper.isDirectCandidate(e.message.candidate)?Promise.resolve():this.transaction("trickle",{candidate:e.message}).catch(e=>{throw this.logger.error("EchoJanusPlugin, candidate error in consume",e),e}):(this.logger.error("EchoTransportSession unknown data type",e),Promise.reject(new Error("EchoTransportSession unknown data type")))}}e.exports=i},"879c":function(e,s,t){const r=t("c64e"),n=t("faa1");class i extends n{constructor(e){super(),this.id=r(),this.janus=void 0,this.janusHandleId=void 0,this.pluginName=void 0,this.logger=e}getAttachPayload(){return{plugin:this.pluginName,opaque_id:this.id}}transaction(e,s,t){const r=Object.assign({},s,{handle_id:this.janusHandleId});return this.janus?this.janus.transaction(e,r,t):Promise.reject(new Error("JanusPlugin is not connected"))}success(e,s){return this.janus=e,this.janusHandleId=s,this}error(e){}onmessage(e,s){this.logger.error("Unhandled message from janus in a plugin: "+this.constructor.name,e,s)}oncleanup(){}detached(){}hangup(){this.emit("hangup")}slowLink(){this.emit("slowlink")}mediaState(e,s){this.emit("mediaState",e,s)}webrtcState(e,s){this.emit("webrtcState",e,s)}detach(){this.removeAllListeners(),this.janus=null}}e.exports=i},9004:function(e,s,t){const r=t("282b");class n{constructor(e){this.logger=e}filterH264Profiles(e,s){const t=r.splitSections(e),n=[];for(const i of t)if("video"===r.getMid(i)){const e=[],t=r.splitLines(i),o=[[]];let a=0;for(const s of t)0===s.indexOf("a=rtpmap:")&&(o.push([]),a++),o[a].push(s);o[0].map(s=>e.push(s));for(let n=1;n<o.length;n++){const t=o[n],i=r.parseRtpMap(t[0]);if(i&&"H264"===i.name){const r=t.filter(e=>0===e.indexOf("a=fmtp:")).shift();let i=!1;if(Array.isArray(s))for(const e of s)i=i||-1!==r.indexOf("profile-level-id="+e);else"string"===typeof s?i=-1!==r.indexOf("profile-level-id="+s):s instanceof RegExp&&(i=s.test(r));i&&o[n].map(s=>e.push(s))}else o[n].map(s=>e.push(s))}e.map(e=>n.push(e))}else r.splitLines(i).map(e=>n.push(e));return n.join("\r\n")+"\r\n"}filterDirectCandidates(e,s=!1){const t=r.splitLines(e),n=[];let i=!1,o=!1;for(const r of t)r.startsWith("a=candidate")?(i=!0,this.isDirectCandidate(r)||(n.push(r),o=!0)):n.push(r);return!i||o||s?(i&&!o&&this.logger.error("SDP DIRECT CANDIDATES FILTERED OUT BUT NO OTHER CANDIDATES IN SDP",e,(new Error).stack),n.join("\r\n")+"\r\n"):(this.logger.warn("SDP NO OTHER CANDIDATES THAN DIRECT CANDIDATES",e,(new Error).stack),e)}isDirectCandidate(e){const s=r.parseCandidate(e);return"host"===s.type||"srflx"===s.type||"host"===s.tcpType||"srflx"===s.tcpType}}e.exports=n},"938e":function(e,s,t){const r=t("879c"),n=t("9004");class i extends r{constructor(e,s,t,r,i,o=!1){if(!e)throw new Error("unknown roomId");if(!t)throw new Error("unknown janusRoomPrivateMemberId");super(i),this.roomId=e,this.janusRoomId=s,this.pluginName="janus.plugin.videoroom",this.janusRoomPrivateMemberId=t,this.janusRemoteFeedId=r,this.filterDirectCandidates=!!o,this.sdpHelper=new n(this.logger)}join(e=!0,s=!0){const t={request:"join",room:this.janusRoomId,ptype:"listener",feed:this.janusRemoteFeedId,private_id:this.janusRoomPrivateMemberId,offer_video:s,offer_audio:e};return new Promise((e,s)=>{this.transaction("message",{body:t},"event").then(s=>{const{data:t,json:r}=s||{};if(!t||"attached"!==t.videoroom)throw this.logger.error("VideoRoomListenerJanusPlugin join answer is not attached",t,r),new Error("VideoRoomListenerJanusPlugin join answer is not attached");if(!r.jsep)throw this.logger.error("VideoRoomListenerJanusPlugin join answer does not contains jsep",t,r),new Error("VideoRoomListenerJanusPlugin join answer does not contains jsep");const n=r.jsep;this.filterDirectCandidates&&n.sdp&&(n.sdp=this.sdpHelper.filterDirectCandidates(n.sdp)),this.emit("jsep",n),e(n)}).catch(e=>{this.logger.error("VideoRoomListenerJanusPlugin, unknown error connecting to room",e,t),s(e)})})}setAnswer(e){const s={request:"start",room:this.janusRoomId};return new Promise((t,r)=>{const n=e;this.filterDirectCandidates&&n&&n.sdp&&(n.sdp=this.sdpHelper.filterDirectCandidates(n.sdp)),this.transaction("message",{body:s,jsep:n},"event").then(e=>{const{data:s,json:r}=e||{};if(!s||"ok"!==s.started)throw this.logger.error("VideoRoomListenerJanusPlugin set answer is not ok",s,r),new Error("VideoRoomListenerJanusPlugin set answer is not ok");t()}).catch(s=>{this.logger.error("VideoRoomListenerJanusPlugin, unknown error sending answer",s,e),r(s)})})}candidate(e){if(!(this.filterDirectCandidates&&e.candidate&&this.sdpHelper.isDirectCandidate(e.candidate)))return this.transaction("trickle",{candidate:e})}hangup(){super.hangup(),this.janus.destroyPlugin(this).catch(e=>{this.logger.error("VideoRoomListenerJanusPlugin, destroyPlugin error in hangup",e)})}}e.exports=i},a811:function(e,s,t){const r=t("2e2a"),n=t("6f86"),i=t("879c"),o=t("777c"),a=t("dd8b"),d=t("938e"),c=t("42e8"),h=t("10a8"),{JanusConfig:u,JanusAdminConfig:l,JanusRoomConfig:g}=t("ce1a");e.exports={Janus:r,JanusAdmin:n,JanusPlugin:i,EchoJanusPlugin:o,RecordPlayJanusPlugin:a,VideoRoomListenerJanusPlugin:d,VideoRoomPublisherJanusPlugin:c,StreamingJanusPlugin:h,JanusConfig:u,JanusAdminConfig:l,JanusRoomConfig:g}},ce1a:function(e,s){class t{constructor(e){const{url:s,keepAliveIntervalMs:t,options:r}=e;this.url=s,this.keepAliveIntervalMs=t,this.options=r}}class r extends t{constructor(e){super(e);const{secret:s,sessionListIntervalMs:t}=e;this.secret=s,this.sessionListIntervalMs=t}}class n{constructor(e){const{id:s,codec:t,record:r,videoOrientExt:n,bitrate:i,firSeconds:o,publishers:a,recordDirectory:d}=e;this.id=s,this.codec=t,this.record=r,this.videoOrientExt=n,this.bitrate=i,this.firSeconds=o,this.publishers=a,this.recordDirectory=d}}e.exports.JanusConfig=t,e.exports.JanusAdminConfig=r,e.exports.JanusRoomConfig=n},dd8b:function(e,s,t){const r=t("879c"),n=t("9004");class i extends r{constructor(e,s=!1){super(e),this.filterDirectCandidates=!!s,this.janusEchoBody={audio:!0,video:!0},this.pluginName="janus.plugin.recordplay",this.sdpHelper=new n(this.logger)}configure(e=1048576,s=15e3){return this.transaction("message",{body:{request:"configure","video-bitrate-max":e,"video-keyframe-interval":s}},"success").catch(e=>{throw this.logger.error("RecordPlayJanusPlugin, cannot configure",e),e})}onmessage(e,s){e&&"event"===e.recordplay&&"done"===e.result?this.janus.destroyPlugin(this).catch(e=>{this.logger.error("RecordPlayJanusPlugin, destroyPlugin error in onmessage",e)}):this.logger.error("RecordPlayJanusPlugin got unknown message",e,s)}consume(e){if("message"===e.type){const s={jsep:e.message.jsep,body:{request:"record",name:"hello"}};this.transaction("message",s,"event").then(e=>{const{json:s,data:t}=e;if(!t||!t.result||!t.result.id)return void this.logger.error("RecordPlayJanusPlugin, no recording id in the transaction reply",e);if(this.emit("recordingId",t.result.id),!s||!s.jsep)return void this.logger.error("RecordPlayJanusPlugin, no jsep in the transaction reply",e);const r=s.jsep;this.filterDirectCandidates&&r.sdp&&(r.sdp=this.sdpHelper.filterDirectCandidates(r.sdp)),this.emit("jsep",r)})}else if("candidate"===e.type){if(this.filterDirectCandidates&&e.message.candidate&&this.sdpHelper.isDirectCandidate(e.message.candidate))return;this.transaction("trickle",{candidate:e.message})}else if("stop"===e.type){const e={body:{request:"stop"}};this.transaction("message",e,"event")}else this.logger.error("RecordPlayJanusPlugin unknown data type",e)}}e.exports=i}}]);
//# sourceMappingURL=yarn.techteamer.fc3b938e.js.map