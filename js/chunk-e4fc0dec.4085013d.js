(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-e4fc0dec"],{"0798":function(e,t,r){"use strict";r("caad");var s=r("5530"),n=r("ade3"),i=(r("0c18"),r("10d2")),o=r("afdd"),a=r("9d26"),c=r("f2e7"),u=r("7560"),d=r("f40d"),l=r("58df"),h=r("d9bd");t["a"]=Object(l["a"])(i["a"],c["a"],d["a"]).extend({name:"v-alert",props:{border:{type:String,validator:function(e){return["top","right","bottom","left"].includes(e)}},closeLabel:{type:String,default:"$vuetify.close"},coloredBorder:Boolean,dense:Boolean,dismissible:Boolean,icon:{default:"",type:[Boolean,String],validator:function(e){return"string"===typeof e||!1===e}},outlined:Boolean,prominent:Boolean,text:Boolean,type:{type:String,validator:function(e){return["info","error","success","warning"].includes(e)}},value:{type:Boolean,default:!0}},computed:{__cachedBorder:function(){if(!this.border)return null;var e={staticClass:"v-alert__border",class:Object(n["a"])({},"v-alert__border--".concat(this.border),!0)};return this.coloredBorder&&(e=this.setBackgroundColor(this.computedColor,e),e.class["v-alert__border--has-color"]=!0),this.$createElement("div",e)},__cachedDismissible:function(){var e=this;if(!this.dismissible)return null;var t=this.iconColor;return this.$createElement(o["a"],{staticClass:"v-alert__dismissible",props:{color:t,icon:!0,small:!0},attrs:{"aria-label":this.$vuetify.lang.t(this.closeLabel)},on:{click:function(){return e.isActive=!1}}},[this.$createElement(a["a"],{props:{color:t}},"$cancel")])},__cachedIcon:function(){return this.computedIcon?this.$createElement(a["a"],{staticClass:"v-alert__icon",props:{color:this.iconColor}},this.computedIcon):null},classes:function(){var e=Object(s["a"])({},i["a"].options.computed.classes.call(this),{"v-alert--border":Boolean(this.border),"v-alert--dense":this.dense,"v-alert--outlined":this.outlined,"v-alert--prominent":this.prominent,"v-alert--text":this.text});return this.border&&(e["v-alert--border-".concat(this.border)]=!0),e},computedColor:function(){return this.color||this.type},computedIcon:function(){return!1!==this.icon&&("string"===typeof this.icon&&this.icon?this.icon:!!["error","info","success","warning"].includes(this.type)&&"$".concat(this.type))},hasColoredIcon:function(){return this.hasText||Boolean(this.border)&&this.coloredBorder},hasText:function(){return this.text||this.outlined},iconColor:function(){return this.hasColoredIcon?this.computedColor:void 0},isDark:function(){return!(!this.type||this.coloredBorder||this.outlined)||u["a"].options.computed.isDark.call(this)}},created:function(){this.$attrs.hasOwnProperty("outline")&&Object(h["a"])("outline","outlined",this)},methods:{genWrapper:function(){var e=[this.$slots.prepend||this.__cachedIcon,this.genContent(),this.__cachedBorder,this.$slots.append,this.$scopedSlots.close?this.$scopedSlots.close({toggle:this.toggle}):this.__cachedDismissible],t={staticClass:"v-alert__wrapper"};return this.$createElement("div",t,e)},genContent:function(){return this.$createElement("div",{staticClass:"v-alert__content"},this.$slots.default)},genAlert:function(){var e={staticClass:"v-alert",attrs:{role:"alert"},class:this.classes,style:this.styles,directives:[{name:"show",value:this.isActive}]};if(!this.coloredBorder){var t=this.hasText?this.setTextColor:this.setBackgroundColor;e=t(this.computedColor,e)}return this.$createElement("div",e,[this.genWrapper()])},toggle:function(){this.isActive=!this.isActive}},render:function(e){var t=this.genAlert();return this.transition?e("transition",{props:{name:this.transition,origin:this.origin,mode:this.mode}},[t]):t}})},"0c18":function(e,t,r){},"10a8":function(e,t,r){const s=r("879c"),n=r("9004");class i extends s{constructor(e,t=!1){super(e),this.filterDirectCandidates=!!t,this.janusEchoBody={audio:!0,video:!0},this.pluginName="janus.plugin.streaming",this.sdpHelper=new n(this.logger)}create(e){const t=Object.assign(e,{request:"create"});return this.transaction("message",{body:t},"success").then(({data:e,json:t})=>{if(e.error_code)throw this.logger.error("StreamingJanusPlugin error while create",e),new Error("StreamingJanusPlugin error while create");return{data:e,json:t}}).catch(e=>{throw this.logger.error("StreamingJanusPlugin, cannot create stream",e),e})}destroy(e,t=!1){const r={request:"destroy",id:e,permanent:t};return this.transaction("message",{body:r},"success").catch(e=>{throw this.logger.error("StreamingJanusPlugin, cannot destroy stream",e),e})}list(){const e={request:"list"};return this.transaction("message",{body:e},"success").catch(e=>{throw this.logger.error("StreamingJanusPlugin, cannot list streams",e),e})}watch(e){const t={request:"watch",id:e};return new Promise((e,r)=>{this.transaction("message",{body:t},"event").then(t=>{const{data:r,json:s}=t||{};if(!r||"event"!==r.streaming)throw this.logger.error("StreamingJanusPlugin watch error ",r,s),new Error("StreamingJanusPlugin watch error");if(!s.jsep)throw this.logger.error("StreamingJanusPlugin watch answer does not contains jsep",r,s),new Error("StreamingJanusPlugin watch answer does not contains jsep");r.result&&r.result.status&&this.emit("statusChange",r.result.status);const n=s.jsep;this.filterDirectCandidates&&n.sdp&&(n.sdp=this.sdpHelper.filterDirectCandidates(n.sdp)),this.emit("jsep",n),e(n)}).catch(e=>{this.logger.error("StreamingJanusPlugin, cannot watch stream",e),r(e)})})}start(e){const t={request:"start"},r={body:t};return e&&(r.jsep=e),this.transaction("message",r,"event").then(({data:e,json:t})=>(e.result&&e.result.status&&this.emit("statusChange",e.result.status),{data:e,json:t})).catch(e=>{throw this.logger.error("StreamingJanusPlugin, cannot start stream",e),e})}stop(){const e={request:"stop"};return this.transaction("message",{body:e},"event").then(({data:e,json:t})=>(e.result&&e.result.status&&this.emit("statusChange",e.result.status),{data:e,json:t})).catch(e=>{throw this.logger.error("StreamingJanusPlugin, cannot start stream",e),e})}pause(){const e={request:"pause"};return this.transaction("message",{body:e},"event").then(({data:e,json:t})=>(e.result&&e.result.status&&this.emit("statusChange",e.result.status),{data:e,json:t})).catch(e=>{throw this.logger.error("StreamingJanusPlugin, cannot start stream",e),e})}info(e){const t={request:"info",id:e};return this.transaction("message",{body:t},"success").catch(e=>{throw this.logger.error("StreamingJanusPlugin, cannot start stream",e),e})}switch(e){const t={request:"switch",id:e};return this.transaction("message",{body:t},"event").catch(e=>{throw this.logger.error("StreamingJanusPlugin, cannot start stream",e),e})}onmessage(e,t){e&&"event"===e.streaming&&e.result&&e.result.status?this.emit("statusChange",e.result.status):this.logger.error("StreamingJanusPlugin got unknown message",e,t)}candidate(e){if(!(this.filterDirectCandidates&&e.candidate&&this.sdpHelper.isDirectCandidate(e.candidate)))return this.transaction("trickle",{candidate:e})}}e.exports=i},1113:function(e,t,r){"use strict";r.r(t);var s=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("v-content",[r("v-container",[r("v-card",{staticClass:"mx-auto"},[r("v-toolbar",{attrs:{color:e.navColor,dense:""}},[r("v-toolbar-title",[e._v("Video Streams")]),r("v-spacer"),r("v-btn",{attrs:{to:"/config/video",color:e.navColor}},[r("v-icon",{attrs:{left:""}},[e._v("mdi-plus")]),r("span",[e._v("configure")])],1)],1),r("v-container",{attrs:{fluid:""}},[r("v-row",{attrs:{dense:""}},e._l(e.videostreams,(function(t){return r("v-col",{key:t.key,attrs:{xs:"12",sm:"12",md:"6",lg:"6",xl:"6"}},[r("v-card",{staticClass:"mx-auto",attrs:{raised:""}},[r("v-card-title",{staticClass:"headline"},[r("span",[e._v(e._s(t.name))]),r("v-spacer"),r("v-switch",{attrs:{color:"green",label:t.enabled?"Enabled":"Disabled"},model:{value:t.enabled,callback:function(r){e.$set(t,"enabled",r)},expression:"stream.enabled"}})],1)],1)],1)})),1),Object.keys(e.videostreams).length?e._e():r("v-alert",{attrs:{outlined:"",border:"left",type:"warning"}},[r("span",[e._v("No Video Streams are defined. Please define a video stream in "),r("v-btn",{attrs:{to:"/config/video"}},[e._v("Config->Video")])],1)])],1)],1)],1),r("v-container",{attrs:{fluid:""}},[r("v-row",{attrs:{dense:""}},e._l(e.videostreams,(function(t){return t.enabled?r("v-col",{key:t.key,attrs:{xs:"12",sm:"12",md:"12",lg:"6",xl:"6"}},[r("v-layout",{ref:"layout-"+t.key,refInFor:!0,attrs:{"justify-center":"",wrap:""}},[r("v-card",{staticClass:"mx-auto"},[r("v-system-bar",{attrs:{color:e.navColor,window:""}},[r("span",[e._v("Video Stream: "+e._s(t.name))])]),r("v-card-text",["playing"==e.streamStatus[t.key]?r("v-chip",{staticClass:"ma-2",attrs:{color:"green"}},[r("v-icon",{attrs:{left:""}},[e._v("mdi-check-circle")]),r("span",[e._v("Playing")])],1):"buffering"==e.streamStatus[t.key]||"stop"==t.action?r("v-chip",{staticClass:"ma-2",attrs:{color:"amber"}},[r("v-icon",{attrs:{left:""}},[e._v("mdi-alert")]),r("span",[e._v("Buffering")])],1):r("v-chip",{staticClass:"ma-2",attrs:{color:"red"}},[r("v-icon",{attrs:{left:""}},[e._v("mdi-alert-circle")]),r("span",[e._v("Stopped")])],1),r("span",[e._v("Bitrate"),r("v-chip",{staticClass:"ma-2",attrs:{color:"blue"}},[r("strong",[e._v(e._s(e.cleanBitrate(e.statBitrate[t.key])))])])],1),r("span",[e._v("Packet Loss"),r("v-chip",{staticClass:"ma-2",attrs:{color:"red"}},[r("strong",[e._v(e._s(e.statPacketloss[t.key]))])])],1)],1),r("VideoStream",{attrs:{config:{url:t.webrtcEndpoint},videostream:t.key,width:e.refWidth("layout-"+t.key),stream:1,action:t.action},on:{status:function(r){return e.updateStatus(t.key,r)},packetloss:function(r){return e.updatePacketloss(t.key,r)},bitrate:function(r){return e.updateBitrate(t.key,r)}}})],1)],1)],1):e._e()})),1)],1)],1)},n=[],i=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("video",{staticClass:"ma2 pa0",attrs:{id:e.videostream,controls:"",autoPictureInPicture:"",muted:"",preload:"none",poster:"/img/placeholders/video-placeholder.png",width:e.width},domProps:{muted:!0}})},o=[],a=(r("99af"),r("7db0"),r("4160"),r("a9e3"),r("159b"),r("a811")),c={props:{config:{type:Object,default:null},stream:{type:Number,default:null},width:{type:Number,default:500},videostream:{type:String,default:null},action:{type:String,default:null}},data:function(){return{lastStats:null,streaming:null}},watch:{action:{handler:function(e){this.logDebug("action: ".concat(e,", ").concat(this.action)),"start"==this.action?this.streaming.start():"pause"==this.action?this.stremaing.pause():"stop"==this.action&&this.streaming.stop()}}},beforeDestroy:function(){clearInterval(this.bitrateInterval),clearInterval(this.bufferingInterval)},mounted:function(){var e=this,t=this.janus=new a["Janus"](this.config,console);this.streaming=new a["StreamingJanusPlugin"](console,!1);var r=new RTCPeerConnection,s=0,n=0;this.bitrateInterval=setInterval((function(){var t=r.getReceivers().find((function(e){var t=e.kind;return"video"==t}));r.getStats(t).then((function(t){return t.forEach((function(t){"inbound-rtp"==t.type&&(e.lastStats&&(n=t.packetsLost,s=(t.bytesReceived-e.lastStats.bytesReceived)/(t.lastPacketReceivedTimestamp-e.lastStats.lastPacketReceivedTimestamp)),e.lastStats=t)}))})),e.$emit("bitrate",s),e.$emit("packetloss",n)}),1e3),this.$emit("status","init"),t.connect().then((function(){return t.addPlugin(e.streaming)})).then((function(){return r.onicecandidate=function(t){t.candidate&&t.candidate.candidate?e.streaming.candidate({candidate:t.candidate.candidate,sdpMid:t.candidate.sdpMid,sdpMLineIndex:t.candidate.sdpMLineIndex}):e.streaming.candidate({completed:!0})},r.onaddstream=function(t){var r=document.getElementById(e.videostream);if(r.srcObject=t.stream,r.play(),void 0==e.bufferingInterval){var s=0;e.bufferintInterval=setInterval((function(){s!=r.currentTime||r.paused?e.$emit("status","playing"):e.$emit("status","buffering"),s=r.currentTime}),500)}},e.streaming.on("statusChange",(function(t){e.$emit("status",t)})),e.streaming.watch(e.stream)})).then((function(e){return r.setRemoteDescription(new RTCSessionDescription(e))})).then((function(){return r.createAnswer({offerToReceiveAudio:!0,offerToReceiveVideo:!0})})).then((function(t){return r.setLocalDescription(t),e.streaming.start(t)})).then((function(e){e.body,e.json}))},methods:{}},u=c,d=r("2877"),l=Object(d["a"])(u,i,o,!1,null,null,null),h=l.exports,p={name:"VideoModule",components:{VideoStream:h},data:function(){return{actionState:"start",streamStatus:{nano:null,raspberry:null},statBitrate:{nano:null,raspberry:null},statPacketloss:{nano:null,raspberry:null},bitrate:"256",resolution:"720p",activeStream:null,width:500}},computed:{videostreams:function(){return this.$store.state.data.videostreams}},watch:{},mounted:function(){var e=this;window.addEventListener("resize",(function(){e.width=.75*window.innerWidth}))},methods:{updateStatus:function(e,t){this.streamStatus.hasOwnProperty(e)?this.streamStatus[e]=t:this.$set(this.streamStatus,e,t)},updateBitrate:function(e,t){this.statBitrate.hasOwnProperty(e)?this.statBitrate[e]=t:this.$set(this.statBitrate,e,t)},updatePacketloss:function(e,t){this.statPacketloss.hasOwnProperty(e)?this.statPacketloss[e]=t:this.$set(this.statPacketloss,e,t)},changeStream:function(e){this.activeStream=e},cleanBitrate:function(e){return e/1e3<1e3?Math.round(e/1e3)+" K":Math.round(e/1e6)+" M"},refWidth:function(e){var t=null;try{t=this.$refs[e][0].clientWidth}catch(r){}return t}}},m=p,g=r("6544"),f=r.n(g),v=r("0798"),y=r("8336"),w=r("b0af"),b=r("99d9"),P=r("cc20"),j=r("62ad"),C=r("a523"),S=r("a75b"),_=r("132d"),I=r("a722"),x=r("0fd9"),k=r("2fa4"),R=r("b73d"),E=r("afd9"),T=r("71d9"),L=r("2a7f"),J=Object(d["a"])(m,s,n,!1,null,"7251af48",null);t["default"]=J.exports;f()(J,{VAlert:v["a"],VBtn:y["a"],VCard:w["a"],VCardText:b["b"],VCardTitle:b["c"],VChip:P["a"],VCol:j["a"],VContainer:C["a"],VContent:S["a"],VIcon:_["a"],VLayout:I["a"],VRow:x["a"],VSpacer:k["a"],VSwitch:R["a"],VSystemBar:E["a"],VToolbar:T["a"],VToolbarTitle:L["b"]})},2366:function(e,t){for(var r=[],s=0;s<256;++s)r[s]=(s+256).toString(16).substr(1);function n(e,t){var s=t||0,n=r;return[n[e[s++]],n[e[s++]],n[e[s++]],n[e[s++]],"-",n[e[s++]],n[e[s++]],"-",n[e[s++]],n[e[s++]],"-",n[e[s++]],n[e[s++]],"-",n[e[s++]],n[e[s++]],n[e[s++]],n[e[s++]],n[e[s++]],n[e[s++]]].join("")}e.exports=n},"282b":function(e,t,r){"use strict";var s={generateIdentifier:function(){return Math.random().toString(36).substr(2,10)}};s.localCName=s.generateIdentifier(),s.splitLines=function(e){return e.trim().split("\n").map((function(e){return e.trim()}))},s.splitSections=function(e){var t=e.split("\nm=");return t.map((function(e,t){return(t>0?"m="+e:e).trim()+"\r\n"}))},s.getDescription=function(e){var t=s.splitSections(e);return t&&t[0]},s.getMediaSections=function(e){var t=s.splitSections(e);return t.shift(),t},s.matchPrefix=function(e,t){return s.splitLines(e).filter((function(e){return 0===e.indexOf(t)}))},s.parseCandidate=function(e){var t;t=0===e.indexOf("a=candidate:")?e.substring(12).split(" "):e.substring(10).split(" ");for(var r={foundation:t[0],component:parseInt(t[1],10),protocol:t[2].toLowerCase(),priority:parseInt(t[3],10),ip:t[4],address:t[4],port:parseInt(t[5],10),type:t[7]},s=8;s<t.length;s+=2)switch(t[s]){case"raddr":r.relatedAddress=t[s+1];break;case"rport":r.relatedPort=parseInt(t[s+1],10);break;case"tcptype":r.tcpType=t[s+1];break;case"ufrag":r.ufrag=t[s+1],r.usernameFragment=t[s+1];break;default:r[t[s]]=t[s+1];break}return r},s.writeCandidate=function(e){var t=[];t.push(e.foundation),t.push(e.component),t.push(e.protocol.toUpperCase()),t.push(e.priority),t.push(e.address||e.ip),t.push(e.port);var r=e.type;return t.push("typ"),t.push(r),"host"!==r&&e.relatedAddress&&e.relatedPort&&(t.push("raddr"),t.push(e.relatedAddress),t.push("rport"),t.push(e.relatedPort)),e.tcpType&&"tcp"===e.protocol.toLowerCase()&&(t.push("tcptype"),t.push(e.tcpType)),(e.usernameFragment||e.ufrag)&&(t.push("ufrag"),t.push(e.usernameFragment||e.ufrag)),"candidate:"+t.join(" ")},s.parseIceOptions=function(e){return e.substr(14).split(" ")},s.parseRtpMap=function(e){var t=e.substr(9).split(" "),r={payloadType:parseInt(t.shift(),10)};return t=t[0].split("/"),r.name=t[0],r.clockRate=parseInt(t[1],10),r.channels=3===t.length?parseInt(t[2],10):1,r.numChannels=r.channels,r},s.writeRtpMap=function(e){var t=e.payloadType;void 0!==e.preferredPayloadType&&(t=e.preferredPayloadType);var r=e.channels||e.numChannels||1;return"a=rtpmap:"+t+" "+e.name+"/"+e.clockRate+(1!==r?"/"+r:"")+"\r\n"},s.parseExtmap=function(e){var t=e.substr(9).split(" ");return{id:parseInt(t[0],10),direction:t[0].indexOf("/")>0?t[0].split("/")[1]:"sendrecv",uri:t[1]}},s.writeExtmap=function(e){return"a=extmap:"+(e.id||e.preferredId)+(e.direction&&"sendrecv"!==e.direction?"/"+e.direction:"")+" "+e.uri+"\r\n"},s.parseFmtp=function(e){for(var t,r={},s=e.substr(e.indexOf(" ")+1).split(";"),n=0;n<s.length;n++)t=s[n].trim().split("="),r[t[0].trim()]=t[1];return r},s.writeFmtp=function(e){var t="",r=e.payloadType;if(void 0!==e.preferredPayloadType&&(r=e.preferredPayloadType),e.parameters&&Object.keys(e.parameters).length){var s=[];Object.keys(e.parameters).forEach((function(t){e.parameters[t]?s.push(t+"="+e.parameters[t]):s.push(t)})),t+="a=fmtp:"+r+" "+s.join(";")+"\r\n"}return t},s.parseRtcpFb=function(e){var t=e.substr(e.indexOf(" ")+1).split(" ");return{type:t.shift(),parameter:t.join(" ")}},s.writeRtcpFb=function(e){var t="",r=e.payloadType;return void 0!==e.preferredPayloadType&&(r=e.preferredPayloadType),e.rtcpFeedback&&e.rtcpFeedback.length&&e.rtcpFeedback.forEach((function(e){t+="a=rtcp-fb:"+r+" "+e.type+(e.parameter&&e.parameter.length?" "+e.parameter:"")+"\r\n"})),t},s.parseSsrcMedia=function(e){var t=e.indexOf(" "),r={ssrc:parseInt(e.substr(7,t-7),10)},s=e.indexOf(":",t);return s>-1?(r.attribute=e.substr(t+1,s-t-1),r.value=e.substr(s+1)):r.attribute=e.substr(t+1),r},s.parseSsrcGroup=function(e){var t=e.substr(13).split(" ");return{semantics:t.shift(),ssrcs:t.map((function(e){return parseInt(e,10)}))}},s.getMid=function(e){var t=s.matchPrefix(e,"a=mid:")[0];if(t)return t.substr(6)},s.parseFingerprint=function(e){var t=e.substr(14).split(" ");return{algorithm:t[0].toLowerCase(),value:t[1]}},s.getDtlsParameters=function(e,t){var r=s.matchPrefix(e+t,"a=fingerprint:");return{role:"auto",fingerprints:r.map(s.parseFingerprint)}},s.writeDtlsParameters=function(e,t){var r="a=setup:"+t+"\r\n";return e.fingerprints.forEach((function(e){r+="a=fingerprint:"+e.algorithm+" "+e.value+"\r\n"})),r},s.parseCryptoLine=function(e){var t=e.substr(9).split(" ");return{tag:parseInt(t[0],10),cryptoSuite:t[1],keyParams:t[2],sessionParams:t.slice(3)}},s.writeCryptoLine=function(e){return"a=crypto:"+e.tag+" "+e.cryptoSuite+" "+("object"===typeof e.keyParams?s.writeCryptoKeyParams(e.keyParams):e.keyParams)+(e.sessionParams?" "+e.sessionParams.join(" "):"")+"\r\n"},s.parseCryptoKeyParams=function(e){if(0!==e.indexOf("inline:"))return null;var t=e.substr(7).split("|");return{keyMethod:"inline",keySalt:t[0],lifeTime:t[1],mkiValue:t[2]?t[2].split(":")[0]:void 0,mkiLength:t[2]?t[2].split(":")[1]:void 0}},s.writeCryptoKeyParams=function(e){return e.keyMethod+":"+e.keySalt+(e.lifeTime?"|"+e.lifeTime:"")+(e.mkiValue&&e.mkiLength?"|"+e.mkiValue+":"+e.mkiLength:"")},s.getCryptoParameters=function(e,t){var r=s.matchPrefix(e+t,"a=crypto:");return r.map(s.parseCryptoLine)},s.getIceParameters=function(e,t){var r=s.matchPrefix(e+t,"a=ice-ufrag:")[0],n=s.matchPrefix(e+t,"a=ice-pwd:")[0];return r&&n?{usernameFragment:r.substr(12),password:n.substr(10)}:null},s.writeIceParameters=function(e){return"a=ice-ufrag:"+e.usernameFragment+"\r\na=ice-pwd:"+e.password+"\r\n"},s.parseRtpParameters=function(e){for(var t={codecs:[],headerExtensions:[],fecMechanisms:[],rtcp:[]},r=s.splitLines(e),n=r[0].split(" "),i=3;i<n.length;i++){var o=n[i],a=s.matchPrefix(e,"a=rtpmap:"+o+" ")[0];if(a){var c=s.parseRtpMap(a),u=s.matchPrefix(e,"a=fmtp:"+o+" ");switch(c.parameters=u.length?s.parseFmtp(u[0]):{},c.rtcpFeedback=s.matchPrefix(e,"a=rtcp-fb:"+o+" ").map(s.parseRtcpFb),t.codecs.push(c),c.name.toUpperCase()){case"RED":case"ULPFEC":t.fecMechanisms.push(c.name.toUpperCase());break;default:break}}}return s.matchPrefix(e,"a=extmap:").forEach((function(e){t.headerExtensions.push(s.parseExtmap(e))})),t},s.writeRtpDescription=function(e,t){var r="";r+="m="+e+" ",r+=t.codecs.length>0?"9":"0",r+=" UDP/TLS/RTP/SAVPF ",r+=t.codecs.map((function(e){return void 0!==e.preferredPayloadType?e.preferredPayloadType:e.payloadType})).join(" ")+"\r\n",r+="c=IN IP4 0.0.0.0\r\n",r+="a=rtcp:9 IN IP4 0.0.0.0\r\n",t.codecs.forEach((function(e){r+=s.writeRtpMap(e),r+=s.writeFmtp(e),r+=s.writeRtcpFb(e)}));var n=0;return t.codecs.forEach((function(e){e.maxptime>n&&(n=e.maxptime)})),n>0&&(r+="a=maxptime:"+n+"\r\n"),r+="a=rtcp-mux\r\n",t.headerExtensions&&t.headerExtensions.forEach((function(e){r+=s.writeExtmap(e)})),r},s.parseRtpEncodingParameters=function(e){var t,r=[],n=s.parseRtpParameters(e),i=-1!==n.fecMechanisms.indexOf("RED"),o=-1!==n.fecMechanisms.indexOf("ULPFEC"),a=s.matchPrefix(e,"a=ssrc:").map((function(e){return s.parseSsrcMedia(e)})).filter((function(e){return"cname"===e.attribute})),c=a.length>0&&a[0].ssrc,u=s.matchPrefix(e,"a=ssrc-group:FID").map((function(e){var t=e.substr(17).split(" ");return t.map((function(e){return parseInt(e,10)}))}));u.length>0&&u[0].length>1&&u[0][0]===c&&(t=u[0][1]),n.codecs.forEach((function(e){if("RTX"===e.name.toUpperCase()&&e.parameters.apt){var s={ssrc:c,codecPayloadType:parseInt(e.parameters.apt,10)};c&&t&&(s.rtx={ssrc:t}),r.push(s),i&&(s=JSON.parse(JSON.stringify(s)),s.fec={ssrc:c,mechanism:o?"red+ulpfec":"red"},r.push(s))}})),0===r.length&&c&&r.push({ssrc:c});var d=s.matchPrefix(e,"b=");return d.length&&(d=0===d[0].indexOf("b=TIAS:")?parseInt(d[0].substr(7),10):0===d[0].indexOf("b=AS:")?1e3*parseInt(d[0].substr(5),10)*.95-16e3:void 0,r.forEach((function(e){e.maxBitrate=d}))),r},s.parseRtcpParameters=function(e){var t={},r=s.matchPrefix(e,"a=ssrc:").map((function(e){return s.parseSsrcMedia(e)})).filter((function(e){return"cname"===e.attribute}))[0];r&&(t.cname=r.value,t.ssrc=r.ssrc);var n=s.matchPrefix(e,"a=rtcp-rsize");t.reducedSize=n.length>0,t.compound=0===n.length;var i=s.matchPrefix(e,"a=rtcp-mux");return t.mux=i.length>0,t},s.parseMsid=function(e){var t,r=s.matchPrefix(e,"a=msid:");if(1===r.length)return t=r[0].substr(7).split(" "),{stream:t[0],track:t[1]};var n=s.matchPrefix(e,"a=ssrc:").map((function(e){return s.parseSsrcMedia(e)})).filter((function(e){return"msid"===e.attribute}));return n.length>0?(t=n[0].value.split(" "),{stream:t[0],track:t[1]}):void 0},s.parseSctpDescription=function(e){var t,r=s.parseMLine(e),n=s.matchPrefix(e,"a=max-message-size:");n.length>0&&(t=parseInt(n[0].substr(19),10)),isNaN(t)&&(t=65536);var i=s.matchPrefix(e,"a=sctp-port:");if(i.length>0)return{port:parseInt(i[0].substr(12),10),protocol:r.fmt,maxMessageSize:t};var o=s.matchPrefix(e,"a=sctpmap:");if(o.length>0){var a=s.matchPrefix(e,"a=sctpmap:")[0].substr(10).split(" ");return{port:parseInt(a[0],10),protocol:a[1],maxMessageSize:t}}},s.writeSctpDescription=function(e,t){var r=[];return r="DTLS/SCTP"!==e.protocol?["m="+e.kind+" 9 "+e.protocol+" "+t.protocol+"\r\n","c=IN IP4 0.0.0.0\r\n","a=sctp-port:"+t.port+"\r\n"]:["m="+e.kind+" 9 "+e.protocol+" "+t.port+"\r\n","c=IN IP4 0.0.0.0\r\n","a=sctpmap:"+t.port+" "+t.protocol+" 65535\r\n"],void 0!==t.maxMessageSize&&r.push("a=max-message-size:"+t.maxMessageSize+"\r\n"),r.join("")},s.generateSessionId=function(){return Math.random().toString().substr(2,21)},s.writeSessionBoilerplate=function(e,t,r){var n,i=void 0!==t?t:2;n=e||s.generateSessionId();var o=r||"thisisadapterortc";return"v=0\r\no="+o+" "+n+" "+i+" IN IP4 127.0.0.1\r\ns=-\r\nt=0 0\r\n"},s.writeMediaSection=function(e,t,r,n){var i=s.writeRtpDescription(e.kind,t);if(i+=s.writeIceParameters(e.iceGatherer.getLocalParameters()),i+=s.writeDtlsParameters(e.dtlsTransport.getLocalParameters(),"offer"===r?"actpass":"active"),i+="a=mid:"+e.mid+"\r\n",e.direction?i+="a="+e.direction+"\r\n":e.rtpSender&&e.rtpReceiver?i+="a=sendrecv\r\n":e.rtpSender?i+="a=sendonly\r\n":e.rtpReceiver?i+="a=recvonly\r\n":i+="a=inactive\r\n",e.rtpSender){var o="msid:"+n.id+" "+e.rtpSender.track.id+"\r\n";i+="a="+o,i+="a=ssrc:"+e.sendEncodingParameters[0].ssrc+" "+o,e.sendEncodingParameters[0].rtx&&(i+="a=ssrc:"+e.sendEncodingParameters[0].rtx.ssrc+" "+o,i+="a=ssrc-group:FID "+e.sendEncodingParameters[0].ssrc+" "+e.sendEncodingParameters[0].rtx.ssrc+"\r\n")}return i+="a=ssrc:"+e.sendEncodingParameters[0].ssrc+" cname:"+s.localCName+"\r\n",e.rtpSender&&e.sendEncodingParameters[0].rtx&&(i+="a=ssrc:"+e.sendEncodingParameters[0].rtx.ssrc+" cname:"+s.localCName+"\r\n"),i},s.getDirection=function(e,t){for(var r=s.splitLines(e),n=0;n<r.length;n++)switch(r[n]){case"a=sendrecv":case"a=sendonly":case"a=recvonly":case"a=inactive":return r[n].substr(2);default:}return t?s.getDirection(t):"sendrecv"},s.getKind=function(e){var t=s.splitLines(e),r=t[0].split(" ");return r[0].substr(2)},s.isRejected=function(e){return"0"===e.split(" ",2)[1]},s.parseMLine=function(e){var t=s.splitLines(e),r=t[0].substr(2).split(" ");return{kind:r[0],port:parseInt(r[1],10),protocol:r[2],fmt:r.slice(3).join(" ")}},s.parseOLine=function(e){var t=s.matchPrefix(e,"o=")[0],r=t.substr(2).split(" ");return{username:r[0],sessionId:r[1],sessionVersion:parseInt(r[2],10),netType:r[3],addressType:r[4],address:r[5]}},s.isValidSDP=function(e){if("string"!==typeof e||0===e.length)return!1;for(var t=s.splitLines(e),r=0;r<t.length;r++)if(t[r].length<2||"="!==t[r].charAt(1))return!1;return!0},e.exports=s},"2e2a":function(e,t,r){const s=r("517b"),n=r("879c"),i=r("c64e"),o=[458,459];class a{constructor(e,t){this.ws=void 0,this.isConnected=!1,this.sessionId=void 0,this.logger=t,this.transactions={},this.pluginHandles={},this.config=e,this.protocol="janus-protocol",this.sendCreate=!0}connect(){return this.isConnected?Promise.resolve(this):new Promise((e,t)=>{this.ws=new s(this.config.url,this.protocol,this.config.options),this.ws.addEventListener("error",e=>{this.logger.error("Error connecting to the Janus WebSockets server...",e),this.isConnected=!1,t(e)}),this.ws.addEventListener("close",()=>{this.cleanup()}),this.ws.addEventListener("open",()=>{if(!this.sendCreate)return this.isConnected=!0,this.keepAlive(!0),e(this);const r=i(),s={janus:"create",transaction:r};this.transactions[r]={resolve:r=>{if("success"!==r.janus)return this.logger.error("Cannot connect to Janus",r),void t(r);this.sessionId=r.data.id,this.isConnected=!0,this.keepAlive(!0),this.logger.debug("Janus connected, sessionId: ",this.sessionId),e(this)},reject:t,replyType:"success"},this.ws.send(JSON.stringify(s))}),this.ws.addEventListener("message",e=>{this.onMessage(e)}),this.ws.addEventListener("close",()=>{this.onClose()})})}addPlugin(e){if(!(e instanceof n))return Promise.reject(new Error("plugin is not a JanusPlugin"));const t=e.getAttachPayload();return this.transaction("attach",t,"success").then(t=>{if("success"!==t.janus)throw this.logger.error("Cannot add plugin",t),e.error(t),new Error(t);return this.pluginHandles[t.data.id]=e,e.success(this,t.data.id)})}transaction(e,t,r,s){r||(r="ack");const n=i();return new Promise((i,o)=>{if(s&&setTimeout(()=>{o(new Error("Transaction timed out after "+s+" ms"))},s),!this.isConnected)return void o(new Error("Janus is not connected"));const a=Object.assign({},t,{janus:e,session_id:t&&parseInt(t.session_id,10)||this.sessionId,transaction:n});this.transactions[a.transaction]={resolve:i,reject:o,replyType:r,request:a},this.ws.send(JSON.stringify(a))})}send(e,t){return new Promise((r,s)=>{if(!this.isConnected)return void s(new Error("Janus is not connected"));const n=Object.assign({},t,{janus:e,session_id:this.sessionId,transaction:i()});this.logger.debug("Janus sending",n),this.ws.send(JSON.stringify(n),{},e=>{e?s(e):r()})})}destroy(){return this.isConnected?this.transaction("destroy",{},"success",5e3).then(()=>{this.cleanup()}).catch(()=>{this.cleanup()}):Promise.resolve()}destroyPlugin(e){return new Promise((t,r)=>{e instanceof n?this.pluginHandles[e.janusHandleId]?this.transaction("detach",{plugin:e.pluginName,handle_id:e.janusHandleId},"success",5e3).then(()=>{delete this.pluginHandles[e.pluginName],e.detach(),t()}).catch(t=>{delete this.pluginHandles[e.pluginName],e.detach(),r(t)}):r(new Error("unknown plugin")):r(new Error("plugin is not a JanusPlugin"))})}onMessage(e){let t;try{t=JSON.parse(e.data)}catch(r){return void this.logger.error("cannot parse message",e.data)}if("timeout"!==t.janus||t.session_id===this.sessionId){if("keepalive"!==t.janus)if("ack"!==t.janus){if("success"===t.janus){const e=this.getTransaction(t);if(!e)return;const r=t.plugindata;if(void 0===r||null===r)return void e.resolve(t);const s=t.sender;if(!s)return e.resolve(t),void this.logger.error("Missing sender for plugindata",t);const n=this.pluginHandles[s];return n?void e.resolve({data:r.data,json:t}):void this.logger.error("This handle is not attached to this session",t)}if("webrtcup"===t.janus){const e=t.sender;if(!e)return void this.logger.warn("Missing sender...");const r=this.pluginHandles[e];return r?void r.webrtcState(!0):void this.logger.error("This handle is not attached to this session",e)}if("hangup"===t.janus){const e=t.sender;if(!e)return void this.logger.warn("Missing sender...");const r=this.pluginHandles[e];return r?(r.webrtcState(!1,t.reason),void r.hangup()):void this.logger.error("This handle is not attached to this session",e)}if("detached"===t.janus){const e=t.sender;return e?void 0:void this.logger.warn("Missing sender...")}if("media"===t.janus){const e=t.sender;if(!e)return void this.logger.warn("Missing sender...");const r=this.pluginHandles[e];return r?void r.mediaState(t.type,t.receiving):void this.logger.error("This handle is not attached to this session",e)}if("slowlink"===t.janus){this.logger.debug("Got a slowlink event on session "+this.sessionId),this.logger.debug(t);const e=t.sender;if(!e)return void this.logger.warn("Missing sender...");const r=this.pluginHandles[e];return r?void r.slowLink(t.uplink,t.nacks):void this.logger.error("This handle is not attached to this session",e)}if("error"!==t.janus){if("event"===t.janus){const e=t.sender;if(!e)return void this.logger.warn("Missing sender...");const r=t.plugindata;if(void 0===r||null===r)return void this.logger.error("Missing plugindata...");const s=this.pluginHandles[e];if(!s)return void this.logger.error("This handle is not attached to this session",e);const n=r.data,i=this.getTransaction(t);return i?void(n.error_code?i.reject({data:n,json:t}):i.resolve({data:n,json:t})):void s.onmessage(n,t)}this.logger.warn("Unknown message/event "+t.janus+" on session "+this.sessionId),this.logger.debug(t)}else{t.error&&t.error.code&&!o.includes(t.error.code)&&this.logger.error("Janus error response"+t);const e=this.getTransaction(t,!0);e&&e.reject&&(e.request&&this.logger.debug("Janus Error: rejecting transaction",e.request,t),e.reject(t))}}else{const e=this.getTransaction(t);e&&e.resolve&&e.resolve(t)}}else this.logger.debug("GOT timeout from another websocket")}onClose(){this.isConnected&&(this.isConnected=!1,this.logger.error("Lost connection to the gateway (is it down?)"))}keepAlive(e){this.ws&&this.isConnected&&this.sessionId&&(e?setTimeout(()=>{this.keepAlive()},this.config.keepAliveIntervalMs):this.transaction("keepalive").then(()=>{setTimeout(()=>{this.keepAlive()},this.config.keepAliveIntervalMs)}).catch(e=>{this.logger.warn("Janus keepalive error",e)}))}getTransaction(e,t=!1){const r=e.janus,s=e.transaction;if(s&&Object.prototype.hasOwnProperty.call(this.transactions,s)&&(t||this.transactions[s].replyType===r)){const e=this.transactions[s];return delete this.transactions[s],e}}cleanup(){this._cleanupPlugins(),this._cleanupWebSocket(),this._cleanupTransactions()}_cleanupWebSocket(){this.ws&&(this.ws.removeAllListeners(),this.ws.readyState===s.OPEN&&this.ws.close()),this.ws=void 0,this.isConnected=!1}_cleanupPlugins(){Object.keys(this.pluginHandles).forEach(e=>{const t=this.pluginHandles[e];delete this.pluginHandles[e],t.detach()})}_cleanupTransactions(){Object.keys(this.transactions).forEach(e=>{const t=this.transactions[e];t.reject&&t.reject()}),this.transactions={}}}e.exports=a},"42e8":function(e,t,r){const s=r("879c"),n=r("9004"),i=r("282b");class o extends s{constructor(e,t,r,s=!1){if(!e)throw new Error("unknown config");super(r),this.display=t,this.pluginName="janus.plugin.videoroom",this.janusRoomId=void 0,this.janusRoomMemberId=void 0,this.janusRoomPrivateMemberId=void 0,this.filterDirectCandidates=!!s,this.config=e,this.sdpHelper=new n(this.logger),this.offerSdp=void 0,this.answerSdp=void 0,this.rtpForwardVideoStreamId=void 0,this.rtpForwardAudioStreamId=void 0,this.rtpForwardDataStreamId=void 0}startRTPForward(e,t,r){const s={request:"rtp_forward",room:this.janusRoomId,publisher_id:this.janusRoomMemberId,host:e};return t&&(s.video_port=t),r&&(s.audio_port=r),this.transaction("message",{body:s},"success").then(({data:s,json:n})=>{s&&s.rtp_stream&&s.rtp_stream.video_stream_id&&(this.rtpForwardVideoStreamId=s.rtp_stream.video_stream_id),s&&s.rtp_stream&&s.rtp_stream.audio_stream_id&&(this.rtpForwardAudioStreamId=s.rtp_stream.audio_stream_id),s&&s.rtp_stream&&s.rtp_stream.data_stream_id&&(this.rtpForwardDataStreamId=s.rtp_stream.data_stream_id);let o="v=0\n"+`o=- 0 0 IN IP4 ${e}\n`+`s=janus-api:${this.janusRoomId}.${this.janusRoomMemberId}\n`+`c=IN IP4 ${e}\n`+"t=0 0\na=tool:janus-api\n";return i.splitSections(this.answerSdp).forEach((e,s)=>{if(0===s)return;const n=i.getMid(e),a=i.parseRtpParameters(e),c=a.codecs[0];c&&("video"===n&&t&&(o+=`m=video ${t} RTP/AVP ${c.payloadType}\n`+`a=rtpmap:${c.payloadType} ${c.name}/${c.clockRate}\n`+"a=fmtp:11 packetization-mode=1\na=rtcp-mux\n"),"audio"===n&&r&&(o+=`m=audio ${r} RTP/AVP ${c.payloadType}\n`+`a=rtpmap:${c.payloadType} ${c.name}/${c.clockRate}\n`+"a=fmtp:11 packetization-mode=1\na=rtcp-mux\n"))}),o}).catch(e=>{throw this.logger.error("VideoRoomPublisherJanusPlugin, cannot RTP forward",e),e})}stopRTPForward(){const e=[];return this.rtpForwardVideoStreamId&&e.push(this.stopRTPForwardStream(this.rtpForwardVideoStreamId)),this.rtpForwardAudioStreamId&&e.push(this.stopRTPForwardStream(this.rtpForwardAudioStreamId)),this.rtpForwardDataStreamId&&e.push(this.stopRTPForwardStream(this.rtpForwardDataStreamId)),Promise.all(e)}stopRTPForwardStream(e){const t={request:"stop_rtp_forward",room:this.janusRoomId,publisher_id:this.janusRoomMemberId,stream_id:e};return this.transaction("message",{body:t},"success").catch(e=>{throw this.logger.error("VideoRoomPublisherJanusPlugin, cannot stop RTP forward",e),e})}setRoomBitrate(e){const t={request:"edit",room:this.janusRoomId,new_bitrate:e};return this.transaction("message",{body:t},"success").catch(e=>{throw this.logger.error("VideoRoomPublisherJanusPlugin, cannot set room bitrate",e),e})}connect(){return this.transaction("message",{body:{request:"list"}},"success").then(e=>{const{data:t}=e||{};if(!t||!Array.isArray(t.list))throw this.logger.error("VideoRoomPublisherJanusPlugin, could not find roomList",t),new Error("VideoRoomPublisherJanusPlugin, could not find roomList");const r=t.list.find(e=>e.description===""+this.config.id);return r?(this.janusRoomId=r.room,this.join()):this.createRoom()}).catch(e=>{throw this.logger.error("VideoRoomPublisherJanusPlugin, cannot list rooms",e),e})}join(){const e={request:"join",room:this.janusRoomId,ptype:"publisher",display:this.display};return new Promise((t,r)=>{this.transaction("message",{body:e},"event").then(e=>{const{data:r}=e||{};if(!r||!r.id||!r.private_id||!r.publishers)throw this.logger.error("VideoRoomPublisherJanusPlugin, could not join room",r),new Error("VideoRoomPublisherJanusPlugin, could not join room");this.janusRoomMemberId=r.id,this.janusRoomPrivateMemberId=r.private_id,t(r.publishers)}).catch(e=>{e&&426===e.error_code?this.createRoom().then(t).catch(r):(this.logger.error("VideoRoomPublisherJanusPlugin, unknown error connecting to room",e),r(e))})})}createRoom(){const e={request:"create",description:""+this.config.id,record:this.config.record,videocodec:this.config.codec,rec_dir:this.config.recordDirectory,publishers:this.config.publishers,videoorient_ext:this.config.videoOrientExt};return this.config.bitrate&&(e.bitrate=this.config.bitrate),this.config.firSeconds&&(e.fir_freq=this.config.firSeconds),this.transaction("message",{body:e},"success").then(e=>{const{data:t}=e||{};if(!t||!t.room)throw this.logger.error("VideoRoomPublisherJanusPlugin, could not create room",t),new Error("VideoRoomPublisherJanusPlugin, could not create room");return this.janusRoomId=t.room,this.join()}).catch(e=>{throw this.logger.error("VideoRoomPublisherJanusPlugin, cannot create room",e),e})}configure(e,t=!0,r=!0){if(!this.janusRoomMemberId)return void this.logger.error("VideoRoomPublisherJanusPlugin, cannot configure without janusRoomMemberId");const s={request:"configure",audio:t,video:r},n=e;return this.filterDirectCandidates&&n.sdp&&(n.sdp=this.sdpHelper.filterDirectCandidates(n.sdp)),this.offerSdp=n.sdp,this.transaction("message",{body:s,jsep:n},"event").then(e=>{const{json:t}=e||{};if(!t.jsep)throw new Error("cannot configure");const r=t.jsep;return this.filterDirectCandidates&&r.sdp&&(r.sdp=this.sdpHelper.filterDirectCandidates(r.sdp)),this.answerSdp=r.sdp,r})}candidate(e){if(!(this.filterDirectCandidates&&e.candidate&&this.sdpHelper.isDirectCandidate(e.candidate)))return this.transaction("trickle",{candidate:e})}onmessage(e,t){const{videoroom:r,room:s,unpublished:n,leaving:i,publishers:o}=e;e&&r&&"event"===r?s===this.janusRoomId?n?this.emit("remoteMemberUnpublished",n):i?this.emit("remoteMemberLeaving",i):Array.isArray(o)?this.emit("publishersUpdated",o):this.logger.error("VideoRoomPublisherJanusPlugin got unknown event",t):this.logger.error("VideoRoomPublisherJanusPlugin got unknown roomId",this.janusRoomId,t):this.logger.error("VideoRoomPublisherJanusPlugin got unknown message",t)}}e.exports=o},"517b":function(e,t,r){let s;try{s=r("9043")}catch(n){window.WebSocket.prototype.removeAllListeners=()=>{}}e.exports=s||window.WebSocket},"6f86":function(e,t,r){const s=r("2e2a");class n extends s{constructor(e,t){super(e,t),this.config=e,this.protocol="janus-admin-protocol",this.sendCreate=!1}transaction(e,t,r){const s=Object.assign({},t,{admin_secret:this.config.secret});return super.transaction(e,s,r||"success")}listSessions(){return this.transaction("list_sessions").then(e=>e.sessions)}listHandles(e){return this.transaction("list_handles",{session_id:e}).then(e=>e.handles)}handleInfo(e,t){return this.transaction("handle_info",{session_id:e,handle_id:t}).then(e=>e.info)}}e.exports=n},"777c":function(e,t,r){const s=r("879c"),n=r("9004");class i extends s{constructor(e,t=!1){super(e),this.filterDirectCandidates=!!t,this.janusEchoBody={audio:!0,video:!0},this.pluginName="janus.plugin.echotest",this.sdpHelper=new n(this.logger)}mute(e=!1){return this.transaction("message",{audio:!e},"success").catch(e=>{throw this.logger.error("EchoJanusPlugin, cannot mute",e),e})}connect(){return this.transaction("message",{body:this.janusEchoBody},"event").catch(e=>{throw this.logger.error("EchoJanusPlugin error during connect",e),e})}onmessage(e,t){e&&"event"===e.echotest&&"done"===e.result?this.janus.destroyPlugin(this).catch(e=>{this.logger.error("EchoJanusPlugin, destroyPlugin error in onmessage",e)}):this.logger.error("EchoJanusPlugin got unknown message",e,t)}consume(e){if("message"===e.type){const t={jsep:e.message.jsep,body:this.janusEchoBody};return this.transaction("message",t,"event").then(e=>{const{json:t}=e;if(!t||!t.jsep)return void this.logger.error("EchoJanusPlugin, no jsep in the transaction reply",e);const r=t.jsep;this.filterDirectCandidates&&r.sdp&&(r.sdp=this.sdpHelper.filterDirectCandidates(r.sdp)),this.emit("jsep",r)}).catch(e=>{throw this.logger.error("EchoJanusPlugin, message error in consume",e),e})}return"candidate"===e.type?this.filterDirectCandidates&&e.message.candidate&&this.sdpHelper.isDirectCandidate(e.message.candidate)?Promise.resolve():this.transaction("trickle",{candidate:e.message}).catch(e=>{throw this.logger.error("EchoJanusPlugin, candidate error in consume",e),e}):(this.logger.error("EchoTransportSession unknown data type",e),Promise.reject(new Error("EchoTransportSession unknown data type")))}}e.exports=i},"879c":function(e,t,r){const s=r("c64e"),n=r("faa1");class i extends n{constructor(e){super(),this.id=s(),this.janus=void 0,this.janusHandleId=void 0,this.pluginName=void 0,this.logger=e}getAttachPayload(){return{plugin:this.pluginName,opaque_id:this.id}}transaction(e,t,r){const s=Object.assign({},t,{handle_id:this.janusHandleId});return this.janus?this.janus.transaction(e,s,r):Promise.reject(new Error("JanusPlugin is not connected"))}success(e,t){return this.janus=e,this.janusHandleId=t,this}error(e){}onmessage(e,t){this.logger.error("Unhandled message from janus in a plugin: "+this.constructor.name,e,t)}oncleanup(){}detached(){}hangup(){this.emit("hangup")}slowLink(){this.emit("slowlink")}mediaState(e,t){this.emit("mediaState",e,t)}webrtcState(e,t){this.emit("webrtcState",e,t)}detach(){this.removeAllListeners(),this.janus=null}}e.exports=i},9004:function(e,t,r){const s=r("282b");class n{constructor(e){this.logger=e}filterH264Profiles(e,t){const r=s.splitSections(e),n=[];for(const i of r)if("video"===s.getMid(i)){const e=[],r=s.splitLines(i),o=[[]];let a=0;for(const t of r)0===t.indexOf("a=rtpmap:")&&(o.push([]),a++),o[a].push(t);o[0].map(t=>e.push(t));for(let n=1;n<o.length;n++){const r=o[n],i=s.parseRtpMap(r[0]);if(i&&"H264"===i.name){const s=r.filter(e=>0===e.indexOf("a=fmtp:")).shift();let i=!1;if(Array.isArray(t))for(const e of t)i=i||-1!==s.indexOf("profile-level-id="+e);else"string"===typeof t?i=-1!==s.indexOf("profile-level-id="+t):t instanceof RegExp&&(i=t.test(s));i&&o[n].map(t=>e.push(t))}else o[n].map(t=>e.push(t))}e.map(e=>n.push(e))}else s.splitLines(i).map(e=>n.push(e));return n.join("\r\n")+"\r\n"}filterDirectCandidates(e,t=!1){const r=s.splitLines(e),n=[];let i=!1,o=!1;for(const s of r)s.startsWith("a=candidate")?(i=!0,this.isDirectCandidate(s)||(n.push(s),o=!0)):n.push(s);return!i||o||t?(i&&!o&&this.logger.error("SDP DIRECT CANDIDATES FILTERED OUT BUT NO OTHER CANDIDATES IN SDP",e,(new Error).stack),n.join("\r\n")+"\r\n"):(this.logger.warn("SDP NO OTHER CANDIDATES THAN DIRECT CANDIDATES",e,(new Error).stack),e)}isDirectCandidate(e){const t=s.parseCandidate(e);return"host"===t.type||"srflx"===t.type||"host"===t.tcpType||"srflx"===t.tcpType}}e.exports=n},"938e":function(e,t,r){const s=r("879c"),n=r("9004");class i extends s{constructor(e,t,r,s,i,o=!1){if(!e)throw new Error("unknown roomId");if(!r)throw new Error("unknown janusRoomPrivateMemberId");super(i),this.roomId=e,this.janusRoomId=t,this.pluginName="janus.plugin.videoroom",this.janusRoomPrivateMemberId=r,this.janusRemoteFeedId=s,this.filterDirectCandidates=!!o,this.sdpHelper=new n(this.logger)}join(e=!0,t=!0){const r={request:"join",room:this.janusRoomId,ptype:"listener",feed:this.janusRemoteFeedId,private_id:this.janusRoomPrivateMemberId,offer_video:t,offer_audio:e};return new Promise((e,t)=>{this.transaction("message",{body:r},"event").then(t=>{const{data:r,json:s}=t||{};if(!r||"attached"!==r.videoroom)throw this.logger.error("VideoRoomListenerJanusPlugin join answer is not attached",r,s),new Error("VideoRoomListenerJanusPlugin join answer is not attached");if(!s.jsep)throw this.logger.error("VideoRoomListenerJanusPlugin join answer does not contains jsep",r,s),new Error("VideoRoomListenerJanusPlugin join answer does not contains jsep");const n=s.jsep;this.filterDirectCandidates&&n.sdp&&(n.sdp=this.sdpHelper.filterDirectCandidates(n.sdp)),this.emit("jsep",n),e(n)}).catch(e=>{this.logger.error("VideoRoomListenerJanusPlugin, unknown error connecting to room",e,r),t(e)})})}setAnswer(e){const t={request:"start",room:this.janusRoomId};return new Promise((r,s)=>{const n=e;this.filterDirectCandidates&&n&&n.sdp&&(n.sdp=this.sdpHelper.filterDirectCandidates(n.sdp)),this.transaction("message",{body:t,jsep:n},"event").then(e=>{const{data:t,json:s}=e||{};if(!t||"ok"!==t.started)throw this.logger.error("VideoRoomListenerJanusPlugin set answer is not ok",t,s),new Error("VideoRoomListenerJanusPlugin set answer is not ok");r()}).catch(t=>{this.logger.error("VideoRoomListenerJanusPlugin, unknown error sending answer",t,e),s(t)})})}candidate(e){if(!(this.filterDirectCandidates&&e.candidate&&this.sdpHelper.isDirectCandidate(e.candidate)))return this.transaction("trickle",{candidate:e})}hangup(){super.hangup(),this.janus.destroyPlugin(this).catch(e=>{this.logger.error("VideoRoomListenerJanusPlugin, destroyPlugin error in hangup",e)})}}e.exports=i},a811:function(e,t,r){const s=r("2e2a"),n=r("6f86"),i=r("879c"),o=r("777c"),a=r("dd8b"),c=r("938e"),u=r("42e8"),d=r("10a8"),{JanusConfig:l,JanusAdminConfig:h,JanusRoomConfig:p}=r("ce1a");e.exports={Janus:s,JanusAdmin:n,JanusPlugin:i,EchoJanusPlugin:o,RecordPlayJanusPlugin:a,VideoRoomListenerJanusPlugin:c,VideoRoomPublisherJanusPlugin:u,StreamingJanusPlugin:d,JanusConfig:l,JanusAdminConfig:h,JanusRoomConfig:p}},c64e:function(e,t,r){var s=r("e1f4"),n=r("2366");function i(e,t,r){var i=t&&r||0;"string"==typeof e&&(t="binary"===e?new Array(16):null,e=null),e=e||{};var o=e.random||(e.rng||s)();if(o[6]=15&o[6]|64,o[8]=63&o[8]|128,t)for(var a=0;a<16;++a)t[i+a]=o[a];return t||n(o)}e.exports=i},ce1a:function(e,t){class r{constructor(e){const{url:t,keepAliveIntervalMs:r,options:s}=e;this.url=t,this.keepAliveIntervalMs=r,this.options=s}}class s extends r{constructor(e){super(e);const{secret:t,sessionListIntervalMs:r}=e;this.secret=t,this.sessionListIntervalMs=r}}class n{constructor(e){const{id:t,codec:r,record:s,videoOrientExt:n,bitrate:i,firSeconds:o,publishers:a,recordDirectory:c}=e;this.id=t,this.codec=r,this.record=s,this.videoOrientExt=n,this.bitrate=i,this.firSeconds=o,this.publishers=a,this.recordDirectory=c}}e.exports.JanusConfig=r,e.exports.JanusAdminConfig=s,e.exports.JanusRoomConfig=n},dd8b:function(e,t,r){const s=r("879c"),n=r("9004");class i extends s{constructor(e,t=!1){super(e),this.filterDirectCandidates=!!t,this.janusEchoBody={audio:!0,video:!0},this.pluginName="janus.plugin.recordplay",this.sdpHelper=new n(this.logger)}configure(e=1048576,t=15e3){return this.transaction("message",{body:{request:"configure","video-bitrate-max":e,"video-keyframe-interval":t}},"success").catch(e=>{throw this.logger.error("RecordPlayJanusPlugin, cannot configure",e),e})}onmessage(e,t){e&&"event"===e.recordplay&&"done"===e.result?this.janus.destroyPlugin(this).catch(e=>{this.logger.error("RecordPlayJanusPlugin, destroyPlugin error in onmessage",e)}):this.logger.error("RecordPlayJanusPlugin got unknown message",e,t)}consume(e){if("message"===e.type){const t={jsep:e.message.jsep,body:{request:"record",name:"hello"}};this.transaction("message",t,"event").then(e=>{const{json:t,data:r}=e;if(!r||!r.result||!r.result.id)return void this.logger.error("RecordPlayJanusPlugin, no recording id in the transaction reply",e);if(this.emit("recordingId",r.result.id),!t||!t.jsep)return void this.logger.error("RecordPlayJanusPlugin, no jsep in the transaction reply",e);const s=t.jsep;this.filterDirectCandidates&&s.sdp&&(s.sdp=this.sdpHelper.filterDirectCandidates(s.sdp)),this.emit("jsep",s)})}else if("candidate"===e.type){if(this.filterDirectCandidates&&e.message.candidate&&this.sdpHelper.isDirectCandidate(e.message.candidate))return;this.transaction("trickle",{candidate:e.message})}else if("stop"===e.type){const e={body:{request:"stop"}};this.transaction("message",e,"event")}else this.logger.error("RecordPlayJanusPlugin unknown data type",e)}}e.exports=i},e1f4:function(e,t){var r="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||"undefined"!=typeof msCrypto&&"function"==typeof window.msCrypto.getRandomValues&&msCrypto.getRandomValues.bind(msCrypto);if(r){var s=new Uint8Array(16);e.exports=function(){return r(s),s}}else{var n=new Array(16);e.exports=function(){for(var e,t=0;t<16;t++)0===(3&t)&&(e=4294967296*Math.random()),n[t]=e>>>((3&t)<<3)&255;return n}}},faa1:function(e,t,r){"use strict";var s,n="object"===typeof Reflect?Reflect:null,i=n&&"function"===typeof n.apply?n.apply:function(e,t,r){return Function.prototype.apply.call(e,t,r)};function o(e){console&&console.warn&&console.warn(e)}s=n&&"function"===typeof n.ownKeys?n.ownKeys:Object.getOwnPropertySymbols?function(e){return Object.getOwnPropertyNames(e).concat(Object.getOwnPropertySymbols(e))}:function(e){return Object.getOwnPropertyNames(e)};var a=Number.isNaN||function(e){return e!==e};function c(){c.init.call(this)}e.exports=c,c.EventEmitter=c,c.prototype._events=void 0,c.prototype._eventsCount=0,c.prototype._maxListeners=void 0;var u=10;function d(e){if("function"!==typeof e)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof e)}function l(e){return void 0===e._maxListeners?c.defaultMaxListeners:e._maxListeners}function h(e,t,r,s){var n,i,a;if(d(r),i=e._events,void 0===i?(i=e._events=Object.create(null),e._eventsCount=0):(void 0!==i.newListener&&(e.emit("newListener",t,r.listener?r.listener:r),i=e._events),a=i[t]),void 0===a)a=i[t]=r,++e._eventsCount;else if("function"===typeof a?a=i[t]=s?[r,a]:[a,r]:s?a.unshift(r):a.push(r),n=l(e),n>0&&a.length>n&&!a.warned){a.warned=!0;var c=new Error("Possible EventEmitter memory leak detected. "+a.length+" "+String(t)+" listeners added. Use emitter.setMaxListeners() to increase limit");c.name="MaxListenersExceededWarning",c.emitter=e,c.type=t,c.count=a.length,o(c)}return e}function p(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,0===arguments.length?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function m(e,t,r){var s={fired:!1,wrapFn:void 0,target:e,type:t,listener:r},n=p.bind(s);return n.listener=r,s.wrapFn=n,n}function g(e,t,r){var s=e._events;if(void 0===s)return[];var n=s[t];return void 0===n?[]:"function"===typeof n?r?[n.listener||n]:[n]:r?w(n):v(n,n.length)}function f(e){var t=this._events;if(void 0!==t){var r=t[e];if("function"===typeof r)return 1;if(void 0!==r)return r.length}return 0}function v(e,t){for(var r=new Array(t),s=0;s<t;++s)r[s]=e[s];return r}function y(e,t){for(;t+1<e.length;t++)e[t]=e[t+1];e.pop()}function w(e){for(var t=new Array(e.length),r=0;r<t.length;++r)t[r]=e[r].listener||e[r];return t}Object.defineProperty(c,"defaultMaxListeners",{enumerable:!0,get:function(){return u},set:function(e){if("number"!==typeof e||e<0||a(e))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+e+".");u=e}}),c.init=function(){void 0!==this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},c.prototype.setMaxListeners=function(e){if("number"!==typeof e||e<0||a(e))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+e+".");return this._maxListeners=e,this},c.prototype.getMaxListeners=function(){return l(this)},c.prototype.emit=function(e){for(var t=[],r=1;r<arguments.length;r++)t.push(arguments[r]);var s="error"===e,n=this._events;if(void 0!==n)s=s&&void 0===n.error;else if(!s)return!1;if(s){var o;if(t.length>0&&(o=t[0]),o instanceof Error)throw o;var a=new Error("Unhandled error."+(o?" ("+o.message+")":""));throw a.context=o,a}var c=n[e];if(void 0===c)return!1;if("function"===typeof c)i(c,this,t);else{var u=c.length,d=v(c,u);for(r=0;r<u;++r)i(d[r],this,t)}return!0},c.prototype.addListener=function(e,t){return h(this,e,t,!1)},c.prototype.on=c.prototype.addListener,c.prototype.prependListener=function(e,t){return h(this,e,t,!0)},c.prototype.once=function(e,t){return d(t),this.on(e,m(this,e,t)),this},c.prototype.prependOnceListener=function(e,t){return d(t),this.prependListener(e,m(this,e,t)),this},c.prototype.removeListener=function(e,t){var r,s,n,i,o;if(d(t),s=this._events,void 0===s)return this;if(r=s[e],void 0===r)return this;if(r===t||r.listener===t)0===--this._eventsCount?this._events=Object.create(null):(delete s[e],s.removeListener&&this.emit("removeListener",e,r.listener||t));else if("function"!==typeof r){for(n=-1,i=r.length-1;i>=0;i--)if(r[i]===t||r[i].listener===t){o=r[i].listener,n=i;break}if(n<0)return this;0===n?r.shift():y(r,n),1===r.length&&(s[e]=r[0]),void 0!==s.removeListener&&this.emit("removeListener",e,o||t)}return this},c.prototype.off=c.prototype.removeListener,c.prototype.removeAllListeners=function(e){var t,r,s;if(r=this._events,void 0===r)return this;if(void 0===r.removeListener)return 0===arguments.length?(this._events=Object.create(null),this._eventsCount=0):void 0!==r[e]&&(0===--this._eventsCount?this._events=Object.create(null):delete r[e]),this;if(0===arguments.length){var n,i=Object.keys(r);for(s=0;s<i.length;++s)n=i[s],"removeListener"!==n&&this.removeAllListeners(n);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if(t=r[e],"function"===typeof t)this.removeListener(e,t);else if(void 0!==t)for(s=t.length-1;s>=0;s--)this.removeListener(e,t[s]);return this},c.prototype.listeners=function(e){return g(this,e,!0)},c.prototype.rawListeners=function(e){return g(this,e,!1)},c.listenerCount=function(e,t){return"function"===typeof e.listenerCount?e.listenerCount(t):f.call(e,t)},c.prototype.listenerCount=f,c.prototype.eventNames=function(){return this._eventsCount>0?s(this._events):[]}}}]);
//# sourceMappingURL=chunk-e4fc0dec.4085013d.js.map