{"version":3,"sources":["webpack:///./node_modules/subscriptions-transport-ws/dist/utils/is-object.js","webpack:///./node_modules/subscriptions-transport-ws/dist/message-types.js","webpack:///./node_modules/subscriptions-transport-ws/dist/utils/is-string.js","webpack:///./node_modules/subscriptions-transport-ws/dist/client.js","webpack:///./node_modules/subscriptions-transport-ws/dist/defaults.js","webpack:///./node_modules/subscriptions-transport-ws/dist/protocol.js"],"names":["isObject","value","Object","defineProperty","exports","default","MessageTypes","Error","GQL_CONNECTION_INIT","GQL_CONNECTION_ACK","GQL_CONNECTION_ERROR","GQL_CONNECTION_KEEP_ALIVE","GQL_CONNECTION_TERMINATE","GQL_START","GQL_DATA","GQL_ERROR","GQL_COMPLETE","GQL_STOP","SUBSCRIPTION_START","SUBSCRIPTION_DATA","SUBSCRIPTION_SUCCESS","SUBSCRIPTION_FAIL","SUBSCRIPTION_END","INIT","INIT_SUCCESS","INIT_FAIL","KEEP_ALIVE","isString","__assign","this","assign","t","s","i","n","arguments","length","p","prototype","hasOwnProperty","call","__awaiter","thisArg","_arguments","P","generator","Promise","resolve","reject","fulfilled","step","next","e","rejected","result","done","then","apply","__generator","body","f","y","g","_","label","sent","trys","ops","verb","Symbol","iterator","v","op","TypeError","pop","push","_global","global","window","NativeWebSocket","WebSocket","MozWebSocket","Backoff","eventemitter3_1","is_string_1","is_object_1","printer_1","getOperationAST_1","symbol_observable_1","protocol_1","defaults_1","message_types_1","SubscriptionClient","url","options","webSocketImpl","webSocketProtocols","_a","_b","connectionCallback","undefined","_c","connectionParams","_d","timeout","WS_TIMEOUT","_e","reconnect","_f","reconnectionAttempts","Infinity","_g","lazy","_h","inactivityTimeout","wsImpl","wsProtocols","GRAPHQL_WS","operations","nextOperationId","wsTimeout","unsentMessagesQueue","reconnecting","closedByUser","backoff","jitter","eventEmitter","EventEmitter","middlewares","client","maxConnectTimeGenerator","createMaxConnectTimeGenerator","getConnectionParams","connect","get","CLOSED","readyState","enumerable","configurable","close","isForced","clearInactivityTimeout","clearCheckConnectionInterval","clearMaxConnectTimeout","clearTryReconnectTimeout","unsubscribeAll","sendMessage","emit","tryReconnect","request","opId","getObserver","bind","executeOperation","unsubscribe","subscribe","observerOrNext","onError","onComplete","observer","error","complete","on","eventName","callback","context","handler","off","onConnected","onConnecting","onDisconnected","onReconnected","onReconnecting","_this","keys","forEach","subId","applyMiddlewares","queue","funcs","scope","shift","applyMiddleware","slice","use","map","middleware","generateOperationId","processedOptions","checkOperationOptions","catch","formatErrors","minValue","maxValue","min","max","factor","checkConnectionIntervalId","clearInterval","maxConnectTimeoutId","clearTimeout","tryReconnectTimeoutId","inactivityTimeoutId","setInactivityTimeout","setTimeout","query","variables","operationName","getOperationAST","buildMessage","id","type","payload","payloadToReturn","print","errors","Array","isArray","message","name","originalError","sendMessageRaw","status","OPEN","serializedMessage","JSON","stringify","parse","send","CONNECTING","String","attempts","key","delay","duration","flushUnsentMessagesQueue","checkConnection","wasKeepAliveReceived","checkMaxConnectTimeout","onopen","error_1","onclose","onerror","err","onmessage","data","processReceivedData","receivedData","parsedMessage","indexOf","reset","parsedPayload","firstKA","setInterval","GRAPHQL_SUBSCRIPTIONS"],"mappings":"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","file":"js/yarn.subscriptions-transport-ws.425e63d5.js","sourcesContent":["\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nfunction isObject(value) {\n    return ((value !== null) && (typeof value === 'object'));\n}\nexports.default = isObject;\n//# sourceMappingURL=is-object.js.map","\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar MessageTypes = (function () {\n    function MessageTypes() {\n        throw new Error('Static Class');\n    }\n    MessageTypes.GQL_CONNECTION_INIT = 'connection_init';\n    MessageTypes.GQL_CONNECTION_ACK = 'connection_ack';\n    MessageTypes.GQL_CONNECTION_ERROR = 'connection_error';\n    MessageTypes.GQL_CONNECTION_KEEP_ALIVE = 'ka';\n    MessageTypes.GQL_CONNECTION_TERMINATE = 'connection_terminate';\n    MessageTypes.GQL_START = 'start';\n    MessageTypes.GQL_DATA = 'data';\n    MessageTypes.GQL_ERROR = 'error';\n    MessageTypes.GQL_COMPLETE = 'complete';\n    MessageTypes.GQL_STOP = 'stop';\n    MessageTypes.SUBSCRIPTION_START = 'subscription_start';\n    MessageTypes.SUBSCRIPTION_DATA = 'subscription_data';\n    MessageTypes.SUBSCRIPTION_SUCCESS = 'subscription_success';\n    MessageTypes.SUBSCRIPTION_FAIL = 'subscription_fail';\n    MessageTypes.SUBSCRIPTION_END = 'subscription_end';\n    MessageTypes.INIT = 'init';\n    MessageTypes.INIT_SUCCESS = 'init_success';\n    MessageTypes.INIT_FAIL = 'init_fail';\n    MessageTypes.KEEP_ALIVE = 'keepalive';\n    return MessageTypes;\n}());\nexports.default = MessageTypes;\n//# sourceMappingURL=message-types.js.map","\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nfunction isString(value) {\n    return typeof value === 'string';\n}\nexports.default = isString;\n//# sourceMappingURL=is-string.js.map","\"use strict\";\nvar __assign = (this && this.__assign) || Object.assign || function(t) {\n    for (var s, i = 1, n = arguments.length; i < n; i++) {\n        s = arguments[i];\n        for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p))\n            t[p] = s[p];\n    }\n    return t;\n};\nvar __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\n    return new (P || (P = Promise))(function (resolve, reject) {\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\n        function step(result) { result.done ? resolve(result.value) : new P(function (resolve) { resolve(result.value); }).then(fulfilled, rejected); }\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\n    });\n};\nvar __generator = (this && this.__generator) || function (thisArg, body) {\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\n    function verb(n) { return function (v) { return step([n, v]); }; }\n    function step(op) {\n        if (f) throw new TypeError(\"Generator is already executing.\");\n        while (_) try {\n            if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\n            if (y = 0, t) op = [op[0] & 2, t.value];\n            switch (op[0]) {\n                case 0: case 1: t = op; break;\n                case 4: _.label++; return { value: op[1], done: false };\n                case 5: _.label++; y = op[1]; op = [0]; continue;\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\n                default:\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\n                    if (t[2]) _.ops.pop();\n                    _.trys.pop(); continue;\n            }\n            op = body.call(thisArg, _);\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\n    }\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar _global = typeof global !== 'undefined' ? global : (typeof window !== 'undefined' ? window : {});\nvar NativeWebSocket = _global.WebSocket || _global.MozWebSocket;\nvar Backoff = require(\"backo2\");\nvar eventemitter3_1 = require(\"eventemitter3\");\nvar is_string_1 = require(\"./utils/is-string\");\nvar is_object_1 = require(\"./utils/is-object\");\nvar printer_1 = require(\"graphql/language/printer\");\nvar getOperationAST_1 = require(\"graphql/utilities/getOperationAST\");\nvar symbol_observable_1 = require(\"symbol-observable\");\nvar protocol_1 = require(\"./protocol\");\nvar defaults_1 = require(\"./defaults\");\nvar message_types_1 = require(\"./message-types\");\nvar SubscriptionClient = (function () {\n    function SubscriptionClient(url, options, webSocketImpl, webSocketProtocols) {\n        var _a = (options || {}), _b = _a.connectionCallback, connectionCallback = _b === void 0 ? undefined : _b, _c = _a.connectionParams, connectionParams = _c === void 0 ? {} : _c, _d = _a.timeout, timeout = _d === void 0 ? defaults_1.WS_TIMEOUT : _d, _e = _a.reconnect, reconnect = _e === void 0 ? false : _e, _f = _a.reconnectionAttempts, reconnectionAttempts = _f === void 0 ? Infinity : _f, _g = _a.lazy, lazy = _g === void 0 ? false : _g, _h = _a.inactivityTimeout, inactivityTimeout = _h === void 0 ? 0 : _h;\n        this.wsImpl = webSocketImpl || NativeWebSocket;\n        if (!this.wsImpl) {\n            throw new Error('Unable to find native implementation, or alternative implementation for WebSocket!');\n        }\n        this.wsProtocols = webSocketProtocols || protocol_1.GRAPHQL_WS;\n        this.connectionCallback = connectionCallback;\n        this.url = url;\n        this.operations = {};\n        this.nextOperationId = 0;\n        this.wsTimeout = timeout;\n        this.unsentMessagesQueue = [];\n        this.reconnect = reconnect;\n        this.reconnecting = false;\n        this.reconnectionAttempts = reconnectionAttempts;\n        this.lazy = !!lazy;\n        this.inactivityTimeout = inactivityTimeout;\n        this.closedByUser = false;\n        this.backoff = new Backoff({ jitter: 0.5 });\n        this.eventEmitter = new eventemitter3_1.EventEmitter();\n        this.middlewares = [];\n        this.client = null;\n        this.maxConnectTimeGenerator = this.createMaxConnectTimeGenerator();\n        this.connectionParams = this.getConnectionParams(connectionParams);\n        if (!this.lazy) {\n            this.connect();\n        }\n    }\n    Object.defineProperty(SubscriptionClient.prototype, \"status\", {\n        get: function () {\n            if (this.client === null) {\n                return this.wsImpl.CLOSED;\n            }\n            return this.client.readyState;\n        },\n        enumerable: true,\n        configurable: true\n    });\n    SubscriptionClient.prototype.close = function (isForced, closedByUser) {\n        if (isForced === void 0) { isForced = true; }\n        if (closedByUser === void 0) { closedByUser = true; }\n        this.clearInactivityTimeout();\n        if (this.client !== null) {\n            this.closedByUser = closedByUser;\n            if (isForced) {\n                this.clearCheckConnectionInterval();\n                this.clearMaxConnectTimeout();\n                this.clearTryReconnectTimeout();\n                this.unsubscribeAll();\n                this.sendMessage(undefined, message_types_1.default.GQL_CONNECTION_TERMINATE, null);\n            }\n            this.client.close();\n            this.client = null;\n            this.eventEmitter.emit('disconnected');\n            if (!isForced) {\n                this.tryReconnect();\n            }\n        }\n    };\n    SubscriptionClient.prototype.request = function (request) {\n        var _a;\n        var getObserver = this.getObserver.bind(this);\n        var executeOperation = this.executeOperation.bind(this);\n        var unsubscribe = this.unsubscribe.bind(this);\n        var opId;\n        this.clearInactivityTimeout();\n        return _a = {},\n            _a[symbol_observable_1.default] = function () {\n                return this;\n            },\n            _a.subscribe = function (observerOrNext, onError, onComplete) {\n                var observer = getObserver(observerOrNext, onError, onComplete);\n                opId = executeOperation(request, function (error, result) {\n                    if (error === null && result === null) {\n                        if (observer.complete) {\n                            observer.complete();\n                        }\n                    }\n                    else if (error) {\n                        if (observer.error) {\n                            observer.error(error[0]);\n                        }\n                    }\n                    else {\n                        if (observer.next) {\n                            observer.next(result);\n                        }\n                    }\n                });\n                return {\n                    unsubscribe: function () {\n                        if (opId) {\n                            unsubscribe(opId);\n                            opId = null;\n                        }\n                    },\n                };\n            },\n            _a;\n    };\n    SubscriptionClient.prototype.on = function (eventName, callback, context) {\n        var handler = this.eventEmitter.on(eventName, callback, context);\n        return function () {\n            handler.off(eventName, callback, context);\n        };\n    };\n    SubscriptionClient.prototype.onConnected = function (callback, context) {\n        return this.on('connected', callback, context);\n    };\n    SubscriptionClient.prototype.onConnecting = function (callback, context) {\n        return this.on('connecting', callback, context);\n    };\n    SubscriptionClient.prototype.onDisconnected = function (callback, context) {\n        return this.on('disconnected', callback, context);\n    };\n    SubscriptionClient.prototype.onReconnected = function (callback, context) {\n        return this.on('reconnected', callback, context);\n    };\n    SubscriptionClient.prototype.onReconnecting = function (callback, context) {\n        return this.on('reconnecting', callback, context);\n    };\n    SubscriptionClient.prototype.onError = function (callback, context) {\n        return this.on('error', callback, context);\n    };\n    SubscriptionClient.prototype.unsubscribeAll = function () {\n        var _this = this;\n        Object.keys(this.operations).forEach(function (subId) {\n            _this.unsubscribe(subId);\n        });\n    };\n    SubscriptionClient.prototype.applyMiddlewares = function (options) {\n        var _this = this;\n        return new Promise(function (resolve, reject) {\n            var queue = function (funcs, scope) {\n                var next = function (error) {\n                    if (error) {\n                        reject(error);\n                    }\n                    else {\n                        if (funcs.length > 0) {\n                            var f = funcs.shift();\n                            if (f) {\n                                f.applyMiddleware.apply(scope, [options, next]);\n                            }\n                        }\n                        else {\n                            resolve(options);\n                        }\n                    }\n                };\n                next();\n            };\n            queue(_this.middlewares.slice(), _this);\n        });\n    };\n    SubscriptionClient.prototype.use = function (middlewares) {\n        var _this = this;\n        middlewares.map(function (middleware) {\n            if (typeof middleware.applyMiddleware === 'function') {\n                _this.middlewares.push(middleware);\n            }\n            else {\n                throw new Error('Middleware must implement the applyMiddleware function.');\n            }\n        });\n        return this;\n    };\n    SubscriptionClient.prototype.getConnectionParams = function (connectionParams) {\n        return function () { return new Promise(function (resolve, reject) {\n            if (typeof connectionParams === 'function') {\n                try {\n                    return resolve(connectionParams.call(null));\n                }\n                catch (error) {\n                    return reject(error);\n                }\n            }\n            resolve(connectionParams);\n        }); };\n    };\n    SubscriptionClient.prototype.executeOperation = function (options, handler) {\n        var _this = this;\n        if (this.client === null) {\n            this.connect();\n        }\n        var opId = this.generateOperationId();\n        this.operations[opId] = { options: options, handler: handler };\n        this.applyMiddlewares(options)\n            .then(function (processedOptions) {\n            _this.checkOperationOptions(processedOptions, handler);\n            if (_this.operations[opId]) {\n                _this.operations[opId] = { options: processedOptions, handler: handler };\n                _this.sendMessage(opId, message_types_1.default.GQL_START, processedOptions);\n            }\n        })\n            .catch(function (error) {\n            _this.unsubscribe(opId);\n            handler(_this.formatErrors(error));\n        });\n        return opId;\n    };\n    SubscriptionClient.prototype.getObserver = function (observerOrNext, error, complete) {\n        if (typeof observerOrNext === 'function') {\n            return {\n                next: function (v) { return observerOrNext(v); },\n                error: function (e) { return error && error(e); },\n                complete: function () { return complete && complete(); },\n            };\n        }\n        return observerOrNext;\n    };\n    SubscriptionClient.prototype.createMaxConnectTimeGenerator = function () {\n        var minValue = 1000;\n        var maxValue = this.wsTimeout;\n        return new Backoff({\n            min: minValue,\n            max: maxValue,\n            factor: 1.2,\n        });\n    };\n    SubscriptionClient.prototype.clearCheckConnectionInterval = function () {\n        if (this.checkConnectionIntervalId) {\n            clearInterval(this.checkConnectionIntervalId);\n            this.checkConnectionIntervalId = null;\n        }\n    };\n    SubscriptionClient.prototype.clearMaxConnectTimeout = function () {\n        if (this.maxConnectTimeoutId) {\n            clearTimeout(this.maxConnectTimeoutId);\n            this.maxConnectTimeoutId = null;\n        }\n    };\n    SubscriptionClient.prototype.clearTryReconnectTimeout = function () {\n        if (this.tryReconnectTimeoutId) {\n            clearTimeout(this.tryReconnectTimeoutId);\n            this.tryReconnectTimeoutId = null;\n        }\n    };\n    SubscriptionClient.prototype.clearInactivityTimeout = function () {\n        if (this.inactivityTimeoutId) {\n            clearTimeout(this.inactivityTimeoutId);\n            this.inactivityTimeoutId = null;\n        }\n    };\n    SubscriptionClient.prototype.setInactivityTimeout = function () {\n        var _this = this;\n        if (this.inactivityTimeout > 0 && Object.keys(this.operations).length === 0) {\n            this.inactivityTimeoutId = setTimeout(function () {\n                if (Object.keys(_this.operations).length === 0) {\n                    _this.close();\n                }\n            }, this.inactivityTimeout);\n        }\n    };\n    SubscriptionClient.prototype.checkOperationOptions = function (options, handler) {\n        var query = options.query, variables = options.variables, operationName = options.operationName;\n        if (!query) {\n            throw new Error('Must provide a query.');\n        }\n        if (!handler) {\n            throw new Error('Must provide an handler.');\n        }\n        if ((!is_string_1.default(query) && !getOperationAST_1.getOperationAST(query, operationName)) ||\n            (operationName && !is_string_1.default(operationName)) ||\n            (variables && !is_object_1.default(variables))) {\n            throw new Error('Incorrect option types. query must be a string or a document,' +\n                '`operationName` must be a string, and `variables` must be an object.');\n        }\n    };\n    SubscriptionClient.prototype.buildMessage = function (id, type, payload) {\n        var payloadToReturn = payload && payload.query ? __assign({}, payload, { query: typeof payload.query === 'string' ? payload.query : printer_1.print(payload.query) }) :\n            payload;\n        return {\n            id: id,\n            type: type,\n            payload: payloadToReturn,\n        };\n    };\n    SubscriptionClient.prototype.formatErrors = function (errors) {\n        if (Array.isArray(errors)) {\n            return errors;\n        }\n        if (errors && errors.errors) {\n            return this.formatErrors(errors.errors);\n        }\n        if (errors && errors.message) {\n            return [errors];\n        }\n        return [{\n                name: 'FormatedError',\n                message: 'Unknown error',\n                originalError: errors,\n            }];\n    };\n    SubscriptionClient.prototype.sendMessage = function (id, type, payload) {\n        this.sendMessageRaw(this.buildMessage(id, type, payload));\n    };\n    SubscriptionClient.prototype.sendMessageRaw = function (message) {\n        switch (this.status) {\n            case this.wsImpl.OPEN:\n                var serializedMessage = JSON.stringify(message);\n                try {\n                    JSON.parse(serializedMessage);\n                }\n                catch (e) {\n                    this.eventEmitter.emit('error', new Error(\"Message must be JSON-serializable. Got: \" + message));\n                }\n                this.client.send(serializedMessage);\n                break;\n            case this.wsImpl.CONNECTING:\n                this.unsentMessagesQueue.push(message);\n                break;\n            default:\n                if (!this.reconnecting) {\n                    this.eventEmitter.emit('error', new Error('A message was not sent because socket is not connected, is closing or ' +\n                        'is already closed. Message was: ' + JSON.stringify(message)));\n                }\n        }\n    };\n    SubscriptionClient.prototype.generateOperationId = function () {\n        return String(++this.nextOperationId);\n    };\n    SubscriptionClient.prototype.tryReconnect = function () {\n        var _this = this;\n        if (!this.reconnect || this.backoff.attempts >= this.reconnectionAttempts) {\n            return;\n        }\n        if (!this.reconnecting) {\n            Object.keys(this.operations).forEach(function (key) {\n                _this.unsentMessagesQueue.push(_this.buildMessage(key, message_types_1.default.GQL_START, _this.operations[key].options));\n            });\n            this.reconnecting = true;\n        }\n        this.clearTryReconnectTimeout();\n        var delay = this.backoff.duration();\n        this.tryReconnectTimeoutId = setTimeout(function () {\n            _this.connect();\n        }, delay);\n    };\n    SubscriptionClient.prototype.flushUnsentMessagesQueue = function () {\n        var _this = this;\n        this.unsentMessagesQueue.forEach(function (message) {\n            _this.sendMessageRaw(message);\n        });\n        this.unsentMessagesQueue = [];\n    };\n    SubscriptionClient.prototype.checkConnection = function () {\n        if (this.wasKeepAliveReceived) {\n            this.wasKeepAliveReceived = false;\n            return;\n        }\n        if (!this.reconnecting) {\n            this.close(false, true);\n        }\n    };\n    SubscriptionClient.prototype.checkMaxConnectTimeout = function () {\n        var _this = this;\n        this.clearMaxConnectTimeout();\n        this.maxConnectTimeoutId = setTimeout(function () {\n            if (_this.status !== _this.wsImpl.OPEN) {\n                _this.reconnecting = true;\n                _this.close(false, true);\n            }\n        }, this.maxConnectTimeGenerator.duration());\n    };\n    SubscriptionClient.prototype.connect = function () {\n        var _this = this;\n        this.client = new this.wsImpl(this.url, this.wsProtocols);\n        this.checkMaxConnectTimeout();\n        this.client.onopen = function () { return __awaiter(_this, void 0, void 0, function () {\n            var connectionParams, error_1;\n            return __generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0:\n                        if (!(this.status === this.wsImpl.OPEN)) return [3, 4];\n                        this.clearMaxConnectTimeout();\n                        this.closedByUser = false;\n                        this.eventEmitter.emit(this.reconnecting ? 'reconnecting' : 'connecting');\n                        _a.label = 1;\n                    case 1:\n                        _a.trys.push([1, 3, , 4]);\n                        return [4, this.connectionParams()];\n                    case 2:\n                        connectionParams = _a.sent();\n                        this.sendMessage(undefined, message_types_1.default.GQL_CONNECTION_INIT, connectionParams);\n                        this.flushUnsentMessagesQueue();\n                        return [3, 4];\n                    case 3:\n                        error_1 = _a.sent();\n                        this.sendMessage(undefined, message_types_1.default.GQL_CONNECTION_ERROR, error_1);\n                        this.flushUnsentMessagesQueue();\n                        return [3, 4];\n                    case 4: return [2];\n                }\n            });\n        }); };\n        this.client.onclose = function () {\n            if (!_this.closedByUser) {\n                _this.close(false, false);\n            }\n        };\n        this.client.onerror = function (err) {\n            _this.eventEmitter.emit('error', err);\n        };\n        this.client.onmessage = function (_a) {\n            var data = _a.data;\n            _this.processReceivedData(data);\n        };\n    };\n    SubscriptionClient.prototype.processReceivedData = function (receivedData) {\n        var parsedMessage;\n        var opId;\n        try {\n            parsedMessage = JSON.parse(receivedData);\n            opId = parsedMessage.id;\n        }\n        catch (e) {\n            throw new Error(\"Message must be JSON-parseable. Got: \" + receivedData);\n        }\n        if ([message_types_1.default.GQL_DATA,\n            message_types_1.default.GQL_COMPLETE,\n            message_types_1.default.GQL_ERROR,\n        ].indexOf(parsedMessage.type) !== -1 && !this.operations[opId]) {\n            this.unsubscribe(opId);\n            return;\n        }\n        switch (parsedMessage.type) {\n            case message_types_1.default.GQL_CONNECTION_ERROR:\n                if (this.connectionCallback) {\n                    this.connectionCallback(parsedMessage.payload);\n                }\n                break;\n            case message_types_1.default.GQL_CONNECTION_ACK:\n                this.eventEmitter.emit(this.reconnecting ? 'reconnected' : 'connected');\n                this.reconnecting = false;\n                this.backoff.reset();\n                this.maxConnectTimeGenerator.reset();\n                if (this.connectionCallback) {\n                    this.connectionCallback();\n                }\n                break;\n            case message_types_1.default.GQL_COMPLETE:\n                this.operations[opId].handler(null, null);\n                delete this.operations[opId];\n                break;\n            case message_types_1.default.GQL_ERROR:\n                this.operations[opId].handler(this.formatErrors(parsedMessage.payload), null);\n                delete this.operations[opId];\n                break;\n            case message_types_1.default.GQL_DATA:\n                var parsedPayload = !parsedMessage.payload.errors ?\n                    parsedMessage.payload : __assign({}, parsedMessage.payload, { errors: this.formatErrors(parsedMessage.payload.errors) });\n                this.operations[opId].handler(null, parsedPayload);\n                break;\n            case message_types_1.default.GQL_CONNECTION_KEEP_ALIVE:\n                var firstKA = typeof this.wasKeepAliveReceived === 'undefined';\n                this.wasKeepAliveReceived = true;\n                if (firstKA) {\n                    this.checkConnection();\n                }\n                if (this.checkConnectionIntervalId) {\n                    clearInterval(this.checkConnectionIntervalId);\n                    this.checkConnection();\n                }\n                this.checkConnectionIntervalId = setInterval(this.checkConnection.bind(this), this.wsTimeout);\n                break;\n            default:\n                throw new Error('Invalid message type!');\n        }\n    };\n    SubscriptionClient.prototype.unsubscribe = function (opId) {\n        if (this.operations[opId]) {\n            delete this.operations[opId];\n            this.setInactivityTimeout();\n            this.sendMessage(opId, message_types_1.default.GQL_STOP, undefined);\n        }\n    };\n    return SubscriptionClient;\n}());\nexports.SubscriptionClient = SubscriptionClient;\n//# sourceMappingURL=client.js.map","\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar WS_TIMEOUT = 30000;\nexports.WS_TIMEOUT = WS_TIMEOUT;\n//# sourceMappingURL=defaults.js.map","\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar GRAPHQL_WS = 'graphql-ws';\nexports.GRAPHQL_WS = GRAPHQL_WS;\nvar GRAPHQL_SUBSCRIPTIONS = 'graphql-subscriptions';\nexports.GRAPHQL_SUBSCRIPTIONS = GRAPHQL_SUBSCRIPTIONS;\n//# sourceMappingURL=protocol.js.map"],"sourceRoot":""}