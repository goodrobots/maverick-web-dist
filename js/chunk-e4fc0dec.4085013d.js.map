{"version":3,"sources":["webpack:///../../../src/components/VAlert/VAlert.ts","webpack:///./node_modules/@techteamer/janus-api/src/plugin/StreamingJanusPlugin.js","webpack:///./src/components/modules/video/VideoModule.vue?7b19","webpack:///./src/components/modules/video/VideoStream.vue?ca1f","webpack:///src/components/modules/video/VideoStream.vue","webpack:///./src/components/modules/video/VideoStream.vue?5831","webpack:///./src/components/modules/video/VideoStream.vue","webpack:///src/components/modules/video/VideoModule.vue","webpack:///./src/components/modules/video/VideoModule.vue?414c","webpack:///./src/components/modules/video/VideoModule.vue","webpack:///./node_modules/uuid/lib/bytesToUuid.js","webpack:///./node_modules/sdp/sdp.js","webpack:///./node_modules/@techteamer/janus-api/src/Janus.js","webpack:///./node_modules/@techteamer/janus-api/src/plugin/VideoRoomPublisherJanusPlugin.js","webpack:///./node_modules/@techteamer/janus-api/src/WebSocket.js","webpack:///./node_modules/@techteamer/janus-api/src/JanusAdmin.js","webpack:///./node_modules/@techteamer/janus-api/src/plugin/EchoJanusPlugin.js","webpack:///./node_modules/@techteamer/janus-api/src/JanusPlugin.js","webpack:///./node_modules/@techteamer/janus-api/src/SdpHelper.js","webpack:///./node_modules/@techteamer/janus-api/src/plugin/VideoRoomListenerJanusPlugin.js","webpack:///./node_modules/@techteamer/janus-api/index.js","webpack:///./node_modules/uuid/v4.js","webpack:///./node_modules/@techteamer/janus-api/src/Config.js","webpack:///./node_modules/@techteamer/janus-api/src/plugin/RecordPlayJanusPlugin.js","webpack:///./node_modules/uuid/lib/rng-browser.js","webpack:///./node_modules/events/events.js"],"names":["name","props","border","type","validator","closeLabel","default","coloredBorder","dense","dismissible","icon","Boolean","val","outlined","prominent","text","value","computed","__cachedBorder","this","data","staticClass","class","setBackgroundColor","$createElement","__cachedDismissible","color","small","attrs","$vuetify","lang","t","on","click","__cachedIcon","iconColor","classes","computedColor","computedIcon","includes","hasColoredIcon","hasText","isDark","created","$attrs","hasOwnProperty","methods","genWrapper","children","$slots","prepend","$scopedSlots","close","toggle","genContent","genAlert","role","style","directives","isActive","setColor","render","h","origin","mode","JanusPlugin","SdpHelper","StreamingJanusPlugin","logger","filterDirectCandidates","super","janusEchoBody","audio","video","pluginName","sdpHelper","parameters","body","Object","assign","request","transaction","then","json","error_code","error","Error","catch","err","id","permanent","Promise","resolve","reject","param","streaming","jsep","result","status","emit","sdp","message","candidate","isDirectCandidate","module","exports","_vm","_h","_c","_self","navColor","_v","_l","stream","key","_s","model","callback","$$v","$set","expression","keys","videostreams","length","_e","ref","refInFor","streamStatus","action","cleanBitrate","statBitrate","statPacketloss","url","webrtcEndpoint","refWidth","$event","updateStatus","updatePacketloss","updateBitrate","staticRenderFns","videostream","width","domProps","config","Number","String","lastStats","watch","handler","logDebug","start","stremaing","pause","stop","beforeDestroy","clearInterval","bitrateInterval","bufferingInterval","mounted","setInterval","$emit","janus","connect","addPlugin","peerConnection","onicecandidate","event","sdpMid","sdpMLineIndex","onaddstream","videoElement","srcObject","mediaStreamEvent","play","lastPosition","currentTime","paused","setRemoteDescription","RTCSessionDescription","createAnswer","setLocalDescription","answer","component","components","VideoStream","actionState","bitrate","resolution","activeStream","$store","state","window","addEventListener","changeStream","Math","round","$refs","el","clientWidth","VAlert","VBtn","VCard","VCardText","VCardTitle","VChip","VCol","VContainer","VContent","VIcon","VLayout","VRow","VSpacer","VSwitch","VSystemBar","VToolbar","VToolbarTitle","byteToHex","i","toString","substr","bytesToUuid","buf","offset","bth","join","SDPUtils","random","localCName","generateIdentifier","splitLines","blob","trim","split","map","line","splitSections","parts","part","index","getDescription","sections","getMediaSections","shift","matchPrefix","prefix","filter","indexOf","parseCandidate","substring","foundation","parseInt","protocol","toLowerCase","priority","ip","address","port","relatedAddress","relatedPort","tcpType","ufrag","usernameFragment","writeCandidate","push","toUpperCase","parseIceOptions","parseRtpMap","parsed","payloadType","clockRate","channels","numChannels","writeRtpMap","codec","pt","undefined","preferredPayloadType","parseExtmap","direction","uri","writeExtmap","headerExtension","preferredId","parseFmtp","kv","j","writeFmtp","params","forEach","parseRtcpFb","parameter","writeRtcpFb","lines","rtcpFeedback","fb","parseSsrcMedia","sp","ssrc","colon","attribute","parseSsrcGroup","semantics","ssrcs","getMid","mediaSection","mid","parseFingerprint","algorithm","getDtlsParameters","sessionpart","fingerprints","writeDtlsParameters","setupType","fp","parseCryptoLine","tag","cryptoSuite","keyParams","sessionParams","slice","writeCryptoLine","writeCryptoKeyParams","parseCryptoKeyParams","keyMethod","keySalt","lifeTime","mkiValue","mkiLength","getCryptoParameters","getIceParameters","pwd","password","writeIceParameters","parseRtpParameters","description","codecs","headerExtensions","fecMechanisms","rtcp","mline","rtpmapline","fmtps","writeRtpDescription","kind","caps","maxptime","extension","parseRtpEncodingParameters","secondarySsrc","encodingParameters","hasRed","hasUlpfec","primarySsrc","flows","apt","encParam","codecPayloadType","rtx","JSON","parse","stringify","fec","mechanism","bandwidth","maxBitrate","parseRtcpParameters","rtcpParameters","remoteSsrc","obj","cname","rsize","reducedSize","compound","mux","parseMsid","spec","track","planB","msidParts","parseSctpDescription","maxMessageSize","parseMLine","maxSizeLine","isNaN","sctpPort","fmt","sctpMapLines","writeSctpDescription","media","sctp","output","generateSessionId","writeSessionBoilerplate","sessId","sessVer","sessUser","sessionId","version","user","writeMediaSection","transceiver","iceGatherer","getLocalParameters","dtlsTransport","rtpSender","rtpReceiver","msid","sendEncodingParameters","getDirection","getKind","isRejected","parseOLine","username","sessionVersion","netType","addressType","isValidSDP","charAt","WebSocket","uuid","ignoredErrorCodes","Janus","ws","isConnected","transactions","pluginHandles","sendCreate","options","cleanup","keepAlive","debug","replyType","send","onMessage","onClose","plugin","getAttachPayload","success","payload","timeoutMs","transactionId","setTimeout","session_id","janusHandleId","handle_id","detach","messageEvent","getTransaction","pluginData","plugindata","sender","pluginHandle","warn","webrtcState","reason","hangup","mediaState","receiving","slowLink","uplink","nacks","onmessage","code","isScheduled","keepAliveIntervalMs","ignoreReplyType","prototype","call","ret","_cleanupPlugins","_cleanupWebSocket","_cleanupTransactions","removeAllListeners","readyState","OPEN","pluginId","SdpUtils","VideoRoomPublisherJanusPlugin","display","janusRoomId","janusRoomMemberId","janusRoomPrivateMemberId","offerSdp","answerSdp","rtpForwardVideoStreamId","rtpForwardAudioStreamId","rtpForwardDataStreamId","host","videoPortNumber","audioPortNumber","room","publisher_id","video_port","audio_port","rtp_stream","video_stream_id","audio_stream_id","data_stream_id","rtpSdp","section","rtp","stopRTPForwardStream","all","streamId","stream_id","new_bitrate","Array","isArray","list","foundRoom","find","createRoom","ptype","private_id","publishers","record","videocodec","rec_dir","recordDirectory","videoorient_ext","videoOrientExt","firSeconds","fir_freq","offer","relayAudio","relayVideo","videoroom","unpublished","leaving","e","JanusAdmin","msg","admin_secret","secret","r","sessions","handles","handleId","info","EchoJanusPlugin","isMuted","echotest","destroyPlugin","sendData","EventEmitter","opaque_id","additionalFields","cause","constructor","medium","isReady","allowedProfiles","newSection","rtpSections","l","rtpSection","fmtp","isAllowed","allowedProfile","RegExp","test","force","haveCandidates","haveNonDirectCandidates","startsWith","stack","candidateLine","VideoRoomListenerJanusPlugin","roomId","roomMemberPrivateId","remoteFeedId","janusRemoteFeedId","offerAudio","offerVideo","feed","offer_video","offer_audio","started","RecordPlayJanusPlugin","JanusConfig","JanusAdminConfig","JanusRoomConfig","rng","v4","rnds","ii","sessionListIntervalMs","videoBitrateMax","videoKeyframeInterval","recordplay","getRandomValues","crypto","bind","msCrypto","rnds8","Uint8Array","ReflectOwnKeys","R","Reflect","ReflectApply","apply","target","receiver","args","Function","ProcessEmitWarning","warning","console","ownKeys","getOwnPropertySymbols","getOwnPropertyNames","concat","NumberIsNaN","init","_events","_eventsCount","_maxListeners","defaultMaxListeners","checkListener","listener","TypeError","_getMaxListeners","that","_addListener","m","events","existing","create","newListener","unshift","warned","w","emitter","count","onceWrapper","fired","removeListener","wrapFn","arguments","_onceWrap","wrapped","_listeners","unwrap","evlistener","unwrapListeners","arrayClone","listenerCount","arr","n","copy","spliceOne","pop","defineProperty","enumerable","get","set","arg","RangeError","getPrototypeOf","setMaxListeners","getMaxListeners","doError","er","context","len","listeners","addListener","prependListener","once","prependOnceListener","position","originalListener","off","rawListeners","eventNames"],"mappings":"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","file":"js/chunk-e4fc0dec.4085013d.js","sourcesContent":["// Styles\nimport './VAlert.sass'\n\n// Extensions\nimport VSheet from '../VSheet'\n\n// Components\nimport VBtn from '../VBtn'\nimport VIcon from '../VIcon'\n\n// Mixins\nimport Toggleable from '../../mixins/toggleable'\nimport Themeable from '../../mixins/themeable'\nimport Transitionable from '../../mixins/transitionable'\n\n// Utilities\nimport mixins from '../../util/mixins'\nimport { breaking } from '../../util/console'\n\n// Types\nimport { VNodeData } from 'vue'\nimport { VNode } from 'vue/types'\n\n/* @vue/component */\nexport default mixins(\n  VSheet,\n  Toggleable,\n  Transitionable\n).extend({\n  name: 'v-alert',\n\n  props: {\n    border: {\n      type: String,\n      validator (val: string) {\n        return [\n          'top',\n          'right',\n          'bottom',\n          'left',\n        ].includes(val)\n      },\n    },\n    closeLabel: {\n      type: String,\n      default: '$vuetify.close',\n    },\n    coloredBorder: Boolean,\n    dense: Boolean,\n    dismissible: Boolean,\n    icon: {\n      default: '',\n      type: [Boolean, String],\n      validator (val: boolean | string) {\n        return typeof val === 'string' || val === false\n      },\n    },\n    outlined: Boolean,\n    prominent: Boolean,\n    text: Boolean,\n    type: {\n      type: String,\n      validator (val: string) {\n        return [\n          'info',\n          'error',\n          'success',\n          'warning',\n        ].includes(val)\n      },\n    },\n    value: {\n      type: Boolean,\n      default: true,\n    },\n  },\n\n  computed: {\n    __cachedBorder (): VNode | null {\n      if (!this.border) return null\n\n      let data: VNodeData = {\n        staticClass: 'v-alert__border',\n        class: {\n          [`v-alert__border--${this.border}`]: true,\n        },\n      }\n\n      if (this.coloredBorder) {\n        data = this.setBackgroundColor(this.computedColor, data)\n        data.class['v-alert__border--has-color'] = true\n      }\n\n      return this.$createElement('div', data)\n    },\n    __cachedDismissible (): VNode | null {\n      if (!this.dismissible) return null\n\n      const color = this.iconColor\n\n      return this.$createElement(VBtn, {\n        staticClass: 'v-alert__dismissible',\n        props: {\n          color,\n          icon: true,\n          small: true,\n        },\n        attrs: {\n          'aria-label': this.$vuetify.lang.t(this.closeLabel),\n        },\n        on: {\n          click: () => (this.isActive = false),\n        },\n      }, [\n        this.$createElement(VIcon, {\n          props: { color },\n        }, '$cancel'),\n      ])\n    },\n    __cachedIcon (): VNode | null {\n      if (!this.computedIcon) return null\n\n      return this.$createElement(VIcon, {\n        staticClass: 'v-alert__icon',\n        props: { color: this.iconColor },\n      }, this.computedIcon)\n    },\n    classes (): object {\n      const classes: Record<string, boolean> = {\n        ...VSheet.options.computed.classes.call(this),\n        'v-alert--border': Boolean(this.border),\n        'v-alert--dense': this.dense,\n        'v-alert--outlined': this.outlined,\n        'v-alert--prominent': this.prominent,\n        'v-alert--text': this.text,\n      }\n\n      if (this.border) {\n        classes[`v-alert--border-${this.border}`] = true\n      }\n\n      return classes\n    },\n    computedColor (): string {\n      return this.color || this.type\n    },\n    computedIcon (): string | boolean {\n      if (this.icon === false) return false\n      if (typeof this.icon === 'string' && this.icon) return this.icon\n      if (!['error', 'info', 'success', 'warning'].includes(this.type)) return false\n\n      return `$${this.type}`\n    },\n    hasColoredIcon (): boolean {\n      return (\n        this.hasText ||\n        (Boolean(this.border) && this.coloredBorder)\n      )\n    },\n    hasText (): boolean {\n      return this.text || this.outlined\n    },\n    iconColor (): string | undefined {\n      return this.hasColoredIcon ? this.computedColor : undefined\n    },\n    isDark (): boolean {\n      if (\n        this.type &&\n        !this.coloredBorder &&\n        !this.outlined\n      ) return true\n\n      return Themeable.options.computed.isDark.call(this)\n    },\n  },\n\n  created () {\n    /* istanbul ignore next */\n    if (this.$attrs.hasOwnProperty('outline')) {\n      breaking('outline', 'outlined', this)\n    }\n  },\n\n  methods: {\n    genWrapper (): VNode {\n      const children = [\n        this.$slots.prepend || this.__cachedIcon,\n        this.genContent(),\n        this.__cachedBorder,\n        this.$slots.append,\n        this.$scopedSlots.close\n          ? this.$scopedSlots.close({ toggle: this.toggle })\n          : this.__cachedDismissible,\n      ]\n\n      const data: VNodeData = {\n        staticClass: 'v-alert__wrapper',\n      }\n\n      return this.$createElement('div', data, children)\n    },\n    genContent (): VNode {\n      return this.$createElement('div', {\n        staticClass: 'v-alert__content',\n      }, this.$slots.default)\n    },\n    genAlert (): VNode {\n      let data: VNodeData = {\n        staticClass: 'v-alert',\n        attrs: {\n          role: 'alert',\n        },\n        class: this.classes,\n        style: this.styles,\n        directives: [{\n          name: 'show',\n          value: this.isActive,\n        }],\n      }\n\n      if (!this.coloredBorder) {\n        const setColor = this.hasText ? this.setTextColor : this.setBackgroundColor\n        data = setColor(this.computedColor, data)\n      }\n\n      return this.$createElement('div', data, [this.genWrapper()])\n    },\n    /** @public */\n    toggle () {\n      this.isActive = !this.isActive\n    },\n  },\n\n  render (h): VNode {\n    const render = this.genAlert()\n\n    if (!this.transition) return render\n\n    return h('transition', {\n      props: {\n        name: this.transition,\n        origin: this.origin,\n        mode: this.mode,\n      },\n    }, [render])\n  },\n})\n","const JanusPlugin = require('../JanusPlugin')\nconst SdpHelper = require('../SdpHelper')\n\nclass StreamingJanusPlugin extends JanusPlugin {\n  constructor (logger, filterDirectCandidates = false) {\n    super(logger)\n    this.filterDirectCandidates = !!filterDirectCandidates\n    this.janusEchoBody = { audio: true, video: true }\n    this.pluginName = 'janus.plugin.streaming'\n    this.sdpHelper = new SdpHelper(this.logger)\n  }\n\n  /**\n   * Type param can be: rtp, rtsp, live, ondemand\n   *\n   * Common parameters:\n   *   - id: positive integer, optional, random will be used if not present\n   *   - name: string - optional\n   *   - description: string - optional\n   *   - audio: boolean - optional, default false\n   *   - video: boolean - optional, default false\n   *   - is_private: boolean, optional, default: false\n   *   - pin\n   *   - secret\n   *   - permanent\n   *\n   * Plus parameters:\n   *  - rtp:\n   *     - data: boolean - optional, default false\n   *     - collision\n   *     - srtpsuite\n   *     - srtpcrypto\n   *\n   *  - live: filename\n   *  - ondemand: filename\n   *  - rtsp: url, rtsp_user, rtsp_pwd, audiortpmap, audiofmtp, videortpmap, videofmtp, rtspiface\n   *\n   * @returns {Promise<T>}\n   */\n  create (parameters) {\n    const body = Object.assign(parameters, { request: 'create' })\n\n    return this.transaction('message', { body }, 'success').then(({ data, json }) => {\n      if (data.error_code) {\n        this.logger.error('StreamingJanusPlugin error while create', data)\n        throw new Error('StreamingJanusPlugin error while create')\n      }\n      return { data, json }\n    }).catch((err) => {\n      this.logger.error('StreamingJanusPlugin, cannot create stream', err)\n      throw err\n    })\n  }\n\n  destroy (id, permanent = false) {\n    const body = { request: 'destroy', id, permanent }\n\n    return this.transaction('message', { body }, 'success').catch((err) => {\n      this.logger.error('StreamingJanusPlugin, cannot destroy stream', err)\n      throw err\n    })\n  }\n\n  list () {\n    const body = { request: 'list' }\n\n    return this.transaction('message', { body }, 'success').catch((err) => {\n      this.logger.error('StreamingJanusPlugin, cannot list streams', err)\n      throw err\n    })\n  }\n\n  watch (id) {\n    const body = { request: 'watch', id }\n\n    return new Promise((resolve, reject) => {\n      this.transaction('message', { body }, 'event').then((param) => {\n        const { data, json } = param || {}\n\n        if (!data || data.streaming !== 'event') {\n          this.logger.error('StreamingJanusPlugin watch error ', data, json)\n          throw new Error('StreamingJanusPlugin watch error')\n        }\n        if (!json.jsep) {\n          this.logger.error('StreamingJanusPlugin watch answer does not contains jsep', data, json)\n          throw new Error('StreamingJanusPlugin watch answer does not contains jsep')\n        }\n\n        if (data.result && data.result.status) {\n          this.emit('statusChange', data.result.status)\n        }\n\n        const jsep = json.jsep\n        if (this.filterDirectCandidates && jsep.sdp) {\n          jsep.sdp = this.sdpHelper.filterDirectCandidates(jsep.sdp)\n        }\n\n        this.emit('jsep', jsep)\n        resolve(jsep)\n      }).catch((err) => {\n        this.logger.error('StreamingJanusPlugin, cannot watch stream', err)\n        reject(err)\n      })\n    })\n  }\n\n  start (jsep) {\n    const body = { request: 'start' }\n    const message = { body }\n    if (jsep) {\n      message.jsep = jsep\n    }\n\n    return this.transaction('message', message, 'event').then(({ data, json }) => {\n      if (data.result && data.result.status) {\n        this.emit('statusChange', data.result.status)\n      }\n      return { data, json }\n    }).catch((err) => {\n      this.logger.error('StreamingJanusPlugin, cannot start stream', err)\n      throw err\n    })\n  }\n\n  stop () {\n    const body = { request: 'stop' }\n\n    return this.transaction('message', { body }, 'event').then(({ data, json }) => {\n      if (data.result && data.result.status) {\n        this.emit('statusChange', data.result.status)\n      }\n      return { data, json }\n    }).catch((err) => {\n      this.logger.error('StreamingJanusPlugin, cannot start stream', err)\n      throw err\n    })\n  }\n\n  pause () {\n    const body = { request: 'pause' }\n\n    return this.transaction('message', { body }, 'event').then(({ data, json }) => {\n      if (data.result && data.result.status) {\n        this.emit('statusChange', data.result.status)\n      }\n      return { data, json }\n    }).catch((err) => {\n      this.logger.error('StreamingJanusPlugin, cannot start stream', err)\n      throw err\n    })\n  }\n\n  info (id) {\n    const body = { request: 'info', id }\n\n    return this.transaction('message', { body }, 'success').catch((err) => {\n      this.logger.error('StreamingJanusPlugin, cannot start stream', err)\n      throw err\n    })\n  }\n\n  switch (id) {\n    const body = { request: 'switch', id }\n\n    return this.transaction('message', { body }, 'event').catch((err) => {\n      this.logger.error('StreamingJanusPlugin, cannot start stream', err)\n      throw err\n    })\n  }\n\n  onmessage (data, json) {\n    if (data && data.streaming === 'event' && data.result && data.result.status) {\n      this.emit('statusChange', data.result.status)\n    } else {\n      this.logger.error('StreamingJanusPlugin got unknown message', data, json)\n    }\n  }\n\n  candidate (candidate) {\n    if (this.filterDirectCandidates && candidate.candidate && this.sdpHelper.isDirectCandidate(candidate.candidate)) {\n      return\n    }\n\n    return this.transaction('trickle', { candidate })\n  }\n}\n\nmodule.exports = StreamingJanusPlugin\n","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('v-content',[_c('v-container',[_c('v-card',{staticClass:\"mx-auto\"},[_c('v-toolbar',{attrs:{\"color\":_vm.navColor,\"dense\":\"\"}},[_c('v-toolbar-title',[_vm._v(\"Video Streams\")]),_c('v-spacer'),_c('v-btn',{attrs:{\"to\":\"/config/video\",\"color\":_vm.navColor}},[_c('v-icon',{attrs:{\"left\":\"\"}},[_vm._v(\"mdi-plus\")]),_c('span',[_vm._v(\"configure\")])],1)],1),_c('v-container',{attrs:{\"fluid\":\"\"}},[_c('v-row',{attrs:{\"dense\":\"\"}},_vm._l((_vm.videostreams),function(stream){return _c('v-col',{key:stream.key,attrs:{\"xs\":\"12\",\"sm\":\"12\",\"md\":\"6\",\"lg\":\"6\",\"xl\":\"6\"}},[_c('v-card',{staticClass:\"mx-auto\",attrs:{\"raised\":\"\"}},[_c('v-card-title',{staticClass:\"headline\"},[_c('span',[_vm._v(_vm._s(stream.name))]),_c('v-spacer'),_c('v-switch',{attrs:{\"color\":\"green\",\"label\":(stream.enabled) ? 'Enabled' : 'Disabled'},model:{value:(stream.enabled),callback:function ($$v) {_vm.$set(stream, \"enabled\", $$v)},expression:\"stream.enabled\"}})],1)],1)],1)}),1),(!Object.keys(_vm.videostreams).length)?_c('v-alert',{attrs:{\"outlined\":\"\",\"border\":\"left\",\"type\":\"warning\"}},[_c('span',[_vm._v(\"No Video Streams are defined. Please define a video stream in \"),_c('v-btn',{attrs:{\"to\":\"/config/video\"}},[_vm._v(\"Config->Video\")])],1)]):_vm._e()],1)],1)],1),_c('v-container',{attrs:{\"fluid\":\"\"}},[_c('v-row',{attrs:{\"dense\":\"\"}},_vm._l((_vm.videostreams),function(stream){return (stream.enabled)?_c('v-col',{key:stream.key,attrs:{\"xs\":\"12\",\"sm\":\"12\",\"md\":\"12\",\"lg\":\"6\",\"xl\":\"6\"}},[_c('v-layout',{ref:'layout-'+stream.key,refInFor:true,attrs:{\"justify-center\":\"\",\"wrap\":\"\"}},[_c('v-card',{staticClass:\"mx-auto\"},[_c('v-system-bar',{attrs:{\"color\":_vm.navColor,\"window\":\"\"}},[_c('span',[_vm._v(\"Video Stream: \"+_vm._s(stream.name))])]),_c('v-card-text',[(_vm.streamStatus[stream.key]=='playing')?_c('v-chip',{staticClass:\"ma-2\",attrs:{\"color\":\"green\"}},[_c('v-icon',{attrs:{\"left\":\"\"}},[_vm._v(\"mdi-check-circle\")]),_c('span',[_vm._v(\"Playing\")])],1):(_vm.streamStatus[stream.key]=='buffering' || stream.action == 'stop')?_c('v-chip',{staticClass:\"ma-2\",attrs:{\"color\":\"amber\"}},[_c('v-icon',{attrs:{\"left\":\"\"}},[_vm._v(\"mdi-alert\")]),_c('span',[_vm._v(\"Buffering\")])],1):_c('v-chip',{staticClass:\"ma-2\",attrs:{\"color\":\"red\"}},[_c('v-icon',{attrs:{\"left\":\"\"}},[_vm._v(\"mdi-alert-circle\")]),_c('span',[_vm._v(\"Stopped\")])],1),_c('span',[_vm._v(\"Bitrate\"),_c('v-chip',{staticClass:\"ma-2\",attrs:{\"color\":\"blue\"}},[_c('strong',[_vm._v(_vm._s(_vm.cleanBitrate(_vm.statBitrate[stream.key])))])])],1),_c('span',[_vm._v(\"Packet Loss\"),_c('v-chip',{staticClass:\"ma-2\",attrs:{\"color\":\"red\"}},[_c('strong',[_vm._v(_vm._s(_vm.statPacketloss[stream.key]))])])],1)],1),_c('VideoStream',{attrs:{\"config\":{ url: stream.webrtcEndpoint },\"videostream\":stream.key,\"width\":_vm.refWidth('layout-'+stream.key),\"stream\":1,\"action\":stream.action},on:{\"status\":function($event){return _vm.updateStatus(stream.key, $event)},\"packetloss\":function($event){return _vm.updatePacketloss(stream.key, $event)},\"bitrate\":function($event){return _vm.updateBitrate(stream.key, $event)}}})],1)],1)],1):_vm._e()}),1)],1)],1)}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('video',{staticClass:\"ma2 pa0\",attrs:{\"id\":_vm.videostream,\"controls\":\"\",\"autoPictureInPicture\":\"\",\"muted\":\"\",\"preload\":\"none\",\"poster\":\"/img/placeholders/video-placeholder.png\",\"width\":_vm.width},domProps:{\"muted\":true}})}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","<template lang='pug'>\n  video.ma2.pa0(:id='videostream' controls autoPictureInPicture=true muted=true preload=\"none\" poster=\"/img/placeholders/video-placeholder.png\" :width=\"width\")\n</template>\n\n<script>\n/* Note: you may need to add `externals: { ws: \"WebSocket\"},` to Your webpack configuration for this to work properly */\nimport { Janus, StreamingJanusPlugin } from '@techteamer/janus-api'\n\nexport default {\n  props: {\n    config: {\n      type: Object,\n      default: null\n    },  \n    stream: {\n      type: Number,\n      default: null\n    },\n    width: {\n      type: Number,\n      default: 500\n    },\n    videostream: {\n      type: String,\n      default: null\n    },\n    action: {\n      type: String,\n      default: null\n    }\n  },\n\n  data () {\n    return {\n      lastStats: null,\n      streaming: null\n    }\n  },\n\n  watch: {\n    action: {\n      handler: function (newValue) {\n        this.logDebug(`action: ${newValue}, ${this.action}`)\n        if (this.action == 'start') {\n          this.streaming.start()\n        } else if (this.action == 'pause') {\n          this.stremaing.pause()\n        } else if (this.action == 'stop') {\n          this.streaming.stop()\n        }\n      }\n    }\n  },\n\n  beforeDestroy () {\n    clearInterval(this.bitrateInterval)\n    clearInterval(this.bufferingInterval)\n  },\n  \n  mounted () {\n    let janus = this.janus = new Janus(this.config, console)\n    this.streaming = new StreamingJanusPlugin(console, false)\n    let peerConnection = new RTCPeerConnection()\n    let bitrate = 0\n    let packetloss = 0\n    this.bitrateInterval = setInterval(() => {\n\n    let selector = peerConnection.getReceivers().find(({kind}) => kind == \"video\");\n    peerConnection.getStats(selector).then((stats => stats.forEach(entry => {\n        if (entry.type == \"inbound-rtp\") {\n          if (this.lastStats) {\n            packetloss = entry.packetsLost\n            bitrate = (entry.bytesReceived - this.lastStats.bytesReceived) / (entry.lastPacketReceivedTimestamp - this.lastStats.lastPacketReceivedTimestamp)\n          }\n          this.lastStats = entry\n        }\n      })))\n      this.$emit('bitrate', bitrate)\n      this.$emit('packetloss', packetloss)\n    }, 1000)\n\n    this.$emit('status', 'init')\n    janus.connect().then(() => {\n      return janus.addPlugin(this.streaming)\n    }).then(() => {\n      // console.info('plugin added', janus)\n      peerConnection.onicecandidate = (event) => {\n        // console.log('@onicecandidate', event)\n        if (!event.candidate || !event.candidate.candidate) {\n          this.streaming.candidate({completed: true})\n        } else {\n          this.streaming.candidate({\n            candidate: event.candidate.candidate,\n            sdpMid: event.candidate.sdpMid,\n            sdpMLineIndex: event.candidate.sdpMLineIndex\n          })\n        }\n      }\n      peerConnection.onaddstream = (mediaStreamEvent) => {\n        let videoElement = document.getElementById(this.videostream)\n        videoElement.srcObject = mediaStreamEvent.stream\n        videoElement.play()\n        if (this.bufferingInterval == undefined) {\n          let lastPosition = 0\n          this.bufferintInterval = setInterval(() => {\n            if (lastPosition == videoElement.currentTime && !videoElement.paused) {\n              this.$emit('status', 'buffering')\n            } else {\n              this.$emit('status', 'playing')\n            }\n            lastPosition = videoElement.currentTime\n          }, 500)\n        }\n      }\n      // streaming.on('webrtcState', (a, b) => { console.log('webrtcState', a, b) })\n      // streaming.on('mediaState', (a, b) => { console.log('mediaState', a, b) })\n      this.streaming.on('statusChange', (status) => {\n        // console.log('statusChange', status)\n        this.$emit('status', status)\n      })\n      return this.streaming.watch(this.stream)\n    }).then((jsep) => {\n      return peerConnection.setRemoteDescription(new RTCSessionDescription(jsep))\n    }).then(() => {\n      // console.log('remoteDescription set')\n      return peerConnection.createAnswer({offerToReceiveAudio: true, offerToReceiveVideo: true})\n    }).then(answer => {\n      // console.log('answerCreated', answer)\n      peerConnection.setLocalDescription(answer)\n      return this.streaming.start(answer)\n    }).then(({body, json}) => {\n      // console.log('START', body, json)\n    })\n  },\n\n  methods: {\n\n  }\n}\n</script>","import mod from \"-!../../../../node_modules/cache-loader/dist/cjs.js??ref--12-0!../../../../node_modules/thread-loader/dist/cjs.js!../../../../node_modules/babel-loader/lib/index.js!../../../../node_modules/vuetify-loader/lib/loader.js??ref--20-0!../../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./VideoStream.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../../../node_modules/cache-loader/dist/cjs.js??ref--12-0!../../../../node_modules/thread-loader/dist/cjs.js!../../../../node_modules/babel-loader/lib/index.js!../../../../node_modules/vuetify-loader/lib/loader.js??ref--20-0!../../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./VideoStream.vue?vue&type=script&lang=js&\"","import { render, staticRenderFns } from \"./VideoStream.vue?vue&type=template&id=cb83b216&lang=pug&\"\nimport script from \"./VideoStream.vue?vue&type=script&lang=js&\"\nexport * from \"./VideoStream.vue?vue&type=script&lang=js&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  null,\n  null\n  \n)\n\nexport default component.exports","<template lang='pug'>\nv-content\n\n  v-container\n    v-card.mx-auto\n      v-toolbar(:color=\"navColor\" dense)\n        v-toolbar-title Video Streams\n        v-spacer\n        v-btn(to='/config/video' :color=\"navColor\")\n          v-icon(left) mdi-plus\n          span configure\n      v-container(fluid)\n        v-row(dense)\n          v-col(v-for=\"stream in videostreams\" :key=\"stream.key\" xs=12 sm=12 md=6 lg=6 xl=6)\n            v-card(raised).mx-auto\n              v-card-title.headline\n                span {{ stream.name }}\n                v-spacer\n                v-switch(color='green' v-model='stream.enabled' :label=\"(stream.enabled) ? 'Enabled' : 'Disabled'\")               \n        v-alert(v-if=\"!Object.keys(videostreams).length\" outlined border=\"left\" type=\"warning\")\n          span No Video Streams are defined.  Please define a video stream in <v-btn to='/config/video'>Config->Video</v-btn>\n\n  v-container(fluid)\n      v-row(dense)\n\n        v-col(v-for=\"stream in videostreams\" :key='stream.key' v-if=\"stream.enabled\" xs=12 sm=12 md=12 lg=6 xl=6)\n          v-layout(justify-center wrap :ref=\"'layout-'+stream.key\")\n            v-card.mx-auto()\n              v-system-bar(:color=\"navColor\" window)\n                span Video Stream: {{ stream.name }}\n              v-card-text\n                v-chip.ma-2(v-if=\"streamStatus[stream.key]=='playing'\" color='green')\n                  v-icon(left) mdi-check-circle\n                  span Playing\n                v-chip.ma-2(v-else-if=\"streamStatus[stream.key]=='buffering' || stream.action == 'stop'\" color='amber')\n                  v-icon(left) mdi-alert\n                  span Buffering\n                v-chip.ma-2(v-else color='red')\n                  v-icon(left) mdi-alert-circle\n                  span Stopped\n                span Bitrate\n                  v-chip.ma-2(color='blue') <strong>{{ cleanBitrate(statBitrate[stream.key]) }}</strong>\n                span Packet Loss\n                  v-chip.ma-2(color='red') <strong>{{ statPacketloss[stream.key] }}</strong>\n              VideoStream(:config=\"{ url: stream.webrtcEndpoint }\" :videostream=\"stream.key\" :width=\"refWidth('layout-'+stream.key)\" :stream=\"1\" :action=\"stream.action\" @status=\"updateStatus(stream.key, $event)\" @packetloss=\"updatePacketloss(stream.key, $event)\" @bitrate=\"updateBitrate(stream.key, $event)\")\n              // v-card-text\n                v-layout.d-flex.justify-space-between(flat)\n                  // div\n                    v-btn-toggle.ma-2(v-model=\"actionState\" shaped mandatory dense)\n                      v-btn(color='green' @click=\"stream.action='start'\")\n                        v-icon(left) mdi-play\n                        span Start\n                      v-btn(color='red' @click=\"stream.action='stop'\")\n                        v-icon(left) mdi-stop\n                        span Stop\n                // span BitRate\n                  v-btn-toggle.ma-2(v-model=\"bitrate\" mandatory background-color='blue' active-class='blue' dense)\n                    v-btn(value='128') 128K\n                    v-btn(value='256') 256K\n                    v-btn(value='512') 512K\n                    v-btn(value='1024') 1M\n                    v-btn(value='2048') 2M\n\n                // div\n                  span Resolution\n                  v-btn-toggle.ma-2(v-model=\"resolution\" mandatory background-color='purple' active-class='purple' dense)\n                    v-btn(value='480p') 480p\n                    v-btn(value='720p') 720p\n                    v-btn(value='1080p') 1080p\n                    v-btn(value='2k') 2k\n                    v-btn(value='4k') 4k\n\n</template>\n\n<script>\nimport VideoStream from './VideoStream.vue'\n\nexport default {\n  name: 'VideoModule',\n  components: {\n    VideoStream\n  },\n  data () {\n    return {\n      actionState: 'start',\n      streamStatus: {'nano': null, 'raspberry': null},\n      statBitrate: {'nano': null, 'raspberry': null},\n      statPacketloss: {'nano': null, 'raspberry': null},\n      bitrate: '256',\n      resolution: '720p',\n      activeStream: null,\n      width: 500\n    }\n  },\n  computed: {\n    videostreams () {\n      return this.$store.state.data.videostreams\n    }\n  },\n  watch: {\n  },\n  mounted () {\n    window.addEventListener('resize', () => {\n      this.width = ((75 / 100) * window.innerWidth)\n    })\n  },\n  methods: {\n    updateStatus (key, $event) {\n      if (!(this.streamStatus.hasOwnProperty(key))) {\n        this.$set(this.streamStatus, key, $event)\n      } else {\n        this.streamStatus[key] = $event\n      }\n    },\n    updateBitrate (key, $event) {\n      if (!(this.statBitrate.hasOwnProperty(key))) {\n        this.$set(this.statBitrate, key, $event)\n      } else {\n        this.statBitrate[key] = $event\n      }\n    },\n    updatePacketloss (key, $event) {\n      if (!(this.statPacketloss.hasOwnProperty(key))) {\n        this.$set(this.statPacketloss, key, $event)\n      } else {\n        this.statPacketloss[key] = $event\n      }\n    },\n    changeStream (stream) {\n      this.activeStream = stream\n    },\n    cleanBitrate (bitrate) {\n      // console.log(bitrate)\n      if (bitrate / 1000 < 1000) {\n        return Math.round(bitrate / 1000) + ' K'\n      } else {\n        return Math.round(bitrate / 1000000) + ' M'\n      }\n    },\n    refWidth (el) {\n      let width = null\n      try {\n        width = this.$refs[el][0].clientWidth\n      } catch (err) {\n\n      }\n      return width\n    }\n  }\n}\n</script>\n\n<style scoped>\n</style>\n","import mod from \"-!../../../../node_modules/cache-loader/dist/cjs.js??ref--12-0!../../../../node_modules/thread-loader/dist/cjs.js!../../../../node_modules/babel-loader/lib/index.js!../../../../node_modules/vuetify-loader/lib/loader.js??ref--20-0!../../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./VideoModule.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../../../node_modules/cache-loader/dist/cjs.js??ref--12-0!../../../../node_modules/thread-loader/dist/cjs.js!../../../../node_modules/babel-loader/lib/index.js!../../../../node_modules/vuetify-loader/lib/loader.js??ref--20-0!../../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./VideoModule.vue?vue&type=script&lang=js&\"","import { render, staticRenderFns } from \"./VideoModule.vue?vue&type=template&id=7251af48&scoped=true&lang=pug&\"\nimport script from \"./VideoModule.vue?vue&type=script&lang=js&\"\nexport * from \"./VideoModule.vue?vue&type=script&lang=js&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  \"7251af48\",\n  null\n  \n)\n\nexport default component.exports\n\n/* vuetify-loader */\nimport installComponents from \"!../../../../node_modules/vuetify-loader/lib/runtime/installComponents.js\"\nimport { VAlert } from 'vuetify/lib/components/VAlert';\nimport { VBtn } from 'vuetify/lib/components/VBtn';\nimport { VCard } from 'vuetify/lib/components/VCard';\nimport { VCardText } from 'vuetify/lib/components/VCard';\nimport { VCardTitle } from 'vuetify/lib/components/VCard';\nimport { VChip } from 'vuetify/lib/components/VChip';\nimport { VCol } from 'vuetify/lib/components/VGrid';\nimport { VContainer } from 'vuetify/lib/components/VGrid';\nimport { VContent } from 'vuetify/lib/components/VContent';\nimport { VIcon } from 'vuetify/lib/components/VIcon';\nimport { VLayout } from 'vuetify/lib/components/VGrid';\nimport { VRow } from 'vuetify/lib/components/VGrid';\nimport { VSpacer } from 'vuetify/lib/components/VGrid';\nimport { VSwitch } from 'vuetify/lib/components/VSwitch';\nimport { VSystemBar } from 'vuetify/lib/components/VSystemBar';\nimport { VToolbar } from 'vuetify/lib/components/VToolbar';\nimport { VToolbarTitle } from 'vuetify/lib/components/VToolbar';\ninstallComponents(component, {VAlert,VBtn,VCard,VCardText,VCardTitle,VChip,VCol,VContainer,VContent,VIcon,VLayout,VRow,VSpacer,VSwitch,VSystemBar,VToolbar,VToolbarTitle})\n","/**\n * Convert array of 16 byte values to UUID string format of the form:\n * XXXXXXXX-XXXX-XXXX-XXXX-XXXXXXXXXXXX\n */\nvar byteToHex = [];\nfor (var i = 0; i < 256; ++i) {\n  byteToHex[i] = (i + 0x100).toString(16).substr(1);\n}\n\nfunction bytesToUuid(buf, offset) {\n  var i = offset || 0;\n  var bth = byteToHex;\n  // join used to fix memory issue caused by concatenation: https://bugs.chromium.org/p/v8/issues/detail?id=3175#c4\n  return ([\n    bth[buf[i++]], bth[buf[i++]],\n    bth[buf[i++]], bth[buf[i++]], '-',\n    bth[buf[i++]], bth[buf[i++]], '-',\n    bth[buf[i++]], bth[buf[i++]], '-',\n    bth[buf[i++]], bth[buf[i++]], '-',\n    bth[buf[i++]], bth[buf[i++]],\n    bth[buf[i++]], bth[buf[i++]],\n    bth[buf[i++]], bth[buf[i++]]\n  ]).join('');\n}\n\nmodule.exports = bytesToUuid;\n","/* eslint-env node */\n'use strict';\n\n// SDP helpers.\nvar SDPUtils = {};\n\n// Generate an alphanumeric identifier for cname or mids.\n// TODO: use UUIDs instead? https://gist.github.com/jed/982883\nSDPUtils.generateIdentifier = function() {\n  return Math.random().toString(36).substr(2, 10);\n};\n\n// The RTCP CNAME used by all peerconnections from the same JS.\nSDPUtils.localCName = SDPUtils.generateIdentifier();\n\n// Splits SDP into lines, dealing with both CRLF and LF.\nSDPUtils.splitLines = function(blob) {\n  return blob.trim().split('\\n').map(function(line) {\n    return line.trim();\n  });\n};\n// Splits SDP into sessionpart and mediasections. Ensures CRLF.\nSDPUtils.splitSections = function(blob) {\n  var parts = blob.split('\\nm=');\n  return parts.map(function(part, index) {\n    return (index > 0 ? 'm=' + part : part).trim() + '\\r\\n';\n  });\n};\n\n// returns the session description.\nSDPUtils.getDescription = function(blob) {\n  var sections = SDPUtils.splitSections(blob);\n  return sections && sections[0];\n};\n\n// returns the individual media sections.\nSDPUtils.getMediaSections = function(blob) {\n  var sections = SDPUtils.splitSections(blob);\n  sections.shift();\n  return sections;\n};\n\n// Returns lines that start with a certain prefix.\nSDPUtils.matchPrefix = function(blob, prefix) {\n  return SDPUtils.splitLines(blob).filter(function(line) {\n    return line.indexOf(prefix) === 0;\n  });\n};\n\n// Parses an ICE candidate line. Sample input:\n// candidate:702786350 2 udp 41819902 8.8.8.8 60769 typ relay raddr 8.8.8.8\n// rport 55996\"\nSDPUtils.parseCandidate = function(line) {\n  var parts;\n  // Parse both variants.\n  if (line.indexOf('a=candidate:') === 0) {\n    parts = line.substring(12).split(' ');\n  } else {\n    parts = line.substring(10).split(' ');\n  }\n\n  var candidate = {\n    foundation: parts[0],\n    component: parseInt(parts[1], 10),\n    protocol: parts[2].toLowerCase(),\n    priority: parseInt(parts[3], 10),\n    ip: parts[4],\n    address: parts[4], // address is an alias for ip.\n    port: parseInt(parts[5], 10),\n    // skip parts[6] == 'typ'\n    type: parts[7]\n  };\n\n  for (var i = 8; i < parts.length; i += 2) {\n    switch (parts[i]) {\n      case 'raddr':\n        candidate.relatedAddress = parts[i + 1];\n        break;\n      case 'rport':\n        candidate.relatedPort = parseInt(parts[i + 1], 10);\n        break;\n      case 'tcptype':\n        candidate.tcpType = parts[i + 1];\n        break;\n      case 'ufrag':\n        candidate.ufrag = parts[i + 1]; // for backward compability.\n        candidate.usernameFragment = parts[i + 1];\n        break;\n      default: // extension handling, in particular ufrag\n        candidate[parts[i]] = parts[i + 1];\n        break;\n    }\n  }\n  return candidate;\n};\n\n// Translates a candidate object into SDP candidate attribute.\nSDPUtils.writeCandidate = function(candidate) {\n  var sdp = [];\n  sdp.push(candidate.foundation);\n  sdp.push(candidate.component);\n  sdp.push(candidate.protocol.toUpperCase());\n  sdp.push(candidate.priority);\n  sdp.push(candidate.address || candidate.ip);\n  sdp.push(candidate.port);\n\n  var type = candidate.type;\n  sdp.push('typ');\n  sdp.push(type);\n  if (type !== 'host' && candidate.relatedAddress &&\n      candidate.relatedPort) {\n    sdp.push('raddr');\n    sdp.push(candidate.relatedAddress);\n    sdp.push('rport');\n    sdp.push(candidate.relatedPort);\n  }\n  if (candidate.tcpType && candidate.protocol.toLowerCase() === 'tcp') {\n    sdp.push('tcptype');\n    sdp.push(candidate.tcpType);\n  }\n  if (candidate.usernameFragment || candidate.ufrag) {\n    sdp.push('ufrag');\n    sdp.push(candidate.usernameFragment || candidate.ufrag);\n  }\n  return 'candidate:' + sdp.join(' ');\n};\n\n// Parses an ice-options line, returns an array of option tags.\n// a=ice-options:foo bar\nSDPUtils.parseIceOptions = function(line) {\n  return line.substr(14).split(' ');\n};\n\n// Parses an rtpmap line, returns RTCRtpCoddecParameters. Sample input:\n// a=rtpmap:111 opus/48000/2\nSDPUtils.parseRtpMap = function(line) {\n  var parts = line.substr(9).split(' ');\n  var parsed = {\n    payloadType: parseInt(parts.shift(), 10) // was: id\n  };\n\n  parts = parts[0].split('/');\n\n  parsed.name = parts[0];\n  parsed.clockRate = parseInt(parts[1], 10); // was: clockrate\n  parsed.channels = parts.length === 3 ? parseInt(parts[2], 10) : 1;\n  // legacy alias, got renamed back to channels in ORTC.\n  parsed.numChannels = parsed.channels;\n  return parsed;\n};\n\n// Generate an a=rtpmap line from RTCRtpCodecCapability or\n// RTCRtpCodecParameters.\nSDPUtils.writeRtpMap = function(codec) {\n  var pt = codec.payloadType;\n  if (codec.preferredPayloadType !== undefined) {\n    pt = codec.preferredPayloadType;\n  }\n  var channels = codec.channels || codec.numChannels || 1;\n  return 'a=rtpmap:' + pt + ' ' + codec.name + '/' + codec.clockRate +\n      (channels !== 1 ? '/' + channels : '') + '\\r\\n';\n};\n\n// Parses an a=extmap line (headerextension from RFC 5285). Sample input:\n// a=extmap:2 urn:ietf:params:rtp-hdrext:toffset\n// a=extmap:2/sendonly urn:ietf:params:rtp-hdrext:toffset\nSDPUtils.parseExtmap = function(line) {\n  var parts = line.substr(9).split(' ');\n  return {\n    id: parseInt(parts[0], 10),\n    direction: parts[0].indexOf('/') > 0 ? parts[0].split('/')[1] : 'sendrecv',\n    uri: parts[1]\n  };\n};\n\n// Generates a=extmap line from RTCRtpHeaderExtensionParameters or\n// RTCRtpHeaderExtension.\nSDPUtils.writeExtmap = function(headerExtension) {\n  return 'a=extmap:' + (headerExtension.id || headerExtension.preferredId) +\n      (headerExtension.direction && headerExtension.direction !== 'sendrecv'\n        ? '/' + headerExtension.direction\n        : '') +\n      ' ' + headerExtension.uri + '\\r\\n';\n};\n\n// Parses an ftmp line, returns dictionary. Sample input:\n// a=fmtp:96 vbr=on;cng=on\n// Also deals with vbr=on; cng=on\nSDPUtils.parseFmtp = function(line) {\n  var parsed = {};\n  var kv;\n  var parts = line.substr(line.indexOf(' ') + 1).split(';');\n  for (var j = 0; j < parts.length; j++) {\n    kv = parts[j].trim().split('=');\n    parsed[kv[0].trim()] = kv[1];\n  }\n  return parsed;\n};\n\n// Generates an a=ftmp line from RTCRtpCodecCapability or RTCRtpCodecParameters.\nSDPUtils.writeFmtp = function(codec) {\n  var line = '';\n  var pt = codec.payloadType;\n  if (codec.preferredPayloadType !== undefined) {\n    pt = codec.preferredPayloadType;\n  }\n  if (codec.parameters && Object.keys(codec.parameters).length) {\n    var params = [];\n    Object.keys(codec.parameters).forEach(function(param) {\n      if (codec.parameters[param]) {\n        params.push(param + '=' + codec.parameters[param]);\n      } else {\n        params.push(param);\n      }\n    });\n    line += 'a=fmtp:' + pt + ' ' + params.join(';') + '\\r\\n';\n  }\n  return line;\n};\n\n// Parses an rtcp-fb line, returns RTCPRtcpFeedback object. Sample input:\n// a=rtcp-fb:98 nack rpsi\nSDPUtils.parseRtcpFb = function(line) {\n  var parts = line.substr(line.indexOf(' ') + 1).split(' ');\n  return {\n    type: parts.shift(),\n    parameter: parts.join(' ')\n  };\n};\n// Generate a=rtcp-fb lines from RTCRtpCodecCapability or RTCRtpCodecParameters.\nSDPUtils.writeRtcpFb = function(codec) {\n  var lines = '';\n  var pt = codec.payloadType;\n  if (codec.preferredPayloadType !== undefined) {\n    pt = codec.preferredPayloadType;\n  }\n  if (codec.rtcpFeedback && codec.rtcpFeedback.length) {\n    // FIXME: special handling for trr-int?\n    codec.rtcpFeedback.forEach(function(fb) {\n      lines += 'a=rtcp-fb:' + pt + ' ' + fb.type +\n      (fb.parameter && fb.parameter.length ? ' ' + fb.parameter : '') +\n          '\\r\\n';\n    });\n  }\n  return lines;\n};\n\n// Parses an RFC 5576 ssrc media attribute. Sample input:\n// a=ssrc:3735928559 cname:something\nSDPUtils.parseSsrcMedia = function(line) {\n  var sp = line.indexOf(' ');\n  var parts = {\n    ssrc: parseInt(line.substr(7, sp - 7), 10)\n  };\n  var colon = line.indexOf(':', sp);\n  if (colon > -1) {\n    parts.attribute = line.substr(sp + 1, colon - sp - 1);\n    parts.value = line.substr(colon + 1);\n  } else {\n    parts.attribute = line.substr(sp + 1);\n  }\n  return parts;\n};\n\nSDPUtils.parseSsrcGroup = function(line) {\n  var parts = line.substr(13).split(' ');\n  return {\n    semantics: parts.shift(),\n    ssrcs: parts.map(function(ssrc) {\n      return parseInt(ssrc, 10);\n    })\n  };\n};\n\n// Extracts the MID (RFC 5888) from a media section.\n// returns the MID or undefined if no mid line was found.\nSDPUtils.getMid = function(mediaSection) {\n  var mid = SDPUtils.matchPrefix(mediaSection, 'a=mid:')[0];\n  if (mid) {\n    return mid.substr(6);\n  }\n};\n\nSDPUtils.parseFingerprint = function(line) {\n  var parts = line.substr(14).split(' ');\n  return {\n    algorithm: parts[0].toLowerCase(), // algorithm is case-sensitive in Edge.\n    value: parts[1]\n  };\n};\n\n// Extracts DTLS parameters from SDP media section or sessionpart.\n// FIXME: for consistency with other functions this should only\n//   get the fingerprint line as input. See also getIceParameters.\nSDPUtils.getDtlsParameters = function(mediaSection, sessionpart) {\n  var lines = SDPUtils.matchPrefix(mediaSection + sessionpart,\n    'a=fingerprint:');\n  // Note: a=setup line is ignored since we use the 'auto' role.\n  // Note2: 'algorithm' is not case sensitive except in Edge.\n  return {\n    role: 'auto',\n    fingerprints: lines.map(SDPUtils.parseFingerprint)\n  };\n};\n\n// Serializes DTLS parameters to SDP.\nSDPUtils.writeDtlsParameters = function(params, setupType) {\n  var sdp = 'a=setup:' + setupType + '\\r\\n';\n  params.fingerprints.forEach(function(fp) {\n    sdp += 'a=fingerprint:' + fp.algorithm + ' ' + fp.value + '\\r\\n';\n  });\n  return sdp;\n};\n\n// Parses a=crypto lines into\n//   https://rawgit.com/aboba/edgertc/master/msortc-rs4.html#dictionary-rtcsrtpsdesparameters-members\nSDPUtils.parseCryptoLine = function(line) {\n  var parts = line.substr(9).split(' ');\n  return {\n    tag: parseInt(parts[0], 10),\n    cryptoSuite: parts[1],\n    keyParams: parts[2],\n    sessionParams: parts.slice(3),\n  };\n};\n\nSDPUtils.writeCryptoLine = function(parameters) {\n  return 'a=crypto:' + parameters.tag + ' ' +\n    parameters.cryptoSuite + ' ' +\n    (typeof parameters.keyParams === 'object'\n      ? SDPUtils.writeCryptoKeyParams(parameters.keyParams)\n      : parameters.keyParams) +\n    (parameters.sessionParams ? ' ' + parameters.sessionParams.join(' ') : '') +\n    '\\r\\n';\n};\n\n// Parses the crypto key parameters into\n//   https://rawgit.com/aboba/edgertc/master/msortc-rs4.html#rtcsrtpkeyparam*\nSDPUtils.parseCryptoKeyParams = function(keyParams) {\n  if (keyParams.indexOf('inline:') !== 0) {\n    return null;\n  }\n  var parts = keyParams.substr(7).split('|');\n  return {\n    keyMethod: 'inline',\n    keySalt: parts[0],\n    lifeTime: parts[1],\n    mkiValue: parts[2] ? parts[2].split(':')[0] : undefined,\n    mkiLength: parts[2] ? parts[2].split(':')[1] : undefined,\n  };\n};\n\nSDPUtils.writeCryptoKeyParams = function(keyParams) {\n  return keyParams.keyMethod + ':'\n    + keyParams.keySalt +\n    (keyParams.lifeTime ? '|' + keyParams.lifeTime : '') +\n    (keyParams.mkiValue && keyParams.mkiLength\n      ? '|' + keyParams.mkiValue + ':' + keyParams.mkiLength\n      : '');\n};\n\n// Extracts all SDES paramters.\nSDPUtils.getCryptoParameters = function(mediaSection, sessionpart) {\n  var lines = SDPUtils.matchPrefix(mediaSection + sessionpart,\n    'a=crypto:');\n  return lines.map(SDPUtils.parseCryptoLine);\n};\n\n// Parses ICE information from SDP media section or sessionpart.\n// FIXME: for consistency with other functions this should only\n//   get the ice-ufrag and ice-pwd lines as input.\nSDPUtils.getIceParameters = function(mediaSection, sessionpart) {\n  var ufrag = SDPUtils.matchPrefix(mediaSection + sessionpart,\n    'a=ice-ufrag:')[0];\n  var pwd = SDPUtils.matchPrefix(mediaSection + sessionpart,\n    'a=ice-pwd:')[0];\n  if (!(ufrag && pwd)) {\n    return null;\n  }\n  return {\n    usernameFragment: ufrag.substr(12),\n    password: pwd.substr(10),\n  };\n};\n\n// Serializes ICE parameters to SDP.\nSDPUtils.writeIceParameters = function(params) {\n  return 'a=ice-ufrag:' + params.usernameFragment + '\\r\\n' +\n      'a=ice-pwd:' + params.password + '\\r\\n';\n};\n\n// Parses the SDP media section and returns RTCRtpParameters.\nSDPUtils.parseRtpParameters = function(mediaSection) {\n  var description = {\n    codecs: [],\n    headerExtensions: [],\n    fecMechanisms: [],\n    rtcp: []\n  };\n  var lines = SDPUtils.splitLines(mediaSection);\n  var mline = lines[0].split(' ');\n  for (var i = 3; i < mline.length; i++) { // find all codecs from mline[3..]\n    var pt = mline[i];\n    var rtpmapline = SDPUtils.matchPrefix(\n      mediaSection, 'a=rtpmap:' + pt + ' ')[0];\n    if (rtpmapline) {\n      var codec = SDPUtils.parseRtpMap(rtpmapline);\n      var fmtps = SDPUtils.matchPrefix(\n        mediaSection, 'a=fmtp:' + pt + ' ');\n      // Only the first a=fmtp:<pt> is considered.\n      codec.parameters = fmtps.length ? SDPUtils.parseFmtp(fmtps[0]) : {};\n      codec.rtcpFeedback = SDPUtils.matchPrefix(\n        mediaSection, 'a=rtcp-fb:' + pt + ' ')\n        .map(SDPUtils.parseRtcpFb);\n      description.codecs.push(codec);\n      // parse FEC mechanisms from rtpmap lines.\n      switch (codec.name.toUpperCase()) {\n        case 'RED':\n        case 'ULPFEC':\n          description.fecMechanisms.push(codec.name.toUpperCase());\n          break;\n        default: // only RED and ULPFEC are recognized as FEC mechanisms.\n          break;\n      }\n    }\n  }\n  SDPUtils.matchPrefix(mediaSection, 'a=extmap:').forEach(function(line) {\n    description.headerExtensions.push(SDPUtils.parseExtmap(line));\n  });\n  // FIXME: parse rtcp.\n  return description;\n};\n\n// Generates parts of the SDP media section describing the capabilities /\n// parameters.\nSDPUtils.writeRtpDescription = function(kind, caps) {\n  var sdp = '';\n\n  // Build the mline.\n  sdp += 'm=' + kind + ' ';\n  sdp += caps.codecs.length > 0 ? '9' : '0'; // reject if no codecs.\n  sdp += ' UDP/TLS/RTP/SAVPF ';\n  sdp += caps.codecs.map(function(codec) {\n    if (codec.preferredPayloadType !== undefined) {\n      return codec.preferredPayloadType;\n    }\n    return codec.payloadType;\n  }).join(' ') + '\\r\\n';\n\n  sdp += 'c=IN IP4 0.0.0.0\\r\\n';\n  sdp += 'a=rtcp:9 IN IP4 0.0.0.0\\r\\n';\n\n  // Add a=rtpmap lines for each codec. Also fmtp and rtcp-fb.\n  caps.codecs.forEach(function(codec) {\n    sdp += SDPUtils.writeRtpMap(codec);\n    sdp += SDPUtils.writeFmtp(codec);\n    sdp += SDPUtils.writeRtcpFb(codec);\n  });\n  var maxptime = 0;\n  caps.codecs.forEach(function(codec) {\n    if (codec.maxptime > maxptime) {\n      maxptime = codec.maxptime;\n    }\n  });\n  if (maxptime > 0) {\n    sdp += 'a=maxptime:' + maxptime + '\\r\\n';\n  }\n  sdp += 'a=rtcp-mux\\r\\n';\n\n  if (caps.headerExtensions) {\n    caps.headerExtensions.forEach(function(extension) {\n      sdp += SDPUtils.writeExtmap(extension);\n    });\n  }\n  // FIXME: write fecMechanisms.\n  return sdp;\n};\n\n// Parses the SDP media section and returns an array of\n// RTCRtpEncodingParameters.\nSDPUtils.parseRtpEncodingParameters = function(mediaSection) {\n  var encodingParameters = [];\n  var description = SDPUtils.parseRtpParameters(mediaSection);\n  var hasRed = description.fecMechanisms.indexOf('RED') !== -1;\n  var hasUlpfec = description.fecMechanisms.indexOf('ULPFEC') !== -1;\n\n  // filter a=ssrc:... cname:, ignore PlanB-msid\n  var ssrcs = SDPUtils.matchPrefix(mediaSection, 'a=ssrc:')\n    .map(function(line) {\n      return SDPUtils.parseSsrcMedia(line);\n    })\n    .filter(function(parts) {\n      return parts.attribute === 'cname';\n    });\n  var primarySsrc = ssrcs.length > 0 && ssrcs[0].ssrc;\n  var secondarySsrc;\n\n  var flows = SDPUtils.matchPrefix(mediaSection, 'a=ssrc-group:FID')\n    .map(function(line) {\n      var parts = line.substr(17).split(' ');\n      return parts.map(function(part) {\n        return parseInt(part, 10);\n      });\n    });\n  if (flows.length > 0 && flows[0].length > 1 && flows[0][0] === primarySsrc) {\n    secondarySsrc = flows[0][1];\n  }\n\n  description.codecs.forEach(function(codec) {\n    if (codec.name.toUpperCase() === 'RTX' && codec.parameters.apt) {\n      var encParam = {\n        ssrc: primarySsrc,\n        codecPayloadType: parseInt(codec.parameters.apt, 10)\n      };\n      if (primarySsrc && secondarySsrc) {\n        encParam.rtx = {ssrc: secondarySsrc};\n      }\n      encodingParameters.push(encParam);\n      if (hasRed) {\n        encParam = JSON.parse(JSON.stringify(encParam));\n        encParam.fec = {\n          ssrc: primarySsrc,\n          mechanism: hasUlpfec ? 'red+ulpfec' : 'red'\n        };\n        encodingParameters.push(encParam);\n      }\n    }\n  });\n  if (encodingParameters.length === 0 && primarySsrc) {\n    encodingParameters.push({\n      ssrc: primarySsrc\n    });\n  }\n\n  // we support both b=AS and b=TIAS but interpret AS as TIAS.\n  var bandwidth = SDPUtils.matchPrefix(mediaSection, 'b=');\n  if (bandwidth.length) {\n    if (bandwidth[0].indexOf('b=TIAS:') === 0) {\n      bandwidth = parseInt(bandwidth[0].substr(7), 10);\n    } else if (bandwidth[0].indexOf('b=AS:') === 0) {\n      // use formula from JSEP to convert b=AS to TIAS value.\n      bandwidth = parseInt(bandwidth[0].substr(5), 10) * 1000 * 0.95\n          - (50 * 40 * 8);\n    } else {\n      bandwidth = undefined;\n    }\n    encodingParameters.forEach(function(params) {\n      params.maxBitrate = bandwidth;\n    });\n  }\n  return encodingParameters;\n};\n\n// parses http://draft.ortc.org/#rtcrtcpparameters*\nSDPUtils.parseRtcpParameters = function(mediaSection) {\n  var rtcpParameters = {};\n\n  // Gets the first SSRC. Note tha with RTX there might be multiple\n  // SSRCs.\n  var remoteSsrc = SDPUtils.matchPrefix(mediaSection, 'a=ssrc:')\n    .map(function(line) {\n      return SDPUtils.parseSsrcMedia(line);\n    })\n    .filter(function(obj) {\n      return obj.attribute === 'cname';\n    })[0];\n  if (remoteSsrc) {\n    rtcpParameters.cname = remoteSsrc.value;\n    rtcpParameters.ssrc = remoteSsrc.ssrc;\n  }\n\n  // Edge uses the compound attribute instead of reducedSize\n  // compound is !reducedSize\n  var rsize = SDPUtils.matchPrefix(mediaSection, 'a=rtcp-rsize');\n  rtcpParameters.reducedSize = rsize.length > 0;\n  rtcpParameters.compound = rsize.length === 0;\n\n  // parses the rtcp-mux attrіbute.\n  // Note that Edge does not support unmuxed RTCP.\n  var mux = SDPUtils.matchPrefix(mediaSection, 'a=rtcp-mux');\n  rtcpParameters.mux = mux.length > 0;\n\n  return rtcpParameters;\n};\n\n// parses either a=msid: or a=ssrc:... msid lines and returns\n// the id of the MediaStream and MediaStreamTrack.\nSDPUtils.parseMsid = function(mediaSection) {\n  var parts;\n  var spec = SDPUtils.matchPrefix(mediaSection, 'a=msid:');\n  if (spec.length === 1) {\n    parts = spec[0].substr(7).split(' ');\n    return {stream: parts[0], track: parts[1]};\n  }\n  var planB = SDPUtils.matchPrefix(mediaSection, 'a=ssrc:')\n    .map(function(line) {\n      return SDPUtils.parseSsrcMedia(line);\n    })\n    .filter(function(msidParts) {\n      return msidParts.attribute === 'msid';\n    });\n  if (planB.length > 0) {\n    parts = planB[0].value.split(' ');\n    return {stream: parts[0], track: parts[1]};\n  }\n};\n\n// SCTP\n// parses draft-ietf-mmusic-sctp-sdp-26 first and falls back\n// to draft-ietf-mmusic-sctp-sdp-05\nSDPUtils.parseSctpDescription = function(mediaSection) {\n  var mline = SDPUtils.parseMLine(mediaSection);\n  var maxSizeLine = SDPUtils.matchPrefix(mediaSection, 'a=max-message-size:');\n  var maxMessageSize;\n  if (maxSizeLine.length > 0) {\n    maxMessageSize = parseInt(maxSizeLine[0].substr(19), 10);\n  }\n  if (isNaN(maxMessageSize)) {\n    maxMessageSize = 65536;\n  }\n  var sctpPort = SDPUtils.matchPrefix(mediaSection, 'a=sctp-port:');\n  if (sctpPort.length > 0) {\n    return {\n      port: parseInt(sctpPort[0].substr(12), 10),\n      protocol: mline.fmt,\n      maxMessageSize: maxMessageSize\n    };\n  }\n  var sctpMapLines = SDPUtils.matchPrefix(mediaSection, 'a=sctpmap:');\n  if (sctpMapLines.length > 0) {\n    var parts = SDPUtils.matchPrefix(mediaSection, 'a=sctpmap:')[0]\n      .substr(10)\n      .split(' ');\n    return {\n      port: parseInt(parts[0], 10),\n      protocol: parts[1],\n      maxMessageSize: maxMessageSize\n    };\n  }\n};\n\n// SCTP\n// outputs the draft-ietf-mmusic-sctp-sdp-26 version that all browsers\n// support by now receiving in this format, unless we originally parsed\n// as the draft-ietf-mmusic-sctp-sdp-05 format (indicated by the m-line\n// protocol of DTLS/SCTP -- without UDP/ or TCP/)\nSDPUtils.writeSctpDescription = function(media, sctp) {\n  var output = [];\n  if (media.protocol !== 'DTLS/SCTP') {\n    output = [\n      'm=' + media.kind + ' 9 ' + media.protocol + ' ' + sctp.protocol + '\\r\\n',\n      'c=IN IP4 0.0.0.0\\r\\n',\n      'a=sctp-port:' + sctp.port + '\\r\\n'\n    ];\n  } else {\n    output = [\n      'm=' + media.kind + ' 9 ' + media.protocol + ' ' + sctp.port + '\\r\\n',\n      'c=IN IP4 0.0.0.0\\r\\n',\n      'a=sctpmap:' + sctp.port + ' ' + sctp.protocol + ' 65535\\r\\n'\n    ];\n  }\n  if (sctp.maxMessageSize !== undefined) {\n    output.push('a=max-message-size:' + sctp.maxMessageSize + '\\r\\n');\n  }\n  return output.join('');\n};\n\n// Generate a session ID for SDP.\n// https://tools.ietf.org/html/draft-ietf-rtcweb-jsep-20#section-5.2.1\n// recommends using a cryptographically random +ve 64-bit value\n// but right now this should be acceptable and within the right range\nSDPUtils.generateSessionId = function() {\n  return Math.random().toString().substr(2, 21);\n};\n\n// Write boilder plate for start of SDP\n// sessId argument is optional - if not supplied it will\n// be generated randomly\n// sessVersion is optional and defaults to 2\n// sessUser is optional and defaults to 'thisisadapterortc'\nSDPUtils.writeSessionBoilerplate = function(sessId, sessVer, sessUser) {\n  var sessionId;\n  var version = sessVer !== undefined ? sessVer : 2;\n  if (sessId) {\n    sessionId = sessId;\n  } else {\n    sessionId = SDPUtils.generateSessionId();\n  }\n  var user = sessUser || 'thisisadapterortc';\n  // FIXME: sess-id should be an NTP timestamp.\n  return 'v=0\\r\\n' +\n      'o=' + user + ' ' + sessionId + ' ' + version +\n        ' IN IP4 127.0.0.1\\r\\n' +\n      's=-\\r\\n' +\n      't=0 0\\r\\n';\n};\n\nSDPUtils.writeMediaSection = function(transceiver, caps, type, stream) {\n  var sdp = SDPUtils.writeRtpDescription(transceiver.kind, caps);\n\n  // Map ICE parameters (ufrag, pwd) to SDP.\n  sdp += SDPUtils.writeIceParameters(\n    transceiver.iceGatherer.getLocalParameters());\n\n  // Map DTLS parameters to SDP.\n  sdp += SDPUtils.writeDtlsParameters(\n    transceiver.dtlsTransport.getLocalParameters(),\n    type === 'offer' ? 'actpass' : 'active');\n\n  sdp += 'a=mid:' + transceiver.mid + '\\r\\n';\n\n  if (transceiver.direction) {\n    sdp += 'a=' + transceiver.direction + '\\r\\n';\n  } else if (transceiver.rtpSender && transceiver.rtpReceiver) {\n    sdp += 'a=sendrecv\\r\\n';\n  } else if (transceiver.rtpSender) {\n    sdp += 'a=sendonly\\r\\n';\n  } else if (transceiver.rtpReceiver) {\n    sdp += 'a=recvonly\\r\\n';\n  } else {\n    sdp += 'a=inactive\\r\\n';\n  }\n\n  if (transceiver.rtpSender) {\n    // spec.\n    var msid = 'msid:' + stream.id + ' ' +\n        transceiver.rtpSender.track.id + '\\r\\n';\n    sdp += 'a=' + msid;\n\n    // for Chrome.\n    sdp += 'a=ssrc:' + transceiver.sendEncodingParameters[0].ssrc +\n        ' ' + msid;\n    if (transceiver.sendEncodingParameters[0].rtx) {\n      sdp += 'a=ssrc:' + transceiver.sendEncodingParameters[0].rtx.ssrc +\n          ' ' + msid;\n      sdp += 'a=ssrc-group:FID ' +\n          transceiver.sendEncodingParameters[0].ssrc + ' ' +\n          transceiver.sendEncodingParameters[0].rtx.ssrc +\n          '\\r\\n';\n    }\n  }\n  // FIXME: this should be written by writeRtpDescription.\n  sdp += 'a=ssrc:' + transceiver.sendEncodingParameters[0].ssrc +\n      ' cname:' + SDPUtils.localCName + '\\r\\n';\n  if (transceiver.rtpSender && transceiver.sendEncodingParameters[0].rtx) {\n    sdp += 'a=ssrc:' + transceiver.sendEncodingParameters[0].rtx.ssrc +\n        ' cname:' + SDPUtils.localCName + '\\r\\n';\n  }\n  return sdp;\n};\n\n// Gets the direction from the mediaSection or the sessionpart.\nSDPUtils.getDirection = function(mediaSection, sessionpart) {\n  // Look for sendrecv, sendonly, recvonly, inactive, default to sendrecv.\n  var lines = SDPUtils.splitLines(mediaSection);\n  for (var i = 0; i < lines.length; i++) {\n    switch (lines[i]) {\n      case 'a=sendrecv':\n      case 'a=sendonly':\n      case 'a=recvonly':\n      case 'a=inactive':\n        return lines[i].substr(2);\n      default:\n        // FIXME: What should happen here?\n    }\n  }\n  if (sessionpart) {\n    return SDPUtils.getDirection(sessionpart);\n  }\n  return 'sendrecv';\n};\n\nSDPUtils.getKind = function(mediaSection) {\n  var lines = SDPUtils.splitLines(mediaSection);\n  var mline = lines[0].split(' ');\n  return mline[0].substr(2);\n};\n\nSDPUtils.isRejected = function(mediaSection) {\n  return mediaSection.split(' ', 2)[1] === '0';\n};\n\nSDPUtils.parseMLine = function(mediaSection) {\n  var lines = SDPUtils.splitLines(mediaSection);\n  var parts = lines[0].substr(2).split(' ');\n  return {\n    kind: parts[0],\n    port: parseInt(parts[1], 10),\n    protocol: parts[2],\n    fmt: parts.slice(3).join(' ')\n  };\n};\n\nSDPUtils.parseOLine = function(mediaSection) {\n  var line = SDPUtils.matchPrefix(mediaSection, 'o=')[0];\n  var parts = line.substr(2).split(' ');\n  return {\n    username: parts[0],\n    sessionId: parts[1],\n    sessionVersion: parseInt(parts[2], 10),\n    netType: parts[3],\n    addressType: parts[4],\n    address: parts[5]\n  };\n};\n\n// a very naive interpretation of a valid SDP.\nSDPUtils.isValidSDP = function(blob) {\n  if (typeof blob !== 'string' || blob.length === 0) {\n    return false;\n  }\n  var lines = SDPUtils.splitLines(blob);\n  for (var i = 0; i < lines.length; i++) {\n    if (lines[i].length < 2 || lines[i].charAt(1) !== '=') {\n      return false;\n    }\n    // TODO: check the modifier a bit more.\n  }\n  return true;\n};\n\n// Expose public methods.\nif (typeof module === 'object') {\n  module.exports = SDPUtils;\n}\n","const WebSocket = require('./WebSocket')\nconst JanusPlugin = require('./JanusPlugin')\nconst uuid = require('uuid/v4')\n\nconst ignoredErrorCodes = [\n  458, // JANUS_ERROR_SESSION_NOT_FOUND\n  459 // JANUS_ERROR_HANDLE_NOT_FOUND\n]\n\nclass Janus {\n  constructor (config, logger) {\n    this.ws = undefined\n    this.isConnected = false\n    this.sessionId = undefined\n    this.logger = logger\n\n    this.transactions = {}\n    this.pluginHandles = {}\n\n    this.config = config\n    this.protocol = 'janus-protocol'\n    this.sendCreate = true\n  }\n\n  connect () {\n    if (this.isConnected) {\n      return Promise.resolve(this)\n    }\n\n    return new Promise((resolve, reject) => {\n      this.ws = new WebSocket(this.config.url, this.protocol, this.config.options)\n\n      this.ws.addEventListener('error', (err) => {\n        this.logger.error('Error connecting to the Janus WebSockets server...', err)\n        this.isConnected = false\n        reject(err)\n      })\n\n      this.ws.addEventListener('close', () => { this.cleanup() })\n\n      this.ws.addEventListener('open', () => {\n        if (!this.sendCreate) {\n          this.isConnected = true\n          this.keepAlive(true)\n          return resolve(this)\n        }\n\n        const transaction = uuid()\n        const request = { janus: 'create', transaction }\n\n        this.transactions[transaction] = {\n          resolve: (json) => {\n            if (json.janus !== 'success') {\n              this.logger.error('Cannot connect to Janus', json)\n              reject(json)\n              return\n            }\n\n            this.sessionId = json.data.id\n            this.isConnected = true\n            this.keepAlive(true)\n\n            this.logger.debug('Janus connected, sessionId: ', this.sessionId)\n\n            resolve(this)\n          },\n          reject,\n          replyType: 'success'\n        }\n\n        this.ws.send(JSON.stringify(request))\n      })\n\n      this.ws.addEventListener('message', (event) => { this.onMessage(event) })\n      this.ws.addEventListener('close', () => { this.onClose() })\n    })\n  }\n\n  /**\n   *\n   * @param {JanusPlugin} plugin\n   * @return {Promise}\n   * */\n  addPlugin (plugin) {\n    if (!(plugin instanceof JanusPlugin)) {\n      return Promise.reject(new Error('plugin is not a JanusPlugin'))\n    }\n\n    const request = plugin.getAttachPayload()\n\n    return this.transaction('attach', request, 'success').then((json) => {\n      if (json.janus !== 'success') {\n        this.logger.error('Cannot add plugin', json)\n        plugin.error(json)\n        throw new Error(json)\n      }\n\n      this.pluginHandles[json.data.id] = plugin\n\n      return plugin.success(this, json.data.id)\n    })\n  }\n\n  transaction (type, payload, replyType, timeoutMs) {\n    if (!replyType) {\n      replyType = 'ack'\n    }\n    const transactionId = uuid()\n\n    return new Promise((resolve, reject) => {\n      if (timeoutMs) {\n        setTimeout(() => {\n          reject(new Error('Transaction timed out after ' + timeoutMs + ' ms'))\n        }, timeoutMs)\n      }\n\n      if (!this.isConnected) {\n        reject(new Error('Janus is not connected'))\n        return\n      }\n\n      const request = Object.assign({}, payload, {\n        janus: type,\n        session_id: (payload && parseInt(payload.session_id, 10)) || this.sessionId,\n        transaction: transactionId\n      })\n\n      this.transactions[request.transaction] = { resolve, reject, replyType, request }\n      this.ws.send(JSON.stringify(request))\n    })\n  }\n\n  send (type, payload) {\n    return new Promise((resolve, reject) => {\n      if (!this.isConnected) {\n        reject(new Error('Janus is not connected'))\n        return\n      }\n\n      const request = Object.assign({}, payload, {\n        janus: type,\n        session_id: this.sessionId,\n        transaction: uuid()\n      })\n\n      this.logger.debug('Janus sending', request)\n      this.ws.send(JSON.stringify(request), {}, (err) => {\n        if (err) {\n          reject(err)\n        } else {\n          resolve()\n        }\n      })\n    })\n  }\n\n  destroy () {\n    if (!this.isConnected) {\n      return Promise.resolve()\n    }\n\n    return this.transaction('destroy', {}, 'success', 5000).then(() => {\n      this.cleanup()\n    }).catch(() => {\n      this.cleanup()\n    })\n  }\n\n  destroyPlugin (plugin) {\n    return new Promise((resolve, reject) => {\n      if (!(plugin instanceof JanusPlugin)) {\n        reject(new Error('plugin is not a JanusPlugin'))\n        return\n      }\n\n      if (!this.pluginHandles[plugin.janusHandleId]) {\n        reject(new Error('unknown plugin'))\n        return\n      }\n\n      this.transaction('detach', { plugin: plugin.pluginName, handle_id: plugin.janusHandleId }, 'success', 5000).then(() => {\n        delete this.pluginHandles[plugin.pluginName]\n        plugin.detach()\n\n        resolve()\n      }).catch((err) => {\n        delete this.pluginHandles[plugin.pluginName]\n        plugin.detach()\n\n        reject(err)\n      })\n    })\n  }\n\n  onMessage (messageEvent) {\n    let json\n    try {\n      json = JSON.parse(messageEvent.data)\n    } catch (err) {\n      this.logger.error('cannot parse message', messageEvent.data)\n      return\n    }\n\n    // this.logger.debug('JANUS GOT', json)\n    if (json.janus === 'timeout' && json.session_id !== this.sessionId) {\n      this.logger.debug('GOT timeout from another websocket') // seems like a bug in janus timeout handler :)\n      return\n    }\n\n    if (json.janus === 'keepalive') { // Do nothing\n      return\n    }\n\n    if (json.janus === 'ack') { // Just an ack, we can probably ignore\n      const transaction = this.getTransaction(json)\n      if (transaction && transaction.resolve) {\n        transaction.resolve(json)\n      }\n      return\n    }\n\n    if (json.janus === 'success') { // Success!\n      const transaction = this.getTransaction(json)\n      if (!transaction) {\n        return\n      }\n\n      const pluginData = json.plugindata\n      if (pluginData === undefined || pluginData === null) {\n        transaction.resolve(json)\n        return\n      }\n\n      const sender = json.sender\n      if (!sender) {\n        transaction.resolve(json)\n        this.logger.error('Missing sender for plugindata', json)\n        return\n      }\n\n      const pluginHandle = this.pluginHandles[sender]\n      if (!pluginHandle) {\n        this.logger.error('This handle is not attached to this session', json)\n        return\n      }\n\n      transaction.resolve({ data: pluginData.data, json })\n      return\n    }\n\n    if (json.janus === 'webrtcup') { // The PeerConnection with the gateway is up! Notify this\n      const sender = json.sender\n      if (!sender) {\n        this.logger.warn('Missing sender...')\n        return\n      }\n      const pluginHandle = this.pluginHandles[sender]\n      if (!pluginHandle) {\n        this.logger.error('This handle is not attached to this session', sender)\n        return\n      }\n      pluginHandle.webrtcState(true)\n      return\n    }\n\n    if (json.janus === 'hangup') { // A plugin asked the core to hangup a PeerConnection on one of our handles\n      const sender = json.sender\n      if (!sender) {\n        this.logger.warn('Missing sender...')\n        return\n      }\n      const pluginHandle = this.pluginHandles[sender]\n      if (!pluginHandle) {\n        this.logger.error('This handle is not attached to this session', sender)\n        return\n      }\n      pluginHandle.webrtcState(false, json.reason)\n      pluginHandle.hangup()\n      return\n    }\n\n    if (json.janus === 'detached') { // A plugin asked the core to detach one of our handles\n      const sender = json.sender\n      if (!sender) {\n        this.logger.warn('Missing sender...')\n        return\n      }\n      return\n    }\n\n    if (json.janus === 'media') { // Media started/stopped flowing\n      const sender = json.sender\n      if (!sender) {\n        this.logger.warn('Missing sender...')\n        return\n      }\n      const pluginHandle = this.pluginHandles[sender]\n      if (!pluginHandle) {\n        this.logger.error('This handle is not attached to this session', sender)\n        return\n      }\n      pluginHandle.mediaState(json.type, json.receiving)\n      return\n    }\n\n    if (json.janus === 'slowlink') { // Trouble uplink or downlink\n      this.logger.debug('Got a slowlink event on session ' + this.sessionId)\n      this.logger.debug(json)\n      const sender = json.sender\n      if (!sender) {\n        this.logger.warn('Missing sender...')\n        return\n      }\n      const pluginHandle = this.pluginHandles[sender]\n      if (!pluginHandle) {\n        this.logger.error('This handle is not attached to this session', sender)\n        return\n      }\n      pluginHandle.slowLink(json.uplink, json.nacks)\n      return\n    }\n\n    if (json.janus === 'error') { // Oops, something wrong happened\n      if (json.error && json.error.code && !ignoredErrorCodes.includes(json.error.code)) {\n        this.logger.error('Janus error response' + json)\n      }\n\n      const transaction = this.getTransaction(json, true)\n      if (transaction && transaction.reject) {\n        if (transaction.request) {\n          this.logger.debug('Janus Error: rejecting transaction', transaction.request, json)\n        }\n        transaction.reject(json)\n      }\n      return\n    }\n\n    if (json.janus === 'event') {\n      const sender = json.sender\n      if (!sender) {\n        this.logger.warn('Missing sender...')\n        return\n      }\n      const pluginData = json.plugindata\n      if (pluginData === undefined || pluginData === null) {\n        this.logger.error('Missing plugindata...')\n        return\n      }\n\n      const pluginHandle = this.pluginHandles[sender]\n      if (!pluginHandle) {\n        this.logger.error('This handle is not attached to this session', sender)\n        return\n      }\n\n      const data = pluginData.data\n      const transaction = this.getTransaction(json)\n      if (transaction) {\n        if (data.error_code) {\n          transaction.reject({ data, json })\n        } else {\n          transaction.resolve({ data, json })\n        }\n        return\n      }\n\n      pluginHandle.onmessage(data, json)\n      return\n    }\n\n    this.logger.warn('Unknown message/event ' + json.janus + ' on session ' + this.sessionId)\n    this.logger.debug(json)\n  }\n\n  onClose () {\n    if (!this.isConnected) {\n      return\n    }\n\n    this.isConnected = false\n    this.logger.error('Lost connection to the gateway (is it down?)')\n  }\n\n  keepAlive (isScheduled) {\n    if (!this.ws || !this.isConnected || !this.sessionId) {\n      return\n    }\n\n    if (isScheduled) {\n      setTimeout(() => { this.keepAlive() }, this.config.keepAliveIntervalMs)\n    } else {\n      // logger.debug('Sending Janus keepalive')\n      this.transaction('keepalive').then(() => {\n        setTimeout(() => { this.keepAlive() }, this.config.keepAliveIntervalMs)\n      }).catch((err) => {\n        this.logger.warn('Janus keepalive error', err)\n      })\n    }\n  }\n\n  getTransaction (json, ignoreReplyType = false) {\n    const type = json.janus\n    const transactionId = json.transaction\n    if (\n      transactionId &&\n      Object.prototype.hasOwnProperty.call(this.transactions, transactionId) &&\n      (ignoreReplyType || this.transactions[transactionId].replyType === type)\n    ) {\n      const ret = this.transactions[transactionId]\n      delete this.transactions[transactionId]\n      return ret\n    }\n  }\n\n  cleanup () {\n    this._cleanupPlugins()\n    this._cleanupWebSocket()\n    this._cleanupTransactions()\n  }\n\n  _cleanupWebSocket () {\n    if (this.ws) {\n      this.ws.removeAllListeners()\n      if (this.ws.readyState === WebSocket.OPEN) {\n        this.ws.close()\n      }\n    }\n    this.ws = undefined\n    this.isConnected = false\n  }\n\n  _cleanupPlugins () {\n    Object.keys(this.pluginHandles).forEach((pluginId) => {\n      const plugin = this.pluginHandles[pluginId]\n      delete this.pluginHandles[pluginId]\n      plugin.detach()\n    })\n  }\n\n  _cleanupTransactions () {\n    Object.keys(this.transactions).forEach((transactionId) => {\n      const transaction = this.transactions[transactionId]\n      if (transaction.reject) {\n        transaction.reject()\n      }\n    })\n    this.transactions = {}\n  }\n}\n\nmodule.exports = Janus\n","const JanusPlugin = require('../JanusPlugin')\nconst SdpHelper = require('../SdpHelper')\nconst SdpUtils = require('sdp')\n\nclass VideoRoomPublisherJanusPlugin extends JanusPlugin {\n  constructor (config, display, logger, filterDirectCandidates = false) {\n    if (!config) {\n      throw new Error('unknown config')\n    }\n\n    super(logger)\n    this.display = display\n    this.pluginName = 'janus.plugin.videoroom'\n\n    this.janusRoomId = undefined\n    this.janusRoomMemberId = undefined\n    this.janusRoomPrivateMemberId = undefined\n\n    this.filterDirectCandidates = !!filterDirectCandidates\n\n    this.config = config\n    this.sdpHelper = new SdpHelper(this.logger)\n\n    this.offerSdp = undefined\n    this.answerSdp = undefined\n\n    this.rtpForwardVideoStreamId = undefined\n    this.rtpForwardAudioStreamId = undefined\n    this.rtpForwardDataStreamId = undefined\n  }\n\n  /**\n   * Usage: ffmpeg -analyzeduration 300M -probesize 300M -protocol_whitelist file,udp,rtp -i sdp.file  -c:v h264 -c:a aac -ar 16k -ac 1 -g 50 -max_muxing_queue_size 9999 -preset ultrafast -tune zerolatency  -f flv rtmp://127.0.0.1:1935/mytv/stream\n   */\n  startRTPForward (host, videoPortNumber, audioPortNumber) {\n    const body = {\n      request: 'rtp_forward',\n      room: this.janusRoomId,\n      publisher_id: this.janusRoomMemberId,\n      host: host\n    }\n\n    if (videoPortNumber) {\n      body.video_port = videoPortNumber\n    }\n    if (audioPortNumber) {\n      body.audio_port = audioPortNumber\n    }\n\n    return this.transaction('message', { body }, 'success').then(({ data, json }) => {\n      if (data && data.rtp_stream && data.rtp_stream.video_stream_id) {\n        this.rtpForwardVideoStreamId = data.rtp_stream.video_stream_id\n      }\n      if (data && data.rtp_stream && data.rtp_stream.audio_stream_id) {\n        this.rtpForwardAudioStreamId = data.rtp_stream.audio_stream_id\n      }\n      if (data && data.rtp_stream && data.rtp_stream.data_stream_id) {\n        this.rtpForwardDataStreamId = data.rtp_stream.data_stream_id\n      }\n\n      let rtpSdp = 'v=0\\n' +\n        `o=- 0 0 IN IP4 ${host}\\n` +\n        `s=janus-api:${this.janusRoomId}.${this.janusRoomMemberId}\\n` +\n        `c=IN IP4 ${host}\\n` +\n        't=0 0\\n' +\n        'a=tool:janus-api\\n'\n\n      SdpUtils.splitSections(this.answerSdp).forEach((section, index) => {\n        if (index === 0) {\n          return // session part\n        }\n\n        const mid = SdpUtils.getMid(section)\n        const rtp = SdpUtils.parseRtpParameters(section)\n\n        const codec = rtp.codecs[0]\n        if (!codec) {\n          return\n        }\n\n        if (mid === 'video' && videoPortNumber) {\n          rtpSdp +=\n            `m=video ${videoPortNumber} RTP/AVP ${codec.payloadType}\\n` +\n            `a=rtpmap:${codec.payloadType} ${codec.name}/${codec.clockRate}\\n` +\n            'a=fmtp:11 packetization-mode=1\\n' +\n            'a=rtcp-mux\\n'\n        }\n        if (mid === 'audio' && audioPortNumber) {\n          rtpSdp +=\n            `m=audio ${audioPortNumber} RTP/AVP ${codec.payloadType}\\n` +\n            `a=rtpmap:${codec.payloadType} ${codec.name}/${codec.clockRate}\\n` +\n            'a=fmtp:11 packetization-mode=1\\n' +\n            'a=rtcp-mux\\n'\n        }\n      })\n\n      return rtpSdp\n    }).catch((err) => {\n      this.logger.error('VideoRoomPublisherJanusPlugin, cannot RTP forward', err)\n      throw err\n    })\n  }\n\n  stopRTPForward () {\n    const ret = []\n    if (this.rtpForwardVideoStreamId) {\n      ret.push(this.stopRTPForwardStream(this.rtpForwardVideoStreamId))\n    }\n    if (this.rtpForwardAudioStreamId) {\n      ret.push(this.stopRTPForwardStream(this.rtpForwardAudioStreamId))\n    }\n    if (this.rtpForwardDataStreamId) {\n      ret.push(this.stopRTPForwardStream(this.rtpForwardDataStreamId))\n    }\n\n    return Promise.all(ret)\n  }\n\n  stopRTPForwardStream (streamId) {\n    const body = {\n      request: 'stop_rtp_forward',\n      room: this.janusRoomId,\n      publisher_id: this.janusRoomMemberId,\n      stream_id: streamId\n    }\n\n    return this.transaction('message', { body }, 'success').catch((err) => {\n      this.logger.error('VideoRoomPublisherJanusPlugin, cannot stop RTP forward', err)\n      throw err\n    })\n  }\n\n  setRoomBitrate (bitrate) {\n    const body = {\n      request: 'edit',\n      room: this.janusRoomId,\n      new_bitrate: bitrate\n    }\n\n    return this.transaction('message', { body }, 'success').catch((err) => {\n      this.logger.error('VideoRoomPublisherJanusPlugin, cannot set room bitrate', err)\n      throw err\n    })\n  }\n\n  connect () {\n    return this.transaction('message', { body: { request: 'list' } }, 'success').then((param) => {\n      const { data } = param || {}\n      if (!data || !Array.isArray(data.list)) {\n        this.logger.error('VideoRoomPublisherJanusPlugin, could not find roomList', data)\n        throw new Error('VideoRoomPublisherJanusPlugin, could not find roomList')\n      }\n\n      const foundRoom = data.list.find((room) => room.description === '' + this.config.id)\n      if (foundRoom) {\n        this.janusRoomId = foundRoom.room\n        return this.join()\n      } else {\n        return this.createRoom()\n      }\n    }).catch((err) => {\n      this.logger.error('VideoRoomPublisherJanusPlugin, cannot list rooms', err)\n      throw err\n    })\n  }\n\n  join () {\n    const body = { request: 'join', room: this.janusRoomId, ptype: 'publisher', display: this.display }\n\n    return new Promise((resolve, reject) => {\n      this.transaction('message', { body }, 'event').then((param) => {\n        const { data } = param || {}\n        if (!data || !data.id || !data.private_id || !data.publishers) {\n          this.logger.error('VideoRoomPublisherJanusPlugin, could not join room', data)\n          throw new Error('VideoRoomPublisherJanusPlugin, could not join room')\n        }\n        this.janusRoomMemberId = data.id\n        this.janusRoomPrivateMemberId = data.private_id\n\n        resolve(data.publishers)\n      }).catch((err) => {\n        if (err && err.error_code === 426) { // JANUS_VIDEOROOM_ERROR_NO_SUCH_ROOM = 426\n          this.createRoom().then(resolve).catch(reject)\n        } else {\n          this.logger.error('VideoRoomPublisherJanusPlugin, unknown error connecting to room', err)\n          reject(err)\n        }\n      })\n    })\n  }\n\n  createRoom () {\n    const body = {\n      request: 'create',\n      description: '' + this.config.id,\n      record: this.config.record,\n      videocodec: this.config.codec,\n      rec_dir: this.config.recordDirectory,\n      publishers: this.config.publishers,\n      videoorient_ext: this.config.videoOrientExt\n    }\n\n    if (this.config.bitrate) {\n      body.bitrate = this.config.bitrate\n    }\n    if (this.config.firSeconds) {\n      body.fir_freq = this.config.firSeconds\n    }\n\n    return this.transaction('message', { body }, 'success').then((param) => {\n      const { data } = param || {}\n      if (!data || !data.room) {\n        this.logger.error('VideoRoomPublisherJanusPlugin, could not create room', data)\n        throw new Error('VideoRoomPublisherJanusPlugin, could not create room')\n      }\n\n      this.janusRoomId = data.room\n\n      return this.join()\n    }).catch((err) => {\n      this.logger.error('VideoRoomPublisherJanusPlugin, cannot create room', err)\n      throw err\n    })\n  }\n\n  configure (offer, relayAudio = true, relayVideo = true) {\n    if (!this.janusRoomMemberId) {\n      this.logger.error('VideoRoomPublisherJanusPlugin, cannot configure without janusRoomMemberId')\n      return\n    }\n\n    const body = { request: 'configure', audio: relayAudio, video: relayVideo }\n\n    const jsep = offer\n    if (this.filterDirectCandidates && jsep.sdp) {\n      jsep.sdp = this.sdpHelper.filterDirectCandidates(jsep.sdp)\n    }\n\n    this.offerSdp = jsep.sdp\n\n    return this.transaction('message', { body, jsep }, 'event').then((param) => {\n      const { json } = param || {}\n      if (!json.jsep) {\n        throw new Error('cannot configure')\n      }\n\n      const jsep = json.jsep\n      if (this.filterDirectCandidates && jsep.sdp) {\n        jsep.sdp = this.sdpHelper.filterDirectCandidates(jsep.sdp)\n      }\n\n      this.answerSdp = jsep.sdp\n\n      return jsep\n    })\n  }\n\n  candidate (candidate) {\n    if (this.filterDirectCandidates && candidate.candidate && this.sdpHelper.isDirectCandidate(candidate.candidate)) {\n      return\n    }\n\n    return this.transaction('trickle', { candidate })\n  }\n\n  onmessage (data, json) {\n    // TODO data.videoroom === 'destroyed' handling\n    // TODO unpublished === 'ok' handling : we are unpublished\n\n    const { videoroom, room, unpublished, leaving, publishers } = data\n\n    if (!data || !videoroom || videoroom !== 'event') {\n      this.logger.error('VideoRoomPublisherJanusPlugin got unknown message', json)\n      return\n    }\n    if (room !== this.janusRoomId) {\n      this.logger.error('VideoRoomPublisherJanusPlugin got unknown roomId', this.janusRoomId, json)\n      return\n    }\n\n    if (unpublished) {\n      this.emit('remoteMemberUnpublished', unpublished)\n    } else if (leaving) {\n      this.emit('remoteMemberLeaving', leaving)\n    } else if (Array.isArray(publishers)) {\n      this.emit('publishersUpdated', publishers)\n    } else {\n      this.logger.error('VideoRoomPublisherJanusPlugin got unknown event', json)\n    }\n  }\n}\n\nmodule.exports = VideoRoomPublisherJanusPlugin\n","/**\n *  This module is for mocking ws library in browsers\n */\n\nlet WebSocket\n\ntry {\n  WebSocket = require('ws')\n} catch (e) {\n  // this is browser\n  window.WebSocket.prototype.removeAllListeners = () => { }\n}\n\nmodule.exports = WebSocket || window.WebSocket\n","const Janus = require('./Janus')\n\nclass JanusAdmin extends Janus {\n  /**\n   *\n   * @param config\n   * @param logger\n   */\n  constructor (config, logger) {\n    super(config, logger)\n    this.config = config\n    this.protocol = 'janus-admin-protocol'\n    this.sendCreate = false\n  }\n\n  transaction (type, payload, replyType) {\n    const msg = Object.assign({}, payload, {\n      admin_secret: this.config.secret\n    })\n    return super.transaction(type, msg, replyType || 'success')\n  }\n\n  listSessions () {\n    return this.transaction('list_sessions').then(r => r.sessions)\n  }\n\n  listHandles (sessionId) {\n    return this.transaction('list_handles', {\n      session_id: sessionId\n    }).then(r => r.handles)\n  }\n\n  handleInfo (sessionId, handleId) {\n    return this.transaction('handle_info', {\n      session_id: sessionId,\n      handle_id: handleId\n    }).then(r => r.info)\n  }\n}\n\nmodule.exports = JanusAdmin\n","const JanusPlugin = require('../JanusPlugin')\nconst SdpHelper = require('../SdpHelper')\n\nclass EchoJanusPlugin extends JanusPlugin {\n  constructor (logger, filterDirectCandidates = false) {\n    super(logger)\n    this.filterDirectCandidates = !!filterDirectCandidates\n    this.janusEchoBody = { audio: true, video: true }\n    this.pluginName = 'janus.plugin.echotest'\n    this.sdpHelper = new SdpHelper(this.logger)\n  }\n\n  mute (isMuted = false) {\n    return this.transaction('message', { audio: !isMuted }, 'success').catch((err) => {\n      this.logger.error('EchoJanusPlugin, cannot mute', err)\n      throw err\n    })\n  }\n\n  connect () {\n    return this.transaction('message', { body: this.janusEchoBody }, 'event').catch((err) => {\n      this.logger.error('EchoJanusPlugin error during connect', err)\n      throw err\n    })\n  }\n\n  onmessage (data, json) {\n    if (data && data.echotest === 'event' && data.result === 'done') {\n      // okay, so the echo test has ended\n      this.janus.destroyPlugin(this).catch((err) => {\n        this.logger.error('EchoJanusPlugin, destroyPlugin error in onmessage', err)\n      })\n    } else {\n      this.logger.error('EchoJanusPlugin got unknown message', data, json)\n    }\n  }\n\n  consume (data) {\n    if (data.type === 'message') {\n      const sendData = { jsep: data.message.jsep, body: this.janusEchoBody }\n      return this.transaction('message', sendData, 'event').then((ret) => {\n        const { json } = ret\n        if (!json || !json.jsep) {\n          this.logger.error('EchoJanusPlugin, no jsep in the transaction reply', ret)\n          return\n        }\n\n        const jsep = json.jsep\n        if (this.filterDirectCandidates && jsep.sdp) {\n          jsep.sdp = this.sdpHelper.filterDirectCandidates(jsep.sdp)\n        }\n\n        this.emit('jsep', jsep)\n      }).catch((err) => {\n        this.logger.error('EchoJanusPlugin, message error in consume', err)\n        throw err\n      })\n    } else if (data.type === 'candidate') {\n      if (this.filterDirectCandidates && data.message.candidate && this.sdpHelper.isDirectCandidate(data.message.candidate)) {\n        return Promise.resolve()\n      }\n      return this.transaction('trickle', { candidate: data.message }).catch((err) => {\n        this.logger.error('EchoJanusPlugin, candidate error in consume', err)\n        throw err\n      })\n    } else {\n      this.logger.error('EchoTransportSession unknown data type', data)\n      return Promise.reject(new Error('EchoTransportSession unknown data type'))\n    }\n  }\n}\n\nmodule.exports = EchoJanusPlugin\n","const uuid = require('uuid/v4')\nconst EventEmitter = require('events')\n\nclass JanusPlugin extends EventEmitter {\n  constructor (logger) {\n    super()\n    this.id = uuid()\n    /** @var Janus */\n    this.janus = undefined\n    this.janusHandleId = undefined\n    this.pluginName = undefined\n    this.logger = logger\n  }\n\n  getAttachPayload () {\n    return { plugin: this.pluginName, opaque_id: this.id }\n  }\n\n  transaction (message, additionalFields, replyType) {\n    const payload = Object.assign({}, additionalFields, { handle_id: this.janusHandleId })\n\n    if (!this.janus) {\n      return Promise.reject(new Error('JanusPlugin is not connected'))\n    }\n\n    return this.janus.transaction(message, payload, replyType)\n  }\n\n  success (janus, janusHandleId) {\n    this.janus = janus\n    this.janusHandleId = janusHandleId\n\n    return this\n  }\n\n  error (cause) {\n    // Couldn't attach to the plugin\n  }\n\n  onmessage (data, json) {\n    this.logger.error('Unhandled message from janus in a plugin: ' + this.constructor.name, data, json)\n  }\n\n  oncleanup () {\n    // PeerConnection with the plugin closed, clean the UI\n    // The plugin handle is still valid so we can create a new one\n  }\n\n  detached () {\n    // Connection with the plugin closed, get rid of its features\n    // The plugin handle is not valid anymore\n  }\n\n  hangup () {\n    this.emit('hangup')\n  }\n\n  slowLink () {\n    this.emit('slowlink')\n  }\n\n  mediaState (medium, on) {\n    this.emit('mediaState', medium, on)\n  }\n\n  webrtcState (isReady, cause) {\n    this.emit('webrtcState', isReady, cause)\n  }\n\n  detach () {\n    this.removeAllListeners()\n    this.janus = null\n  }\n}\n\nmodule.exports = JanusPlugin\n","const SDPUtils = require('sdp')\n\nclass SdpHelper {\n  constructor (logger) {\n    this.logger = logger\n  }\n\n  /**\n   * @param sdp string\n   * @param allowedProfiles array[]|string|Regexp\n   */\n  filterH264Profiles (sdp, allowedProfiles) {\n    const sections = SDPUtils.splitSections(sdp)\n\n    const ret = []\n    for (const section of sections) {\n      if (SDPUtils.getMid(section) === 'video') {\n        const newSection = []\n        const lines = SDPUtils.splitLines(section)\n        const rtpSections = [[]]\n        let i = 0\n\n        for (const line of lines) {\n          if (line.indexOf('a=rtpmap:') === 0) {\n            rtpSections.push([])\n            i++\n          }\n          rtpSections[i].push(line)\n        }\n\n        rtpSections[0].map(l => newSection.push(l))\n        for (let j = 1; j < rtpSections.length; j++) {\n          const rtpSection = rtpSections[j]\n          const parsed = SDPUtils.parseRtpMap(rtpSection[0])\n\n          if (parsed && parsed.name === 'H264') {\n            const fmtp = rtpSection.filter(l => l.indexOf('a=fmtp:') === 0).shift()\n\n            let isAllowed = false\n            if (Array.isArray(allowedProfiles)) {\n              for (const allowedProfile of allowedProfiles) {\n                isAllowed = isAllowed || fmtp.indexOf('profile-level-id=' + allowedProfile) !== -1\n              }\n            } else if (typeof allowedProfiles === 'string') {\n              isAllowed = fmtp.indexOf('profile-level-id=' + allowedProfiles) !== -1\n            } else if (allowedProfiles instanceof RegExp) {\n              isAllowed = allowedProfiles.test(fmtp)\n            }\n\n            if (isAllowed) {\n              rtpSections[j].map(l => newSection.push(l))\n            }\n          } else {\n            rtpSections[j].map(l => newSection.push(l))\n          }\n        }\n\n        newSection.map(l => ret.push(l))\n      } else {\n        SDPUtils.splitLines(section).map(l => ret.push(l))\n      }\n    }\n\n    return ret.join('\\r\\n') + '\\r\\n'\n  }\n\n  filterDirectCandidates (sdp, force = false) {\n    const lines = SDPUtils.splitLines(sdp)\n\n    const ret = []\n    let haveCandidates = false\n    let haveNonDirectCandidates = false\n    for (const line of lines) {\n      if (line.startsWith('a=candidate')) {\n        haveCandidates = true\n        if (!this.isDirectCandidate(line)) {\n          ret.push(line)\n          haveNonDirectCandidates = true\n        }\n      } else {\n        ret.push(line)\n      }\n    }\n\n    // only remove _all_ candidates if its a forced request\n    if (haveCandidates && !haveNonDirectCandidates && !force) {\n      this.logger.warn('SDP NO OTHER CANDIDATES THAN DIRECT CANDIDATES', sdp, new Error().stack)\n      return sdp\n    }\n\n    if (haveCandidates && !haveNonDirectCandidates) {\n      this.logger.error('SDP DIRECT CANDIDATES FILTERED OUT BUT NO OTHER CANDIDATES IN SDP', sdp, new Error().stack)\n    }\n\n    return ret.join('\\r\\n') + '\\r\\n'\n  }\n\n  isDirectCandidate (candidateLine) {\n    const candidate = SDPUtils.parseCandidate(candidateLine)\n    return candidate.type === 'host' || candidate.type === 'srflx' || candidate.tcpType === 'host' || candidate.tcpType === 'srflx'\n  }\n}\n\nmodule.exports = SdpHelper\n","const JanusPlugin = require('../JanusPlugin')\nconst SdpHelper = require('../SdpHelper')\n\nclass VideoRoomListenerJanusPlugin extends JanusPlugin {\n  constructor (roomId, janusRoomId, roomMemberPrivateId, remoteFeedId, logger, filterDirectCandidates = false) {\n    if (!roomId) {\n      throw new Error('unknown roomId')\n    }\n    if (!roomMemberPrivateId) {\n      throw new Error('unknown janusRoomPrivateMemberId')\n    }\n\n    super(logger)\n    this.roomId = roomId\n    this.janusRoomId = janusRoomId\n    this.pluginName = 'janus.plugin.videoroom'\n    this.janusRoomPrivateMemberId = roomMemberPrivateId\n    this.janusRemoteFeedId = remoteFeedId\n    this.filterDirectCandidates = !!filterDirectCandidates\n    this.sdpHelper = new SdpHelper(this.logger)\n  }\n\n  join (offerAudio = true, offerVideo = true) {\n    const join = {\n      request: 'join',\n      room: this.janusRoomId,\n      ptype: 'listener',\n      feed: this.janusRemoteFeedId,\n      private_id: this.janusRoomPrivateMemberId,\n      offer_video: offerVideo,\n      offer_audio: offerAudio\n    }\n\n    return new Promise((resolve, reject) => {\n      this.transaction('message', { body: join }, 'event').then((param) => {\n        const { data, json } = param || {}\n        if (!data || data.videoroom !== 'attached') {\n          this.logger.error('VideoRoomListenerJanusPlugin join answer is not attached', data, json)\n          throw new Error('VideoRoomListenerJanusPlugin join answer is not attached')\n        }\n        if (!json.jsep) {\n          this.logger.error('VideoRoomListenerJanusPlugin join answer does not contains jsep', data, json)\n          throw new Error('VideoRoomListenerJanusPlugin join answer does not contains jsep')\n        }\n\n        const jsep = json.jsep\n        if (this.filterDirectCandidates && jsep.sdp) {\n          jsep.sdp = this.sdpHelper.filterDirectCandidates(jsep.sdp)\n        }\n\n        this.emit('jsep', jsep)\n        resolve(jsep)\n      }).catch((err) => {\n        this.logger.error('VideoRoomListenerJanusPlugin, unknown error connecting to room', err, join)\n        reject(err)\n      })\n    })\n  }\n\n  setAnswer (answer) {\n    const body = { request: 'start', room: this.janusRoomId }\n\n    return new Promise((resolve, reject) => {\n      const jsep = answer\n      if (this.filterDirectCandidates && jsep && jsep.sdp) {\n        jsep.sdp = this.sdpHelper.filterDirectCandidates(jsep.sdp)\n      }\n\n      this.transaction('message', { body, jsep }, 'event').then((param) => {\n        const { data, json } = param || {}\n\n        if (!data || data.started !== 'ok') {\n          this.logger.error('VideoRoomListenerJanusPlugin set answer is not ok', data, json)\n          throw new Error('VideoRoomListenerJanusPlugin set answer is not ok')\n        }\n        resolve()\n      }).catch((err) => {\n        this.logger.error('VideoRoomListenerJanusPlugin, unknown error sending answer', err, answer)\n        reject(err)\n      })\n    })\n  }\n\n  candidate (candidate) {\n    if (this.filterDirectCandidates && candidate.candidate && this.sdpHelper.isDirectCandidate(candidate.candidate)) {\n      return\n    }\n\n    return this.transaction('trickle', { candidate })\n  }\n\n  hangup () {\n    super.hangup()\n    this.janus.destroyPlugin(this).catch((err) => {\n      this.logger.error('VideoRoomListenerJanusPlugin, destroyPlugin error in hangup', err)\n    })\n  }\n}\n\nmodule.exports = VideoRoomListenerJanusPlugin\n","const Janus = require('./src/Janus')\nconst JanusAdmin = require('./src/JanusAdmin')\nconst JanusPlugin = require('./src/JanusPlugin')\nconst EchoJanusPlugin = require('./src/plugin/EchoJanusPlugin')\nconst RecordPlayJanusPlugin = require('./src/plugin/RecordPlayJanusPlugin')\nconst VideoRoomListenerJanusPlugin = require('./src/plugin/VideoRoomListenerJanusPlugin')\nconst VideoRoomPublisherJanusPlugin = require('./src/plugin/VideoRoomPublisherJanusPlugin')\nconst StreamingJanusPlugin = require('./src/plugin/StreamingJanusPlugin')\nconst { JanusConfig, JanusAdminConfig, JanusRoomConfig } = require('./src/Config')\n\nmodule.exports = {\n  Janus,\n  JanusAdmin,\n  JanusPlugin,\n  EchoJanusPlugin,\n  RecordPlayJanusPlugin,\n  VideoRoomListenerJanusPlugin,\n  VideoRoomPublisherJanusPlugin,\n  StreamingJanusPlugin,\n  JanusConfig,\n  JanusAdminConfig,\n  JanusRoomConfig\n}\n","var rng = require('./lib/rng');\nvar bytesToUuid = require('./lib/bytesToUuid');\n\nfunction v4(options, buf, offset) {\n  var i = buf && offset || 0;\n\n  if (typeof(options) == 'string') {\n    buf = options === 'binary' ? new Array(16) : null;\n    options = null;\n  }\n  options = options || {};\n\n  var rnds = options.random || (options.rng || rng)();\n\n  // Per 4.4, set bits for version and `clock_seq_hi_and_reserved`\n  rnds[6] = (rnds[6] & 0x0f) | 0x40;\n  rnds[8] = (rnds[8] & 0x3f) | 0x80;\n\n  // Copy bytes to buffer, if provided\n  if (buf) {\n    for (var ii = 0; ii < 16; ++ii) {\n      buf[i + ii] = rnds[ii];\n    }\n  }\n\n  return buf || bytesToUuid(rnds);\n}\n\nmodule.exports = v4;\n","class JanusConfig {\n  constructor (config) {\n    const {\n      url,\n      keepAliveIntervalMs,\n      options\n    } = config\n\n    this.url = url\n    this.keepAliveIntervalMs = keepAliveIntervalMs\n    this.options = options\n  }\n}\n\nclass JanusAdminConfig extends JanusConfig {\n  constructor (config) {\n    super(config)\n    const {\n      secret,\n      sessionListIntervalMs\n    } = config\n\n    this.secret = secret\n    this.sessionListIntervalMs = sessionListIntervalMs\n  }\n}\n\nclass JanusRoomConfig {\n  constructor (config) {\n    const {\n      id,\n      codec,\n      record,\n      videoOrientExt,\n      bitrate,\n      firSeconds,\n      publishers,\n      recordDirectory\n    } = config\n\n    this.id = id\n    this.codec = codec\n    this.record = record\n    this.videoOrientExt = videoOrientExt\n    this.bitrate = bitrate\n    this.firSeconds = firSeconds\n    this.publishers = publishers\n    this.recordDirectory = recordDirectory\n  }\n}\n\nmodule.exports.JanusConfig = JanusConfig\nmodule.exports.JanusAdminConfig = JanusAdminConfig\nmodule.exports.JanusRoomConfig = JanusRoomConfig\n","const JanusPlugin = require('../JanusPlugin')\nconst SdpHelper = require('../SdpHelper')\n\nclass RecordPlayJanusPlugin extends JanusPlugin {\n  constructor (logger, filterDirectCandidates = false) {\n    super(logger)\n    this.filterDirectCandidates = !!filterDirectCandidates\n    this.janusEchoBody = { audio: true, video: true }\n    this.pluginName = 'janus.plugin.recordplay'\n    this.sdpHelper = new SdpHelper(this.logger)\n  }\n\n  configure (videoBitrateMax = 1024 * 1024, videoKeyframeInterval = 15000) {\n    return this.transaction('message', { body: { request: 'configure', 'video-bitrate-max': videoBitrateMax, 'video-keyframe-interval': videoKeyframeInterval } }, 'success').catch((err) => {\n      this.logger.error('RecordPlayJanusPlugin, cannot configure', err)\n      throw err\n    })\n  }\n\n  onmessage (data, json) {\n    if (data && data.recordplay === 'event' && data.result === 'done') {\n      // okay, so the recording has ended\n      this.janus.destroyPlugin(this).catch((err) => {\n        this.logger.error('RecordPlayJanusPlugin, destroyPlugin error in onmessage', err)\n      })\n    } else {\n      this.logger.error('RecordPlayJanusPlugin got unknown message', data, json)\n    }\n  }\n\n  consume (data) {\n    if (data.type === 'message') {\n      const sendData = { jsep: data.message.jsep, body: { request: 'record', name: 'hello' } }\n      this.transaction('message', sendData, 'event').then((ret) => {\n        const { json, data } = ret\n        if (!data || !data.result || !data.result.id) {\n          this.logger.error('RecordPlayJanusPlugin, no recording id in the transaction reply', ret)\n          return\n        }\n\n        this.emit('recordingId', data.result.id)\n\n        if (!json || !json.jsep) {\n          this.logger.error('RecordPlayJanusPlugin, no jsep in the transaction reply', ret)\n          return\n        }\n\n        const jsep = json.jsep\n        if (this.filterDirectCandidates && jsep.sdp) {\n          jsep.sdp = this.sdpHelper.filterDirectCandidates(jsep.sdp)\n        }\n\n        this.emit('jsep', jsep)\n      })\n    } else if (data.type === 'candidate') {\n      if (this.filterDirectCandidates && data.message.candidate && this.sdpHelper.isDirectCandidate(data.message.candidate)) {\n        return\n      }\n      this.transaction('trickle', { candidate: data.message })\n    } else if (data.type === 'stop') {\n      const sendData = { body: { request: 'stop' } }\n      this.transaction('message', sendData, 'event')\n    } else {\n      this.logger.error('RecordPlayJanusPlugin unknown data type', data)\n    }\n  }\n}\n\nmodule.exports = RecordPlayJanusPlugin\n","// Unique ID creation requires a high quality random # generator.  In the\n// browser this is a little complicated due to unknown quality of Math.random()\n// and inconsistent support for the `crypto` API.  We do the best we can via\n// feature-detection\n\n// getRandomValues needs to be invoked in a context where \"this\" is a Crypto\n// implementation. Also, find the complete implementation of crypto on IE11.\nvar getRandomValues = (typeof(crypto) != 'undefined' && crypto.getRandomValues && crypto.getRandomValues.bind(crypto)) ||\n                      (typeof(msCrypto) != 'undefined' && typeof window.msCrypto.getRandomValues == 'function' && msCrypto.getRandomValues.bind(msCrypto));\n\nif (getRandomValues) {\n  // WHATWG crypto RNG - http://wiki.whatwg.org/wiki/Crypto\n  var rnds8 = new Uint8Array(16); // eslint-disable-line no-undef\n\n  module.exports = function whatwgRNG() {\n    getRandomValues(rnds8);\n    return rnds8;\n  };\n} else {\n  // Math.random()-based (RNG)\n  //\n  // If all else fails, use Math.random().  It's fast, but is of unspecified\n  // quality.\n  var rnds = new Array(16);\n\n  module.exports = function mathRNG() {\n    for (var i = 0, r; i < 16; i++) {\n      if ((i & 0x03) === 0) r = Math.random() * 0x100000000;\n      rnds[i] = r >>> ((i & 0x03) << 3) & 0xff;\n    }\n\n    return rnds;\n  };\n}\n","// Copyright Joyent, Inc. and other Node contributors.\n//\n// Permission is hereby granted, free of charge, to any person obtaining a\n// copy of this software and associated documentation files (the\n// \"Software\"), to deal in the Software without restriction, including\n// without limitation the rights to use, copy, modify, merge, publish,\n// distribute, sublicense, and/or sell copies of the Software, and to permit\n// persons to whom the Software is furnished to do so, subject to the\n// following conditions:\n//\n// The above copyright notice and this permission notice shall be included\n// in all copies or substantial portions of the Software.\n//\n// THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS\n// OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF\n// MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN\n// NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM,\n// DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR\n// OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE\n// USE OR OTHER DEALINGS IN THE SOFTWARE.\n\n'use strict';\n\nvar R = typeof Reflect === 'object' ? Reflect : null\nvar ReflectApply = R && typeof R.apply === 'function'\n  ? R.apply\n  : function ReflectApply(target, receiver, args) {\n    return Function.prototype.apply.call(target, receiver, args);\n  }\n\nvar ReflectOwnKeys\nif (R && typeof R.ownKeys === 'function') {\n  ReflectOwnKeys = R.ownKeys\n} else if (Object.getOwnPropertySymbols) {\n  ReflectOwnKeys = function ReflectOwnKeys(target) {\n    return Object.getOwnPropertyNames(target)\n      .concat(Object.getOwnPropertySymbols(target));\n  };\n} else {\n  ReflectOwnKeys = function ReflectOwnKeys(target) {\n    return Object.getOwnPropertyNames(target);\n  };\n}\n\nfunction ProcessEmitWarning(warning) {\n  if (console && console.warn) console.warn(warning);\n}\n\nvar NumberIsNaN = Number.isNaN || function NumberIsNaN(value) {\n  return value !== value;\n}\n\nfunction EventEmitter() {\n  EventEmitter.init.call(this);\n}\nmodule.exports = EventEmitter;\n\n// Backwards-compat with node 0.10.x\nEventEmitter.EventEmitter = EventEmitter;\n\nEventEmitter.prototype._events = undefined;\nEventEmitter.prototype._eventsCount = 0;\nEventEmitter.prototype._maxListeners = undefined;\n\n// By default EventEmitters will print a warning if more than 10 listeners are\n// added to it. This is a useful default which helps finding memory leaks.\nvar defaultMaxListeners = 10;\n\nfunction checkListener(listener) {\n  if (typeof listener !== 'function') {\n    throw new TypeError('The \"listener\" argument must be of type Function. Received type ' + typeof listener);\n  }\n}\n\nObject.defineProperty(EventEmitter, 'defaultMaxListeners', {\n  enumerable: true,\n  get: function() {\n    return defaultMaxListeners;\n  },\n  set: function(arg) {\n    if (typeof arg !== 'number' || arg < 0 || NumberIsNaN(arg)) {\n      throw new RangeError('The value of \"defaultMaxListeners\" is out of range. It must be a non-negative number. Received ' + arg + '.');\n    }\n    defaultMaxListeners = arg;\n  }\n});\n\nEventEmitter.init = function() {\n\n  if (this._events === undefined ||\n      this._events === Object.getPrototypeOf(this)._events) {\n    this._events = Object.create(null);\n    this._eventsCount = 0;\n  }\n\n  this._maxListeners = this._maxListeners || undefined;\n};\n\n// Obviously not all Emitters should be limited to 10. This function allows\n// that to be increased. Set to zero for unlimited.\nEventEmitter.prototype.setMaxListeners = function setMaxListeners(n) {\n  if (typeof n !== 'number' || n < 0 || NumberIsNaN(n)) {\n    throw new RangeError('The value of \"n\" is out of range. It must be a non-negative number. Received ' + n + '.');\n  }\n  this._maxListeners = n;\n  return this;\n};\n\nfunction _getMaxListeners(that) {\n  if (that._maxListeners === undefined)\n    return EventEmitter.defaultMaxListeners;\n  return that._maxListeners;\n}\n\nEventEmitter.prototype.getMaxListeners = function getMaxListeners() {\n  return _getMaxListeners(this);\n};\n\nEventEmitter.prototype.emit = function emit(type) {\n  var args = [];\n  for (var i = 1; i < arguments.length; i++) args.push(arguments[i]);\n  var doError = (type === 'error');\n\n  var events = this._events;\n  if (events !== undefined)\n    doError = (doError && events.error === undefined);\n  else if (!doError)\n    return false;\n\n  // If there is no 'error' event listener then throw.\n  if (doError) {\n    var er;\n    if (args.length > 0)\n      er = args[0];\n    if (er instanceof Error) {\n      // Note: The comments on the `throw` lines are intentional, they show\n      // up in Node's output if this results in an unhandled exception.\n      throw er; // Unhandled 'error' event\n    }\n    // At least give some kind of context to the user\n    var err = new Error('Unhandled error.' + (er ? ' (' + er.message + ')' : ''));\n    err.context = er;\n    throw err; // Unhandled 'error' event\n  }\n\n  var handler = events[type];\n\n  if (handler === undefined)\n    return false;\n\n  if (typeof handler === 'function') {\n    ReflectApply(handler, this, args);\n  } else {\n    var len = handler.length;\n    var listeners = arrayClone(handler, len);\n    for (var i = 0; i < len; ++i)\n      ReflectApply(listeners[i], this, args);\n  }\n\n  return true;\n};\n\nfunction _addListener(target, type, listener, prepend) {\n  var m;\n  var events;\n  var existing;\n\n  checkListener(listener);\n\n  events = target._events;\n  if (events === undefined) {\n    events = target._events = Object.create(null);\n    target._eventsCount = 0;\n  } else {\n    // To avoid recursion in the case that type === \"newListener\"! Before\n    // adding it to the listeners, first emit \"newListener\".\n    if (events.newListener !== undefined) {\n      target.emit('newListener', type,\n                  listener.listener ? listener.listener : listener);\n\n      // Re-assign `events` because a newListener handler could have caused the\n      // this._events to be assigned to a new object\n      events = target._events;\n    }\n    existing = events[type];\n  }\n\n  if (existing === undefined) {\n    // Optimize the case of one listener. Don't need the extra array object.\n    existing = events[type] = listener;\n    ++target._eventsCount;\n  } else {\n    if (typeof existing === 'function') {\n      // Adding the second element, need to change to array.\n      existing = events[type] =\n        prepend ? [listener, existing] : [existing, listener];\n      // If we've already got an array, just append.\n    } else if (prepend) {\n      existing.unshift(listener);\n    } else {\n      existing.push(listener);\n    }\n\n    // Check for listener leak\n    m = _getMaxListeners(target);\n    if (m > 0 && existing.length > m && !existing.warned) {\n      existing.warned = true;\n      // No error code for this since it is a Warning\n      // eslint-disable-next-line no-restricted-syntax\n      var w = new Error('Possible EventEmitter memory leak detected. ' +\n                          existing.length + ' ' + String(type) + ' listeners ' +\n                          'added. Use emitter.setMaxListeners() to ' +\n                          'increase limit');\n      w.name = 'MaxListenersExceededWarning';\n      w.emitter = target;\n      w.type = type;\n      w.count = existing.length;\n      ProcessEmitWarning(w);\n    }\n  }\n\n  return target;\n}\n\nEventEmitter.prototype.addListener = function addListener(type, listener) {\n  return _addListener(this, type, listener, false);\n};\n\nEventEmitter.prototype.on = EventEmitter.prototype.addListener;\n\nEventEmitter.prototype.prependListener =\n    function prependListener(type, listener) {\n      return _addListener(this, type, listener, true);\n    };\n\nfunction onceWrapper() {\n  if (!this.fired) {\n    this.target.removeListener(this.type, this.wrapFn);\n    this.fired = true;\n    if (arguments.length === 0)\n      return this.listener.call(this.target);\n    return this.listener.apply(this.target, arguments);\n  }\n}\n\nfunction _onceWrap(target, type, listener) {\n  var state = { fired: false, wrapFn: undefined, target: target, type: type, listener: listener };\n  var wrapped = onceWrapper.bind(state);\n  wrapped.listener = listener;\n  state.wrapFn = wrapped;\n  return wrapped;\n}\n\nEventEmitter.prototype.once = function once(type, listener) {\n  checkListener(listener);\n  this.on(type, _onceWrap(this, type, listener));\n  return this;\n};\n\nEventEmitter.prototype.prependOnceListener =\n    function prependOnceListener(type, listener) {\n      checkListener(listener);\n      this.prependListener(type, _onceWrap(this, type, listener));\n      return this;\n    };\n\n// Emits a 'removeListener' event if and only if the listener was removed.\nEventEmitter.prototype.removeListener =\n    function removeListener(type, listener) {\n      var list, events, position, i, originalListener;\n\n      checkListener(listener);\n\n      events = this._events;\n      if (events === undefined)\n        return this;\n\n      list = events[type];\n      if (list === undefined)\n        return this;\n\n      if (list === listener || list.listener === listener) {\n        if (--this._eventsCount === 0)\n          this._events = Object.create(null);\n        else {\n          delete events[type];\n          if (events.removeListener)\n            this.emit('removeListener', type, list.listener || listener);\n        }\n      } else if (typeof list !== 'function') {\n        position = -1;\n\n        for (i = list.length - 1; i >= 0; i--) {\n          if (list[i] === listener || list[i].listener === listener) {\n            originalListener = list[i].listener;\n            position = i;\n            break;\n          }\n        }\n\n        if (position < 0)\n          return this;\n\n        if (position === 0)\n          list.shift();\n        else {\n          spliceOne(list, position);\n        }\n\n        if (list.length === 1)\n          events[type] = list[0];\n\n        if (events.removeListener !== undefined)\n          this.emit('removeListener', type, originalListener || listener);\n      }\n\n      return this;\n    };\n\nEventEmitter.prototype.off = EventEmitter.prototype.removeListener;\n\nEventEmitter.prototype.removeAllListeners =\n    function removeAllListeners(type) {\n      var listeners, events, i;\n\n      events = this._events;\n      if (events === undefined)\n        return this;\n\n      // not listening for removeListener, no need to emit\n      if (events.removeListener === undefined) {\n        if (arguments.length === 0) {\n          this._events = Object.create(null);\n          this._eventsCount = 0;\n        } else if (events[type] !== undefined) {\n          if (--this._eventsCount === 0)\n            this._events = Object.create(null);\n          else\n            delete events[type];\n        }\n        return this;\n      }\n\n      // emit removeListener for all listeners on all events\n      if (arguments.length === 0) {\n        var keys = Object.keys(events);\n        var key;\n        for (i = 0; i < keys.length; ++i) {\n          key = keys[i];\n          if (key === 'removeListener') continue;\n          this.removeAllListeners(key);\n        }\n        this.removeAllListeners('removeListener');\n        this._events = Object.create(null);\n        this._eventsCount = 0;\n        return this;\n      }\n\n      listeners = events[type];\n\n      if (typeof listeners === 'function') {\n        this.removeListener(type, listeners);\n      } else if (listeners !== undefined) {\n        // LIFO order\n        for (i = listeners.length - 1; i >= 0; i--) {\n          this.removeListener(type, listeners[i]);\n        }\n      }\n\n      return this;\n    };\n\nfunction _listeners(target, type, unwrap) {\n  var events = target._events;\n\n  if (events === undefined)\n    return [];\n\n  var evlistener = events[type];\n  if (evlistener === undefined)\n    return [];\n\n  if (typeof evlistener === 'function')\n    return unwrap ? [evlistener.listener || evlistener] : [evlistener];\n\n  return unwrap ?\n    unwrapListeners(evlistener) : arrayClone(evlistener, evlistener.length);\n}\n\nEventEmitter.prototype.listeners = function listeners(type) {\n  return _listeners(this, type, true);\n};\n\nEventEmitter.prototype.rawListeners = function rawListeners(type) {\n  return _listeners(this, type, false);\n};\n\nEventEmitter.listenerCount = function(emitter, type) {\n  if (typeof emitter.listenerCount === 'function') {\n    return emitter.listenerCount(type);\n  } else {\n    return listenerCount.call(emitter, type);\n  }\n};\n\nEventEmitter.prototype.listenerCount = listenerCount;\nfunction listenerCount(type) {\n  var events = this._events;\n\n  if (events !== undefined) {\n    var evlistener = events[type];\n\n    if (typeof evlistener === 'function') {\n      return 1;\n    } else if (evlistener !== undefined) {\n      return evlistener.length;\n    }\n  }\n\n  return 0;\n}\n\nEventEmitter.prototype.eventNames = function eventNames() {\n  return this._eventsCount > 0 ? ReflectOwnKeys(this._events) : [];\n};\n\nfunction arrayClone(arr, n) {\n  var copy = new Array(n);\n  for (var i = 0; i < n; ++i)\n    copy[i] = arr[i];\n  return copy;\n}\n\nfunction spliceOne(list, index) {\n  for (; index + 1 < list.length; index++)\n    list[index] = list[index + 1];\n  list.pop();\n}\n\nfunction unwrapListeners(arr) {\n  var ret = new Array(arr.length);\n  for (var i = 0; i < ret.length; ++i) {\n    ret[i] = arr[i].listener || arr[i];\n  }\n  return ret;\n}\n"],"sourceRoot":""}